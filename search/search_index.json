{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Kubauth","text":"<p>A Kubernetes-native OpenID Connect (OIDC) Identity Provider.</p>"},{"location":"#overview","title":"Overview","text":"<p>Kubauth is a fully-featured OIDC identity provider designed for Kubernetes environments.</p> <p>It stores users, groups, clients, and sessions as native Kubernetes resources, providing a scalable and cloud-native authentication solution.</p> <p>Kubauth can operate autonomously with its own user database or act as a federation gateway for external identity providers such as LDAP.</p>"},{"location":"#key-features","title":"Key Features","text":"<ul> <li>OIDC Compliance: Supports standard OIDC flows including Authorization Code and Resource Owner Password Credentials (ROPC)</li> <li>PKCE Support: Complete Proof Key for Code Exchange (PKCE) implementation with configurable enforcement</li> <li>Kubernetes-Native Storage: All data stored as Kubernetes Custom Resources (CRDs) \u2014 no external database required</li> <li>SSO Capabilities: Cross-application Single Sign-On with persistent sessions</li> <li>User &amp; Group Management: Fine-grained user authentication and group-based authorization<ul> <li>Claims can be defined at user or group level</li> <li>User profiles can be built from multiple identity sources</li> </ul> </li> <li>Security First: bcrypt password hashing, JWT signing with persistent keys, secure session management</li> <li>Production Ready: Health checks, admission webhooks, and Helm chart deployment</li> </ul>"},{"location":"#kubauth-components","title":"Kubauth Components","text":"<p>Kubauth consists of several subprojects:</p> <ul> <li>kubauth: The main OIDC server with all its connectors</li> <li>kc: A companion CLI tool</li> <li>Two subprojects designed to authenticate <code>kubectl</code> users with OIDC:<ul> <li>kubauth-apiserver: A Kubernetes configuration tool to automate the <code>apiserver</code> OIDC configuration</li> <li>kubauth-kubeconfig: A tool to automate <code>kubectl</code> client configuration</li> </ul> </li> </ul>"},{"location":"20-installation/","title":"Installation","text":""},{"location":"20-installation/#prerequisites","title":"Prerequisites","text":"<p>Before you begin, ensure the following components are in place:</p> <ul> <li> <p>Kubectl Configuration: A local Kubernetes client configuration with full cluster administrator privileges on the target cluster.</p> </li> <li> <p>Certificate Manager: The Certificate Manager must be deployed on your target Kubernetes cluster with a <code>ClusterIssuer</code> configured for certificate management.</p> </li> <li> <p>Ingress Controller: An NGINX ingress controller must be deployed on your target Kubernetes cluster.</p> </li> <li> <p>Helm: Helm must be installed on your local workstation.</p> </li> </ul> <p>Tip</p> <p>If you don't have a suitable Kubernetes cluster available, you can deploy a Kind cluster on your local workstation.</p>"},{"location":"20-installation/#kubauth-deployment","title":"Kubauth Deployment","text":"<p>The recommended method for installing Kubauth is using the provided OCI Helm chart.</p> <p>Since several configuration parameters are required, we recommend using a values file rather than command-line arguments.</p> <p>In your working directory, create a file with the following content:</p> values.yaml <pre><code>oidc:\n  issuer: https://kubauth.ingress.kubo6.mbp\n  postLogoutURL: https://kubauth.ingress.kubo6.mbp/index\n\n  ingress:\n    host: kubauth.ingress.kubo6.mbp\n\n  server:\n    certificateIssuer: cluster-odp\n</code></pre> <p>Replace the placeholder values with your environment-specific configuration:</p> <ul> <li><code>kubauth.ingress.kubo6.mbp</code>: The hostname which will be used to access the Kubauth service from outside the cluster. <p>Ensure this hostname is registered in your DNS.</p> </li> <li><code>cluster-odp</code>: The <code>ClusterIssuer</code> name from your Certificate Manager for ingress certificate provisioning.</li> </ul> <p>Note</p> <p>This <code>values.yaml</code> represents the minimum required configuration. Additional parameters may be introduced in subsequent chapters.</p> <p>Deploy Kubauth using the following command:</p> <pre><code>helm -n kubauth upgrade -i kubauth --values ./values.yaml oci://quay.io/kubauth/charts/kubauth --version 0.1.2-snapshot --create-namespace --wait\n</code></pre> <p>After a few seconds, verify that the Kubauth server pod is running:</p> <p><pre><code>kubectl -n kubauth get pods\n</code></pre> <pre><code>NAME                       READY   STATUS    RESTARTS   AGE\nkubauth-5d4fdc6bc8-7rlb6   3/3     Running   0          55s\n</code></pre></p> <p>Confirm that the Kubauth issuer URL is accessible:</p> <pre><code>curl https://kubauth.ingress.kubo6.mbp/.well-known/openid-configuration\n</code></pre>"},{"location":"20-installation/#kc-cli-tool-installation","title":"<code>kc</code> CLI Tool Installation","text":"<p>Download the <code>kc</code> CLI from the GitHub releases page, rename it to <code>kc</code>, make it executable, and move it to your system path:</p> <pre><code>mv kc_*_* kc\nchmod +x kc\nsudo mv kc /usr/local/bin/\n</code></pre> <p>Verify the installation:</p> <pre><code>kc version\n</code></pre>"},{"location":"30-user-guide/110-configuration/","title":"Configuration","text":"<p>Kubauth configuration is based on:</p> <ul> <li>Helm chart variables</li> <li>Users and Groups defined as Kubernetes Custom Resources</li> <li>Client Applications defined as Kubernetes Custom Resources</li> </ul> <p>We recommend applying the sample configuration described below, as it will be referenced in subsequent chapters.</p>"},{"location":"30-user-guide/110-configuration/#user-creation","title":"User Creation","text":"<p>With Kubauth, users can be defined as Kubernetes Custom Resources.</p> <p>Here is a sample manifest that creates two users:</p> users.yaml <pre><code>---\napiVersion: kubauth.kubotal.io/v1alpha1\nkind: User\nmetadata:\n  name: jim\n  namespace: kubauth-users\nspec:\n  passwordHash: \"$2a$12$yJEo9EoYn/ylGS4PCamfNe8PReYH9IPumsw7rMTDi3glZjuA7dXMm\"  # jim123\n\n---\napiVersion: kubauth.kubotal.io/v1alpha1\nkind: User\nmetadata:\n  name: john\n  namespace: kubauth-users\nspec:\n  passwordHash: \"$2a$12$YjalsuGc6uuWtQqVuU/O.eW9L6QGU/vHk2wpvle4dsS7hC2Ic1F.q\"  # john123\n  name: John DOE\n  claims:\n    office: 208G\n  emails:\n    - johnd@mycompany.com\n</code></pre> <ul> <li>The resource name is the user login.</li> <li>Users must be defined in a specific namespace (<code>kubauth-users</code>) to enable access control using Kubernetes RBAC.</li> <li>The only mandatory user attribute is the password, provided as a bcrypt hash.</li> <li>A <code>name</code> attribute can be set to specify the user's full name.</li> <li>A list of email addresses can be associated with each user.</li> <li>Each user can have a set of supplementary OIDC claims defined in <code>spec.claims</code>, which will be merged with system-provided claims. More details on this below.</li> </ul> <p>Deploy the manifest on your cluster:</p> <pre><code>kubectl apply -f users.yaml \n</code></pre> <p>List the newly created users:</p> <p><pre><code>kubectl -n kubauth-users get users.kubauth.kubotal.io\n</code></pre> <pre><code>NAME   USERNAME   EMAILS                    UID   COMMENT   DISABLED   AGE\njim                                                                    82m\njohn   John DOE   [\"johnd@mycompany.com\"]                              67m\n</code></pre></p> <p>Note</p> <p>We provide the fully qualified resource name, as <code>user</code> may refer to other CRD types. For convenience, an alias (<code>kuser</code>) has also been defined for Kubauth users: <pre><code>kubectl -n kubauth-users get kusers\n</code></pre></p>"},{"location":"30-user-guide/110-configuration/#password-hash","title":"Password Hash","text":"<p>The <code>kc</code> CLI tool provides a subcommand to generate password hashes:</p> <pre><code>kc hash jim123\n</code></pre> <pre><code>Secret: jim123\nHash: $2a$12$nSplFbbsGoI7LXdhJrKx0erRmIv.zkTftG82sQZA0.v3l1eCf.ey.\n\nUse this hash in your User 'passwordHash' field\n\nExample:\n  apiVersion: kubauth.kubotal.io/v1alpha1\n  kind: User\n  .....\n  spec:\n    passwordHash: \"$2a$12$nSplFbbsGoI7LXdhJrKx0erRmIv.zkTftG82sQZA0.v3l1eCf.ey.\"\n\nOr in your OidcClient 'hashedSecret' field\n\nExample:\n  apiVersion: kubauth.kubotal.io/v1alpha1\n  kind: OidcClient\n  .....\n  spec:\n    hashedSecret: \"$2a$12$nSplFbbsGoI7LXdhJrKx0erRmIv.zkTftG82sQZA0.v3l1eCf.ey.\"\n</code></pre> <p>Copy and paste the appropriate line into your user manifest.</p>"},{"location":"30-user-guide/110-configuration/#namespace","title":"Namespace","text":"<p>If you need to change the namespace for user resource storage, modify the Helm chart configuration:</p> values.yaml <pre><code>oidc:\n  issuer: https://kubauth.ingress.kubo6.mbp\n  postLogoutURL: https://kubauth.ingress.kubo6.mbp/index\n  ....\n\nucrd:\n  namespace: kubauth-users\n  createNamespace: true\n</code></pre>"},{"location":"30-user-guide/110-configuration/#oidc-client-creation","title":"OIDC Client Creation","text":"<p>In OIDC terminology, a 'client' is an application that delegates user authentication to an OIDC server. As such, it must be registered with the server.</p> <p>With Kubauth, client applications are defined as Kubernetes Custom Resources.</p> <p>Here is an initial example:</p> client-public.yaml <pre><code>apiVersion: kubauth.kubotal.io/v1alpha1\nkind: OidcClient\nmetadata:\n  name: public\n  namespace: kubauth-oidc\nspec:\n  redirectURIs:\n    - \"http://127.0.0.1:9921/callback\"\n  grantTypes: [ \"refresh_token\", \"authorization_code\" ]\n  responseTypes: [ \"id_token\", \"code\", \"token\", \"id_token token\", \"code id_token\", \"code token\", \"code id_token token\" ]\n  scopes: [ \"openid\", \"offline\", \"profile\", \"groups\", \"email\", \"offline_access\" ]\n  description: A test OIDC public client\n  public: true\n\n  # hashedSecret: \"$2a$12$9vdc.xb3Zf4ts/C2pSvIOuGmFiv0EStBJWslaaycavblaIjYZ9Mia\"\n  # accessTokenLifespan: 1h\n  # refreshTokenLifespan: 1h\n  # idTokenLifespan: 1h\n</code></pre> <ul> <li>The resource name is the client ID.</li> <li>The <code>redirectURIs</code> list must be configured for each application. The value shown here is specific to the test client included in the <code>kc</code> CLI (see below).</li> <li>The <code>grantTypes</code> list defines which authorization flows are accepted by this client.</li> <li>The <code>responseTypes</code> list defines what types of tokens or credentials the client can expect from the authorization endpoint after user authentication.</li> <li>The <code>scopes</code> list defines which scopes can be requested by the application.</li> <li>This client is defined as <code>public</code>, so no client secret is required.For confidential clients, a hashed <code>secret</code> must be provided, as shown in the commented line. Use the <code>kc hash</code> command described above to generate it.</li> </ul> <p>Apply this manifest:</p> <pre><code>kubectl apply -f client-public.yaml\n</code></pre> <p>List existing OIDC clients:</p> <pre><code>kubectl -n kubauth-oidc get oidcclients\n</code></pre> <pre><code>NAME     PUB.   DISPLAY   DESCRIPTION                 LINK   AGE\npublic   true             A test OIDC public client          25m\n</code></pre> <p>This client will be used in the next chapter to test tokens and claims.</p>"},{"location":"30-user-guide/110-configuration/#namespace_1","title":"Namespace","text":"<p>If you need to change the namespace for client resource storage, modify the Helm chart configuration:</p> values.yaml <pre><code>oidc:\n  issuer: https://kubauth.ingress.kubo6.mbp\n  postLogoutURL: https://kubauth.ingress.kubo6.mbp/index\n  ....\n  clients:\n    createNamespace: true\n    namespace: kubauth-oidc\n</code></pre>"},{"location":"30-user-guide/120-tokens-and-claims/","title":"Tokens and Claims","text":""},{"location":"30-user-guide/120-tokens-and-claims/#obtaining-a-token","title":"Obtaining a Token","text":"<p>The Kubauth companion CLI application <code>kc</code> provides an embedded OIDC client. Beyond testing the installation, its primary purpose is to fetch access tokens or ID tokens for use in any application.</p> <p>Launch the following command after adjusting the issuer URL:</p> <pre><code>kc token --issuerURL https://kubauth.ingress.kubo6.mbp --clientId public\n</code></pre> <p>Adjust the <code>issuerURL</code> to the value set previously in Kubauth configuration  </p> <p>Tip</p> <p>If you encounter an error like <code>tls: failed to verify certificate: x509:...</code>, the CA associated with your ClusterIssuer is not recognized on your local workstation.</p> <ul> <li>Add the <code>--insecureSkipVerify</code> option to the <code>kc token</code> command. You will also need to configure your browser to accept the certificate.</li> <li>Add the CA as a trusted certificate on your local workstation. You can extract it with:   <pre><code>kubectl -n kubauth get secret kubauth-oidc-server-cert \\\n  -o=jsonpath='{.data.ca\\.crt}' | base64 -d &gt;./ca.crt \n</code></pre></li> <li>Add the <code>--caFile ./ca.crt</code> option to the <code>kc token</code> command.</li> </ul> <p>Your browser should open to the Kubauth login page:</p> <p></p> <p>Log in using <code>jim/jim123</code>. You should land on a page similar to the following:</p> <p></p> <p>From this page, you can copy the provided tokens.</p> <p>These tokens are also displayed in the CLI response:</p> <pre><code>Access token: ory_at_xLUfAhEGpFVWpMLdNEDZAj94hHFrHWjgOYB5g0Leh_k.0rgIzRGFOiIeGsMKnIZ74QL4Ve5vVOuEZyhA0402u8Y\nRefresh token: ory_rt_nU9NBZs4NtKTxVYVko1aqlJkAMF5MLBYjfiZbhVt9aE.THwsnTlqzIsWo5O1NAf1EbDhz7HdaqVHHwSTkWxrkqY\nID token: eyJhbGciOiJSUzI1NiIsImtpZCI6ImY0Y2NkNDU0LWYzYTgtNDQ3Zi1hN2MzLTY3ZmY5MzUxMzZiMSIsInR5cCI6IkpXVCJ9.eyJhdF9oYXNoIjoiaGNBY2dtdmdBekJlSGgyODlkWHF3USIsImF1ZCI6WyJwdWJsaWMiXSwiYXV0aF90aW1lIjoxNzYxMzI2MDg2LCJhenAiOiJwdWJsaWMiLCJleHAiOjE3NjEzMjk2ODYsImlhdCI6MTc2MTMyNjA4NiwiaXNzIjoiaHR0cHM6Ly9rdWJhdXRoLmluZ3Jlc3Mua3VibzYubWJwIiwianRpIjoiZDZhYjkwODMtYTEzMi00YTNiLTlmMWItMzM2NWFhOTQ5MjQ2IiwicmF0IjoxNzYxMzI2MDg2LCJzdWIiOiJqaW0ifQ.Q8ZkF33jsUJDqLH98uqRgrFa2nwioRP1TO9n6QjX9XFr-1WmsKk9nEeHGAiASb1brQ3cSAmK8ta7fX3lBLBlszxmeVZRzq5Qvg0N8nqvlV3C4CAiv6lEl6_-y6wBoQOWN9OhNhYU6wFjpNNDTx_RW0329i9TYVxaygw58wJGCX_1F5-PY0NG74n_1sdZxYop7s5GnZ0_9S9-DEI-LNR2MMx-oVH4lpGjV5dhGRvZS0l4tMm2C7J6Yx_JoTQoZfWwPI0GGf2smZZ-C2ieB5Wj0b19fgrafuexHW9yeejI51j6WZs_eDqUwvCIf52_yAvokA4SiW4PW8Eod9fX-JuwJQ\nExpire in: 59m59s\n</code></pre> <p>Let's try another variant of the command:</p> <pre><code>kc token --issuerURL https://kubauth.ingress.kubo6.mbp --clientId public --onlyIDToken | kc jwt\n</code></pre> <ul> <li>The <code>--onlyIDToken</code> option instructs the command to output only the base64-encoded ID token, useful for batch processing.</li> <li>The <code>kc jwt</code> command decodes the JWT token.</li> </ul> <p>The response should look like:</p> <pre><code>JWT Header:\n{\n  \"alg\": \"RS256\",\n  \"kid\": \"f4ccd454-f3a8-447f-a7c3-67ff935136b1\",\n  \"typ\": \"JWT\"\n}\n\nJWT Payload:\n{\n  \"at_hash\": \"_GWrC20juEb4Zh39S0ly5w\",\n  \"aud\": [\n    \"public\"\n  ],\n  \"auth_time\": 1761564624,\n  \"auth_time_human\": \"2025-10-27 11:30:24 UTC\",\n  \"azp\": \"public\",\n  \"exp\": 1761568224,\n  \"exp_human\": \"2025-10-27 12:30:24 UTC\",\n  \"iat\": 1761564624,\n  \"iat_human\": \"2025-10-27 11:30:24 UTC\",\n  \"iss\": \"https://kubauth.ingress.kubo6.mbp\",\n  \"jti\": \"be30eeb2-153f-4dec-97b8-c75d23035f81\",\n  \"rat\": 1761564624,\n  \"rat_human\": \"2025-10-27 11:30:24 UTC\",\n  \"sub\": \"jim\"\n}\n</code></pre> <p>Note</p> <p>The <code>auth_time_human</code>, <code>exp_human</code>, <code>iat_human</code>, and <code>rat_human</code> fields are not actual claims but human-readable values added by the decoder to aid interpretation of the corresponding timestamp values.</p> <p>There is also a shortcut (<code>-d</code>) for this command:</p> <pre><code>kc token --issuerURL https://kubauth.ingress.kubo6.mbp --clientId public -d\n</code></pre> <p>Note: This option skips the JWT header.</p>"},{"location":"30-user-guide/120-tokens-and-claims/#claims","title":"Claims","text":"<p>A set of 'system' claims are provided by the OIDC server. You can find a description of most standard claims here.</p> <p>Another important claim is <code>sub</code>, which stands for 'subject' and represents the user's login.</p> <p>Now, run the previous command again, but use <code>john/john123</code> when prompted for login:</p> <pre><code>JWT Payload:\n{\n  \"at_hash\": \"fdg2po7ht7lBaFFvgXg14A\",\n  \"aud\": [\n    \"public\"\n  ],\n  \"auth_time\": 1761575699,\n  \"auth_time_human\": \"2025-10-27 14:34:59 UTC\",\n  \"azp\": \"public\",\n  \"email\": \"johnd@mycompany.com\",\n  \"emails\": [\n    \"johnd@mycompany.com\"\n  ],\n  \"exp\": 1761579299,\n  \"exp_human\": \"2025-10-27 15:34:59 UTC\",\n  \"iat\": 1761575699,\n  \"iat_human\": \"2025-10-27 14:34:59 UTC\",\n  \"iss\": \"https://kubauth.ingress.kubo6.mbp\",\n  \"jti\": \"822ed082-e615-4153-ad7e-d623df491253\",\n  \"name\": \"John DOE\",\n  \"office\": \"208G\",\n  \"rat\": 1761575699,\n  \"rat_human\": \"2025-10-27 14:34:59 UTC\",\n  \"sub\": \"john\"\n}\n</code></pre> <p>Kubauth has added several new claims derived from the <code>User</code> resource definition:</p> <ul> <li><code>name</code>: The <code>spec.name</code> property, containing the user's full name.</li> <li><code>emails</code>: The <code>spec.emails</code> list.</li> <li><code>email</code>: The first email from the emails list.</li> <li><code>office</code>: Content from the <code>spec.claims</code> property, which can contain any valid map values.</li> </ul> <p>The resulting claim set is the result of merging:</p> <ul> <li>An initial set of system claims (<code>aud</code>, <code>azp</code>, <code>exp</code>, <code>iss</code>, ...)</li> <li>Claims added by Kubauth from the user CRD definition:<ul> <li><code>name</code> from <code>spec.name</code></li> <li><code>emails</code> from <code>spec.emails</code></li> <li><code>groups</code> described in a following chapter</li> </ul> </li> <li>The contents of the user's <code>spec.claims</code></li> </ul> <p>Warning</p> <p>In the current version, claims are not filtered by scope. In other words, all user claims are included in the ID token.</p>"},{"location":"30-user-guide/130-audit/","title":"Audit","text":"<p>Kubauth records all login attempts. You can display them using the following <code>kc</code> subcommand:</p> <pre><code>kc audit logins\n</code></pre> <pre><code>WHEN           LOGIN   STATUS            UID   NAME       GROUPS   CLAIMS              EMAILS                  AUTH\nMon 12:22:31   jim     passwordChecked   -                []       {}                  []                      \nMon 12:58:29   john    passwordChecked   -     John DOE   []       {\"office\":\"208G\"}   [johnd@mycompany.com]   \nMon 15:34:59   john    passwordChecked   -     John DOE   []       {\"office\":\"208G\"}   [johnd@mycompany.com]   \n</code></pre> <p>Note</p> <p>The claims stored in audit records are only those defined in the User Custom Resource.</p> <p>Each attempt is stored as a Kubernetes resource <code>LoginAttempt.kubauth.kubotal.io</code> in the <code>kubauth-audit</code> namespace:</p> <pre><code>kubectl -n kubauth-audit get loginattempts\n</code></pre> <pre><code>NAME                           LOGIN   NAME       STATUS            AUTHORITY   AGE\njim-2025-10-27-11-22-31-017    jim                passwordChecked               3h41m\njohn-2025-10-27-11-58-29-588   john    John DOE   passwordChecked               3h5m\njohn-2025-10-27-14-34-59-923   john    John DOE   passwordChecked               28m\n</code></pre>"},{"location":"30-user-guide/130-audit/#configuration","title":"Configuration","text":"<p>The audit history is cleaned every 5 minutes by removing all records older than 8 hours. This can be modified using Helm chart configuration:</p> values.yaml <pre><code>oidc:\n  issuer: https://kubauth.ingress.kubo6.mbp\n  postLogoutURL: https://kubauth.ingress.kubo6.mbp/index\n  ...\naudit:\n  namespace: kubauth-audit\n  createNamespace: true\n  cleaner:\n    recordLifetime: \"8h\"\n    cleanupPeriod: \"5m\"\n</code></pre>"},{"location":"30-user-guide/140-sso/","title":"SSO Session","text":"<p>Until now, we have been prompted with a login dialog each time we issued a <code>kc token ...</code> command.</p> <p>On the Kubauth login page, there is a \"Remember me\" checkbox:</p> <p></p> <p>When checked, a session cookie is set, and subsequent login attempts will proceed automatically using the same user credentials.</p> <p>You can verify this by launching several <code>kc token ...</code> commands.</p> <p>The session cookie is associated only with the login page and is independent of the client application. This enables cross-application Single Sign-On (SSO).</p>"},{"location":"30-user-guide/140-sso/#logout","title":"Logout","text":"<p>What if you want to log in with different user credentials?</p> <p>You must first log out. This can be accomplished with another <code>kc</code> subcommand:</p> <p><pre><code>kc logout --issuerURL https://kubauth.ingress.kubo6.mbp \n</code></pre> <pre><code>No OIDC configuration found in kubeconfig\nOpening browser to logout endpoint: https://kubauth.ingress.kubo6.mbp/oauth2/logout\n</code></pre></p> <p>Disregard the first message about kubeconfig. This will be explained later in the Kubernetes integration section.</p> <p>As indicated, a browser should open to call the logout URL.</p> <p></p>"},{"location":"30-user-guide/140-sso/#session-storage","title":"Session Storage","text":"<p>Sessions are persisted as Kubernetes resources:</p> <p><pre><code>kubectl -n kubauth-sso get ssosessions\n</code></pre> <pre><code>NAME                                                                 LOGIN   NAME       DEADLINE               AGE\nh-6d4d8f33c407a727857ba335d257a04d6d0116c40fa81c26903bb9469139563c   john    John DOE   2025-10-28T00:19:44Z   34s\nh-d13bc676b003a200aca5051558b2cd21eccb44f557bee058df00aa3eb6d2bd22   jim                2025-10-28T00:19:13Z   65s\n</code></pre></p> <p>Manually deleting a session resource is an alternative method to terminate a session.</p>"},{"location":"30-user-guide/140-sso/#configuration","title":"Configuration","text":"<p>SSO configuration can be modified using Helm chart values:</p> values.yaml <pre><code>oidc:\n  issuer: https://kubauth.ingress.kubo6.mbp\n  postLogoutURL: https://kubauth.ingress.kubo6.mbp/index\n  ...\n  sso:\n    namespace: kubauth-sso\n    createNamespace: true\n    lifeTime: \"8h\"\n    sticky: true\n</code></pre> <ul> <li><code>namespace</code>: Specifies the namespace where SSO sessions are persisted, and enables its creation during Kubauth deployment.</li> <li><code>lifeTime</code>: Sets the session duration. This is an absolute duration with no idle timeout.</li> <li><code>sticky</code>: When true, the session cookie is persistent. When false, the session expires when the browser is closed.</li> </ul>"},{"location":"30-user-guide/150-users-groups/","title":"User Groups","text":"<p>For most applications, a key attribute of a user is the groups they belong to. To handle this, Kubauth user management supports a Custom Resource: <code>GroupBinding.kubauth.kubotal.io</code></p>"},{"location":"30-user-guide/150-users-groups/#groupbinding","title":"GroupBinding","text":"<p>Here is a sample manifest:</p> group1.yaml <pre><code>---\napiVersion: kubauth.kubotal.io/v1alpha1\nkind: GroupBinding\nmetadata:\n  name: jim-dev\n  namespace: kubauth-users\nspec:\n  user: jim\n  group: devs\n</code></pre> <p>This associates the user <code>jim</code> with the group <code>devs</code>. Note that there is no explicit creation of a <code>devs</code> group. With Kubauth, a group exists simply by being referenced in a <code>GroupBinding</code>.</p> <p>Note</p> <p>Generally, Kubernetes does not enforce referential integrity when creating resources that reference other resources. For example, the following will succeed:</p> <pre><code>kubectl -n mynamespace create rolebinding missing-integrity --role=unexisting-role --group=unexisting-group\n\nrolebinding.rbac.authorization.k8s.io/missing-integrity created\n</code></pre> <p>The referenced resource might be created later, or the reference might never be used. This is by design in Kubernetes, and Kubauth follows the same pattern.</p> <p>Apply the manifest:</p> <p><pre><code>kubectl apply -f group1.yaml\n</code></pre> <pre><code>groupbinding.kubauth.kubotal.io/jim-dev created\n</code></pre></p> <p>Now, log in with the <code>jim</code> account:</p> <pre><code>kc token --issuerURL https://kubauth.ingress.kubo6.mbp --clientId public -d\n</code></pre> <p>When inspecting the decoded JWT token, you should now find a <code>groups</code> claim:</p> <pre><code>.....\nJWT Payload:\n{\n  \"at_hash\": \"bHHRRCaQSInJLqDviiW4Ag\",\n  \"aud\": [\n    \"public\"\n  ],\n  \"auth_time\": 1761643474,\n  \"auth_time_human\": \"2025-10-28 09:24:34 UTC\",\n  \"azp\": \"public\",\n  \"exp\": 1761647074,\n  \"exp_human\": \"2025-10-28 10:24:34 UTC\",\n  \"groups\": [\n    \"devs\"\n  ],\n  \"iat\": 1761643474,\n  \"iat_human\": \"2025-10-28 09:24:34 UTC\",\n  \"iss\": \"https://kubauth.ingress.kubo6.mbp\",\n  \"jti\": \"4a3aed23-e2df-474c-9c26-d8f275d0f51f\",\n  \"rat\": 1761643474,\n  \"rat_human\": \"2025-10-28 09:24:34 UTC\",\n  \"sub\": \"jim\"\n}\n</code></pre> <p>This claim has been added by Kubauth based on the <code>GroupBinding</code> resource.</p> <p>Question</p> <p>What if a <code>groups</code> claim is already defined in the <code>spec.claims</code> of the user entity?</p> <p>Answer: The <code>User.spec.claims.groups</code> value is overwritten.</p>"},{"location":"30-user-guide/150-users-groups/#group-custom-resource","title":"Group Custom Resource","text":"<p>Kubauth also allows explicit creation of <code>Group.kubauth.kubotal.io</code> entities.</p> <p>There are two reasons to do this:</p> <ul> <li>Documentation, by setting a <code>spec.comment</code> attribute on the <code>Group</code> resource.</li> <li>Define a set of claims that will be applied to all group members.</li> </ul> <p>For example, the following manifest will:</p> <ul> <li>Associate user <code>john</code> with the <code>devs</code> group defined previously.</li> <li>Associate user <code>john</code> with a newly created <code>ops</code> group.</li> <li>Explicitly create the <code>ops</code> group:</li> <li>With a <code>spec.comment</code></li> <li>With a <code>spec.claims.accessProfile</code> that will be applied to all members.</li> </ul> group2.yaml <pre><code>---\napiVersion: kubauth.kubotal.io/v1alpha1\nkind: GroupBinding\nmetadata:\n  name: john-dev\n  namespace: kubauth-users\nspec:\n  user: john\n  group: devs\n\n---\napiVersion: kubauth.kubotal.io/v1alpha1\nkind: GroupBinding\nmetadata:\n  name: john-ops\n  namespace: kubauth-users\nspec:\n  user: john\n  group: ops\n\n---\napiVersion: kubauth.kubotal.io/v1alpha1\nkind: Group\nmetadata:\n  name: ops\n  namespace: kubauth-users\nspec:\n  comment:\n  claims:\n    accessProfile: p24x7\n</code></pre> <p>Apply it:</p> <p><pre><code>kubectl apply -f group2.yaml\n</code></pre> <pre><code>groupbinding.kubauth.kubotal.io/john-dev created\ngroupbinding.kubauth.kubotal.io/john-ops created\ngroup.kubauth.kubotal.io/ops created\n</code></pre></p> <p>Now, log in with the <code>john</code> account:</p> <pre><code>kc token --issuerURL https://kubauth.ingress.kubo6.mbp --clientId public -d\n</code></pre> <pre><code>.....\nJWT Payload:\n{\n  \"accessProfile\": \"p24x7\",\n  \"at_hash\": \"jUGx994P_ESx3KtujtlFLA\",\n  \"aud\": [\n    \"public\"\n  ],\n  \"auth_time\": 1761647376,\n  \"auth_time_human\": \"2025-10-28 10:29:36 UTC\",\n  \"azp\": \"public\",\n  \"email\": \"johnd@mycompany.com\",\n  \"emails\": [\n    \"johnd@mycompany.com\"\n  ],\n  \"exp\": 1761650976,\n  \"exp_human\": \"2025-10-28 11:29:36 UTC\",\n  \"groups\": [\n    \"devs\",\n    \"ops\"\n  ],\n  \"iat\": 1761647376,\n  \"iat_human\": \"2025-10-28 10:29:36 UTC\",\n  \"iss\": \"https://kubauth.ingress.kubo6.mbp\",\n  \"jti\": \"629164c8-75b5-4e16-850f-0975f0afc508\",\n  \"name\": \"John DOE\",\n  \"office\": \"208G\",\n  \"rat\": 1761647376,\n  \"rat_human\": \"2025-10-28 10:29:36 UTC\",\n  \"sub\": \"john\"\n}\n</code></pre> <p>When inspecting the decoded JWT token, you should verify that:</p> <ul> <li>The <code>groups</code> claim now lists two values.</li> <li>The <code>accessProfile</code> claim is set with the appropriate value.</li> </ul>"},{"location":"30-user-guide/160-password-grant/","title":"Password Grant (ROPC)","text":"<p>OAuth's Resource Owner Password Credentials (ROPC) grant type, also known as the password grant, was included in the original OAuth 2.0 specification in 2012 as a temporary migration path. It was designed to help legacy applications transition from HTTP Basic Authentication or direct credential sharing to an OAuth token-based architecture.</p> <p>The OAuth 2.0 Security Best Current Practice (BCP) has since deprecated this flow, and OAuth 2.1 removes it entirely due to several fundamental security concerns:</p> <ul> <li>Credentials exposure: The client application directly handles user passwords</li> <li>Phishing risk: Users are trained to enter passwords into applications</li> <li>Credential theft: If the client is compromised, user passwords are exposed</li> </ul> <p>Despite deprecation, there are legitimate scenarios where ROPC may be the most pragmatic solution:</p> <ul> <li>Constrained CLI/headless sessions: When an interactive browser is unavailable (air-gapped shells, jump hosts)</li> <li>Automated scripts and CI/CD pipelines (where service accounts aren't suitable)</li> <li>Terminal-only environments on embedded systems</li> <li>Legacy migrations: Maintaining existing UX while transitioning server-side to OAuth/OIDC tokens</li> </ul> <p>For these reasons, ROPC/Password Grant is supported by Kubauth.</p>"},{"location":"30-user-guide/160-password-grant/#configuration","title":"Configuration","text":"<p>While supported, ROPC is disabled by default. To use it, you must enable it at two levels.</p> <p>First, at the global level, by setting a Helm chart configuration value:</p> values.yaml <pre><code>oidc:\n  issuer: https://kubauth.ingress.kubo6.mbp\n  postLogoutURL: https://kubauth.ingress.kubo6.mbp/index\n  ....\n  allowPasswordGrant: true\n</code></pre> <p>Then, at the client definition level. Here is a modified version of our public client:</p> client-public.yaml <pre><code>apiVersion: kubauth.kubotal.io/v1alpha1\nkind: OidcClient\nmetadata:\n  name: public\n  namespace: kubauth-oidc\nspec:\n  redirectURIs:\n    - \"http://127.0.0.1:9921/callback\"\n  grantTypes: [ \"refresh_token\", \"authorization_code\", \"password\" ]\n  responseTypes: [ \"id_token\", \"code\", \"token\", \"id_token token\", \"code id_token\", \"code token\", \"code id_token token\" ]\n  scopes: [ \"openid\", \"offline\", \"profile\", \"groups\", \"email\", \"offline_access\" ]\n  description: A test OIDC public client\n  public: true\n\n  # hashedSecret: \"$2a$12$9vdc.xb3Zf4ts/C2pSvIOuGmFiv0EStBJWslaaycavblaIjYZ9Mia\"\n  # accessTokenLifespan: 1h\n  # refreshTokenLifespan: 1h\n  # idTokenLifespan: 1h\n</code></pre> <p>We simply added <code>\"password\"</code> to the <code>grantTypes</code> list.</p> <p>Note</p> <p>The <code>redirectURIs</code> list is not used for the ROPC flow. Retaining the value allows the client to continue using the standard <code>authorization_code</code> flow.</p> <p>For a client intended exclusively for ROPC flow, <code>redirectURIs</code> can be empty (but must be defined as <code>redirectURIs: []</code> for syntax consistency).</p> <p>Once these two modifications are successfully applied (<code>helm upgrade ...</code> and <code>kubectl apply ...</code>), you can use this flow.</p>"},{"location":"30-user-guide/160-password-grant/#kc-token-nui","title":"kc token-nui","text":"<p>Similar to the <code>kc token</code> subcommand, there is a <code>kc token-nui</code> subcommand to generate tokens using the ROPC flow:</p> <pre><code>kc token-nui --issuerURL https://kubauth.ingress.kubo6.mbp --clientId public\nLogin:jim\nPassword:\n</code></pre> <p>If authentication is successful, you will receive the tokens:</p> <pre><code>Access token: ory_at_LAhtO0e8T8-V2wLZ72V0G98jKMJEpYQLH6tm6Aeg_Lw.yZhdVxRSMGnp6FlM63ErD6Lj8vpyJPxxTafNbygAvTE\nRefresh token: ory_rt_kP1rTr6eF_AgdVvUtzfEKywhIddEK2cjDRC9EmkT0Hw.OeeTl_eAgq7jmBbYg6u7MT3P_ukg117nE8RxvZShZRM\nID token: eyJhbGciOiJSUzI1NiIsImtpZCI6ImY0Y2NkNDU0LWYzYTgtNDQ3Zi1hN2MzLTY3ZmY5MzUxMzZiMSIsInR5cCI6IkpXVCJ9.eyJhdWQiOlsicHVibGljIl0sImF1dGhfdGltZSI6MTc2MTY2MDI4NSwiYXpwIjoicHVibGljIiwiZXhwIjoxNzYxNjYzODg1LCJncm91cHMiOlsiZGV2cyJdLCJpYXQiOjE3NjE2NjAyODUsImlzcyI6Imh0dHBzOi8va3ViYXV0aC5pbmdyZXNzLmt1Ym82Lm1icCIsImp0aSI6IjFmMTRiYjkxLTQyYTQtNGUwZC1iNDEzLWE0MDAwN2E4ZmU0ZiIsInJhdCI6MTc2MTY2MDI4NSwic3ViIjoiamltIn0.PaR36uaDqZ0iLm--KZaYjNrD1bE5KI3p5Djo535ig6pC35QakhV4swikN2860koCALiq_Sl5A8Ki0Q7JLNGUp8h67E_ebcs4KVYzbEJq4sK6YfsCRgEEulijiX060DXl76u3hsPq2LEeKo710iIzPTFy_zy9GRTw7vbjk9_NJm3XbVqEw339H-l-yiUO3MKuS7MF6w77tMpw3NHIJ_uDSUC6ZNbXmsGts6N0K2Dy_lEtjij8KG3_zmRDszmV-CzbysUGBy5n0c8LemVRit6JlbwIJs8NvqB-zW_CZhty-3MEJOWitCAdmgcJmLYT_ZRG_YqNnWAWEdwWlZFg_8I6yg\nExpire in: 1h0m0s\n</code></pre> <p>If you receive a response like the following:</p> <pre><code>token request failed with status 403: {\"error\":\"request_forbidden\",\"error_description\":\"The request is not allowed. This server does not  allow to use authorization grant 'password'. Check server configuration\"}\n</code></pre> <p>the configuration steps described above have not been applied successfully.</p> <p>For batch processing, the <code>kc token-nui</code> subcommand also supports <code>--login</code> and <code>--password</code> options, along with most of the same options as <code>kc token</code>:</p> <p><pre><code>kc token-nui --issuerURL https://kubauth.ingress.kubo6.mbp --clientId public \\\n    --login jim --password jim123 --onlyIDToken\n</code></pre> <pre><code>eyJhbGciOiJSUzI1NiIsImtpZCI6ImY0Y2NkNDU0LWYzYTgtNDQ3Zi1hN2MzLTY3ZmY5MzUxMzZiMSIsInR5cCI6IkpXVCJ9.eyJhdWQiOlsicHVibGljIl0sImF1dGhfdGltZSI6MTc2MTY2MDYxNywiYXpwIjoicHVibGljIiwiZXhwIjoxNzYxNjY0MjE3LCJncm91cHMiOlsiZGV2cyJdLCJpYXQiOjE3NjE2NjA2MTcsImlzcyI6Imh0dHBzOi8va3ViYXV0aC5pbmdyZXNzLmt1Ym82Lm1icCIsImp0aSI6IjY0YjcwNmQ5LWI1MjgtNGRlMy1iM2M2LTVkMjc3MTZjN2FjZSIsInJhdCI6MTc2MTY2MDYxNywic3ViIjoiamltIn0.G2VkVCsWVG1kNFXLp1lWu1ehXzkMJFWDQVANpR1wC8OGpBnwVaoTwRoTjAUw_yUrJu1u_m-NLWyzLIflJfmrTPTN3iz7Jsqc77iFoOmkOBUkOPvp9q66Uu3cbP3e52cYJcgOb5RcvaAOcBdp32zYotSLAPcRSHhuc1K2sdHg96bhU9dR5zs9Z29iXOzez4Bvq2haJpvjz4slZ2FZjSSkswyUlQQdfxoGC_VZgXyAJOycVK-e_oHJSOT1dtCi2y9QEHHHRRX3XpAqvZ86Q3Xk0Loxb03z6VDwzKeH1tYgplAcXTqb9jMmWFdh31JHZGd82S6v9lwUatrEuqo6ZXJR2A\n</code></pre></p>"},{"location":"30-user-guide/170-ldap-connector/","title":"LDAP Connector","text":""},{"location":"30-user-guide/170-ldap-connector/#kubauth-architecture","title":"Kubauth Architecture","text":"<p>If you inspect the <code>kubauth</code> pod, you will find it currently consists of 3 containers:</p> <p><pre><code>kubectl -n kubauth get pod -l app.kubernetes.io/instance=kubauth\n</code></pre> <pre><code>NAME                       READY   STATUS    RESTARTS   AGE\nkubauth-65dbdbb447-bl4qz   3/3     Running   0          17m\n</code></pre></p> <p>List the containers:</p> <p><pre><code>kubectl -n kubauth get pod -l app.kubernetes.io/instance=kubauth -o jsonpath='{range .items[0].spec.containers[*]}{.name}{\"\\n\"}{end}'\n</code></pre> <pre><code>oidc\naudit\nucrd\n</code></pre></p> <p>Kubauth is built on a modular architecture. The following diagram describes the default configuration:</p> <p></p> <p>All modules communicate using the same simple identity protocol with a single exchange type:</p> <ul> <li>The Request provides a login and optionally a password</li> <li>The Response provides a status (NotFound, PasswordFail, PasswordChecked, ...) and all available user-related information (Name, Emails, Claims, ...)</li> </ul> <p>All communication between modules (containers) uses <code>localhost</code>, keeping it private and not exposed outside the pod.</p> <p>Each module (container) listens on a specific port:</p> <ul> <li>The <code>oidc</code> module handles all user interaction and initiates identity requests</li> <li>The <code>audit</code> module is a transparent pass-through for the protocol, logging all requests to provide the audit feature described previously</li> <li>The <code>ucrd</code> module accesses the User, Group, and GroupBinding Custom Resources to build the response</li> </ul> <p>All these modules are built into the kubauth image. Assembly is performed by the Helm chart.</p> <p></p> <p>There is another built-in module: <code>ldap</code>, which implements the identity protocol by connecting to an external LDAP server.</p> <p>Here is the new configuration:</p> <p></p> <p>To switch to this configuration, you must:</p> <ul> <li>Disable the <code>ucrd</code> module</li> <li>Enable the <code>ldap</code> module</li> <li>Configure the <code>audit</code> module to request the <code>ldap</code> module (listening on port 6803) instead of <code>ucrd</code> (which listened on port 6802)</li> <li>Configure the <code>ldap</code> module for your target LDAP server</li> </ul> <p></p> <p>The <code>values-ldap.yaml</code> file below implements this configuration.</p> <p>The LDAP configuration itself is tailored for an OpenLDAP server deployed as described in Appendix/OpenLDAP Deployment.</p> values-ldap.yaml <pre><code>oidc:\n  issuer: https://kubauth.ingress.kubo6.mbp\n  postLogoutURL: https://kubauth.ingress.kubo6.mbp/index\n  allowPasswordGrant: true\n\n  ingress:\n    host: kubauth.ingress.kubo6.mbp\n\n  server:\n    certificateIssuer: cluster-odp\n\naudit:\n  idProvider:\n    baseURL: http://localhost:6803  # ldap provider listening port\n\nucrd:\n  enabled: false\n\nldap:\n  enabled: true\n  ldap:\n    host: openldap.openldap.svc\n    insecureNoSSL: true\n    bindDN: cn=admin,dc=mycompany,dc=com\n    bindPW: admin123\n    timeoutSec: 10\n    groupSearch:\n      baseDN: ou=Groups,dc=mycompany,dc=com\n      filter: (objectClass=posixgroup)\n      linkGroupAttr: memberUid\n      linkUserAttr: uid\n      nameAttr: cn\n    userSearch:\n      baseDN: ou=Users,dc=mycompany,dc=com\n      cnAttr: cn\n      emailAttr: mail\n      filter: (objectClass=inetOrgPerson)\n      loginAttr: uid\n      numericalIdAttr: uidNumber\n</code></pre>"},{"location":"30-user-guide/170-ldap-connector/#ldap-configuration","title":"LDAP Configuration","text":"<p>If you need to configure a different type of LDAP server, each property is documented in the Helm chart values file. For convenience, the relevant extract is provided below:</p> values-ldap-commented.yaml <pre><code>.......\nldap:\n  enabled: true\n  ldap:\n    # The host and port of the LDAP server.\n    host:\n    #  If port isn't supplied, it will be guessed based on the TLS configuration. (389 or 636).\n    port:\n\n    # Timeout on connection to ldap server. Default to 10\n    timeoutSec:\n    # Required if LDAP host does not use TLS.\n    insecureNoSSL:\n    # Don't verify the CA.\n    insecureSkipVerify:\n    # Connect to the insecure port then issue a StartTLS command to negotiate a\n    # secure connection. If unsupplied secure connections will use the LDAPS protocol.\n    startTLS:\n\n    # Only one of rootCaData, rootCaPath or rootCaSecret must be defined\n    # Path to a trusted root certificate file.\n    rootCaPath:\n    # Base64 encoded PEM data containing root CAs.\n    rootCaData:\n    # A secret hosting the CA, as base64 encoded value, at the 'rootCaSecretPath' location.\n    # The secret can be generated using trust-manager from cert-manager\n    rootCaSecret:\n    rootCaSecretPath:  # Default to 'ca.crt'\n\n    # Path to a client cert file. If LDAP server require a certificate based client authentication\n    clientCert:\n    # Path to a client private key file. If LDAP server require a certificate based client authentication\n    clientKey:\n\n    # BindDN and BindPW for an application service account. The connector uses these\n    # credentials to search for users and groups.\n    bindDN:\n    bindPW:\n\n    groupSearch:\n      # BaseDN to start the search from. For example \"cn=groups,dc=example,dc=com\"\n      baseDN:\n      # Optional filter to apply when searching the directory. For example \"(objectClass=posixGroup)\"\n      filter:\n      # The filter for group/user relationship will be: (&lt;linkGroupAttr&gt;=&lt;Value of LinkUserAttr for the user&gt;)\n      # If there is several value for LinkUserAttr, we will loop on.\n      linkGroupAttr:\n      linkUserAttr:\n      # The attribute of the group that represents its name.\n      nameAttr:\n      # Defaults to \"sub\"\n      scope:\n    userSearch:\n      # BaseDN to start the search from. For example \"cn=users,dc=example,dc=com\"\n      baseDN:\n      #  Optional filter to apply when searching the directory. For example \"(objectClass=person)\"\n      filter:\n      # Attribute to match against the login. This will be translated and combined with the other filter as \"(&lt;loginAttr&gt;=&lt;login&gt;)\".\n      loginAttr:\n      # Can either be:\n      #   \"sub\" - search the whole sub tree\n      #   \"one\" - only search one level\n      scope:\n      # The attribute providing the numerical user ID\n      numericalIdAttr:\n      # The attribute providing the user's email\n      emailAttr:\n      # The attribute providing the user's common name\n      cnAttr:\n</code></pre>"},{"location":"30-user-guide/170-ldap-connector/#deployment","title":"Deployment","text":"<p>Once your configuration is ready, proceed with deployment by running the <code>helm upgrade ...</code> command:</p> <pre><code>helm -n kubauth upgrade -i kubauth --values ./values-ldap.yaml oci://quay.io/kubauth/charts/kubauth --version 0.1.2-snapshot --create-namespace --wait\n</code></pre> <p>Verify which containers have been deployed:</p> <p><pre><code>kubectl -n kubauth get pod -l app.kubernetes.io/instance=kubauth -o jsonpath='{range .items[0].spec.containers[*]}{.name}{\"\\n\"}{end}'\n</code></pre> <pre><code>oidc\naudit\nldap\n</code></pre></p> <p>Test authentication:</p> <p><pre><code>kc token --issuerURL https://kubauth.ingress.kubo6.mbp --clientId public -d\n</code></pre> <pre><code>If browser doesn't open automatically, visit: http://127.0.0.1:9921\n</code></pre></p> <p>If you enter <code>jim/jim123</code>, the login will fail.</p> <p>However, if you enter credentials for a user defined in your LDAP server, the login should succeed. For example, using <code>fred/fred123</code> (if using the sample LDAP configuration defined in the appendix):</p> <pre><code>Access token: ory_at_2vDnbRl0-cazsy2ZkIV_3bG8blZzgA5Cc0FxKXg5g6g.IvAqwgU04BnmBBoO_IPNt3UtIkiAWfJlgcj5WyMPsPk\nRefresh token: ory_rt_UQQoBvf3Pkk1Yr6W3JCO_aShfX_28e8tAnxcMUQGjJE.I-P_3XJxVwPRmrUDVOXtt0ofS_G2MISSVRMoL48ZIAg\nID token: eyJhbGciOiJSUzI1NiIsImtpZCI6ImY0Y2NkNDU0LWYzYTgtNDQ3Zi1hN2MzLTY3ZmY5MzUxMzZiMSIsInR5cCI6IkpXVCJ9.eyJhdF9oYXNoIjoiM0RMYWZJMzdNZnNGZjVWOUN6QU1hUSIsImF1ZCI6WyJwdWJsaWMiXSwiYXV0aF90aW1lIjoxNzYxNjc0MzU2LCJhenAiOiJwdWJsaWMiLCJlbWFpbCI6ImZyZWRAbXljb21wYW55LmNvbSIsImVtYWlscyI6WyJmcmVkQG15Y29tcGFueS5jb20iXSwiZXhwIjoxNzYxNjc3OTU2LCJncm91cHMiOlsibWFuYWdlcnMiLCJzdGFmZiJdLCJpYXQiOjE3NjE2NzQzNTYsImlzcyI6Imh0dHBzOi8va3ViYXV0aC5pbmdyZXNzLmt1Ym82Lm1icCIsImp0aSI6IjE3YjQxMzk1LTU4MmUtNDM3ZC05YTA2LWNkYWY5NjM1NjdjZiIsIm5hbWUiOiJGcmVkIEFTVEVSIiwicmF0IjoxNzYxNjc0MzU2LCJzdWIiOiJmcmVkIn0.ZSnv4godrQOkrYNaEteOi85N-M9b4UKOI8zj0sorrD5Az1_xezINWiSRkrN2vLq9DtMKXZUBNjr41m4dW83xTsex8Tq_lEtisJP8woZzXzUpv1HnK2_RJiX_euGM2RSUJNaih4vpeDOPBhZQPUTkCIqnH_kus2dLuh84KGmcpLFC7vG60JW1lqRlx1Wb5ggmZmSFHC6k44Lx0bkihhpofiJg0QL1UoxmN1elixOegxOs0g_vxjdoDC3jNVOWONR6qVpvG7YRa25FgNPvfIV1XWeIP9upq0Yn_LNxLXuNFY_ysdw4lIQH2aEO58118KwB5eB8UQRnZJXmnAyKF-OU5Q\nExpire in: 1h0m0s\nJWT Payload:\n{\n  \"at_hash\": \"3DLafI37MfsFf5V9CzAMaQ\",\n  \"aud\": [\n    \"public\"\n  ],\n  \"auth_time\": 1761674356,\n  \"auth_time_human\": \"2025-10-28 17:59:16 UTC\",\n  \"azp\": \"public\",\n  \"email\": \"fred@mycompany.com\",\n  \"emails\": [\n    \"fred@mycompany.com\"\n  ],\n  \"exp\": 1761677956,\n  \"exp_human\": \"2025-10-28 18:59:16 UTC\",\n  \"groups\": [\n    \"managers\",\n    \"staff\"\n  ],\n  \"iat\": 1761674356,\n  \"iat_human\": \"2025-10-28 17:59:16 UTC\",\n  \"iss\": \"https://kubauth.ingress.kubo6.mbp\",\n  \"jti\": \"17b41395-582e-437d-9a06-cdaf963567cf\",\n  \"name\": \"Fred ASTER\",\n  \"rat\": 1761674356,\n  \"rat_human\": \"2025-10-28 17:59:16 UTC\",\n  \"sub\": \"fred\"\n}\n</code></pre> <p>Check the audit trail:</p> <p><pre><code>kc audit logins\n</code></pre> <pre><code>WHEN           LOGIN   STATUS            UID   NAME         GROUPS             CLAIMS                                      EMAILS                  AUTH\nTue 18:59:16   fred    passwordChecked   -     Fred ASTER   [staff,managers]   {}                                          [fred@mycompany.com]    \nTue 19:02:20   jim     userNotFound      -                  []                 {}                                          []                    \n</code></pre></p>"},{"location":"30-user-guide/180-several-id-providers/","title":"Multiple Identity Providers","text":"<p>In the previous chapter, we replaced our local user database with an external LDAP server. But what if we want to have both?</p>"},{"location":"30-user-guide/180-several-id-providers/#configuration","title":"Configuration","text":"<p>Kubauth provides another built-in module: the <code>merger</code>.</p> <p>Here is our target architecture:</p> <p></p> <p>Here is a values file to implement it:</p> values-merger.yaml <pre><code>oidc:\n  issuer: https://kubauth.ingress.kubo6.mbp\n  postLogoutURL: https://kubauth.ingress.kubo6.mbp/index\n  allowPasswordGrant: true\n\n  ingress:\n    host: kubauth.ingress.kubo6.mbp\n\n  server:\n    certificateIssuer: cluster-odp\n\naudit:\n  idProvider:\n    baseURL: http://localhost:6804 # Merger listening port\n\nmerger:\n  enabled: true\n  idProviders:\n    - name: ldap\n      httpConfig:\n        baseURL: http://localhost:6803 # ldap provider listening port\n    - name: ucrd\n      httpConfig:\n        baseURL: http://localhost:6802 # ucrd provider listening port\n\nucrd:\n  enabled: true\n\nldap:\n  enabled: true\n  ldap:\n    host: openldap.openldap.svc\n    insecureNoSSL: true\n    bindDN: cn=admin,dc=mycompany,dc=com\n    bindPW: admin123\n    timeoutSec: 10\n    groupSearch:\n      baseDN: ou=Groups,dc=mycompany,dc=com\n      filter: (objectClass=posixgroup)\n      linkGroupAttr: memberUid\n      linkUserAttr: uid\n      nameAttr: cn\n    userSearch:\n      baseDN: ou=Users,dc=mycompany,dc=com\n      cnAttr: cn\n      emailAttr: mail\n      filter: (objectClass=inetOrgPerson)\n      loginAttr: uid\n      numericalIdAttr: uidNumber\n</code></pre> <ul> <li>The <code>audit</code> module is now connected to the <code>merger</code> module.</li> <li>The <code>merger</code> module is configured with a list of two identity providers. We will see in the next chapter that order is important.</li> <li>The <code>ucrd</code> module is enabled.</li> <li>The <code>ldap</code> module configuration is the same as in the previous chapter.</li> </ul> <p>Once your configuration is ready, proceed with deployment by running the <code>helm upgrade ...</code> command:</p> <pre><code>helm -n kubauth upgrade -i kubauth --values ./values-merger.yaml oci://quay.io/kubauth/charts/kubauth --version 0.1.2-snapshot --create-namespace --wait\n</code></pre> <p>Verify which containers have been deployed:</p> <p><pre><code>kubectl -n kubauth get pod -l app.kubernetes.io/instance=kubauth -o jsonpath='{range .items[0].spec.containers[*]}{.name}{\"\\n\"}{end}'\n</code></pre> <pre><code>oidc\naudit\nmerger\nucrd\nldap\n</code></pre></p> <p>If you have followed this manual, the <code>ucrd</code> module was previously removed, so all its content is gone. You must restore it:</p> <pre><code>kubectl apply -f users.yaml\nkubectl apply -f group1.yaml\nkubectl apply -f group2.yaml \n</code></pre>"},{"location":"30-user-guide/180-several-id-providers/#logins","title":"Logins","text":"<p>Test authentication:</p> <pre><code>kc token --issuerURL https://kubauth.ingress.kubo6.mbp --clientId public -d\n</code></pre> <p>Run this command twice: once with <code>bob/bob123</code> and again with <code>john/john123</code>.</p> <p>Verify that both users' claims are properly populated.</p>"},{"location":"30-user-guide/180-several-id-providers/#audit","title":"Audit","text":"<p>If you review the login attempts:</p> <p><pre><code>kc audit logins\n</code></pre> <pre><code>WHEN           LOGIN   STATUS            UID   NAME         GROUPS       CLAIMS                                      EMAILS                  AUTH\nThu 12:14:32   bob     passwordChecked   -     Bob MORANE   [staff]      {}                                          [bob@mycompany.com]     ldap\nThu 12:14:18   john    passwordChecked   -     John DOE     [devs,ops]   {\"accessProfile\":\"p24x7\",\"office\":\"208G\"}   [johnd@mycompany.com]   ucrd\n</code></pre></p> <p>Notice the rightmost column <code>AUTH</code> (AUTHORITY), which now indicates the identity provider that validated the password.</p>"},{"location":"30-user-guide/190-identity-merging/","title":"Identity Merging","text":"<p>In previous chapters, each user was defined within a specific provider database. However, Kubauth allows properties of a user defined in two (or more) identity providers to be merged.</p> <p>This enables you to, for example, enrich a user profile from a central repository with local (cluster-specific) properties.</p> <p>This is especially useful if you have read-only access to your LDAP server.</p>"},{"location":"30-user-guide/190-identity-merging/#sample-setup","title":"Sample Setup","text":"<p>Here is an example manifest to demonstrate this capability:</p> <p>This assumes Kubauth is configured with both LDAP and local CRD user databases as described in the previous chapter, with Users and Groups sample datasets, and that <code>alice</code> and <code>bob</code> are existing users defined in the LDAP server.</p> ldap-addon.yaml <pre><code>---\napiVersion: kubauth.kubotal.io/v1alpha1\nkind: User\nmetadata:\n  name: alice\n  namespace: kubauth-users\nspec:\n  passwordHash: \"$2a$12$.WUyue3xr.nKuH8Tu0q.T.WF.PKHLZ92g9ewnLoB.27CuMQIdvuza\" # smith123\n  name: Alice SMITH-WESSON\n  claims:\n    office: 312R\n  emails:\n    - alice@mycompany.com\n    - alice.smith@mycompany.com\n\n---\napiVersion: kubauth.kubotal.io/v1alpha1\nkind: GroupBinding\nmetadata:\n  name: bob-ops\n  namespace: kubauth-users\nspec:\n  user: bob\n  group: ops\n</code></pre> <p>This will:</p> <ul> <li>Create a user <code>alice</code> in the Kubernetes CRD user storage (<code>ucrd</code>), duplicating the one in the LDAP directory. The <code>name</code>, <code>claims</code>, and <code>emails</code> properties are provided.</li> <li>Bind the user <code>bob</code> to the group <code>ops</code>. Note that this user does not exist in the <code>ucrd</code> provider.</li> </ul> <p>Apply this manifest:</p> <pre><code>kubectl apply -f ldap-addon.yaml \n</code></pre>"},{"location":"30-user-guide/190-identity-merging/#logins","title":"Logins","text":"<p>To simplify testing, we will use the 'no User Interface' mode of the <code>kc token</code> tool. Remember, this requires specific configuration.</p>"},{"location":"30-user-guide/190-identity-merging/#bob","title":"Bob","text":"<p>First, log in as the <code>bob</code> user:</p> <pre><code>kc token-nui --issuerURL https://kubauth.ingress.kubo6.mbp --clientId public --login bob --password bob123 -d\n</code></pre> <pre><code>JWT Payload:\n{\n  \"accessProfile\": \"p24x7\",\n  \"aud\": [\n    \"public\"\n  ],\n  \"auth_time\": 1761830106,\n  \"auth_time_human\": \"2025-10-30 13:15:06 UTC\",\n  \"authority\": \"ldap\",\n  \"azp\": \"public\",\n  \"email\": \"bob@mycompany.com\",\n  \"emails\": [\n    \"bob@mycompany.com\"\n  ],\n  \"exp\": 1761833706,\n  \"exp_human\": \"2025-10-30 14:15:06 UTC\",\n  \"groups\": [\n    \"ops\",\n    \"staff\"\n  ],\n  \"iat\": 1761830106,\n  \"iat_human\": \"2025-10-30 13:15:06 UTC\",\n  \"iss\": \"https://kubauth.ingress.kubo6.mbp\",\n  \"jti\": \"39600b39-267b-4f31-9179-3f698418e85c\",\n  \"name\": \"Bob MORANE\",\n  \"rat\": 1761830106,\n  \"rat_human\": \"2025-10-30 13:15:06 UTC\",\n  \"sub\": \"bob\"\n}\n</code></pre> <p>You can verify that:</p> <ul> <li>We received a JWT token, so authentication was successful.</li> <li>There is an <code>authority</code> claim. This is added by Kubauth and indicates which provider validated the user's credentials.</li> <li>The <code>groups</code> claim is the concatenation of the group lists from each provider, with de-duplication.</li> <li>There is an <code>accessProfile: p24x7</code> claim. This is a claim granted to all members of the <code>ops</code> group defined in the <code>ucrd</code> provider.</li> </ul> <p>Since it can be difficult to determine where each value originates, Kubauth provides a tool to look up user details:</p> <p><pre><code>kc audit detail bob\n</code></pre> <pre><code>WHEN           LOGIN   STATUS            UID   NAME         GROUPS        CLAIMS                      EMAILS                AUTH\nThu 14:15:06   bob     passwordChecked   -     Bob MORANE   [ops,staff]   {\"accessProfile\":\"p24x7\"}   [bob@mycompany.com]   ldap\nDetail:\nPROVIDER   STATUS            UID   NAME         GROUPS    CLAIMS                      EMAILS\nldap       passwordChecked   -     Bob MORANE   [staff]   {}                          [bob@mycompany.com]\nucrd       userNotFound      -                  [ops]     {\"accessProfile\":\"p24x7\"}   []\n</code></pre></p> <p>This tool looks up the last login for the specified user. It first displays a line in the same format as the <code>kc audit logins</code> command. Then it displays a table showing what information each provider contributed.</p>"},{"location":"30-user-guide/190-identity-merging/#alice","title":"alice","text":"<p>Now, log in as the <code>alice</code> user:</p> <pre><code>kc token-nui --issuerURL https://kubauth.ingress.kubo6.mbp --clientId public --login alice --password alice123 -d\n</code></pre> <pre><code>.....\nJWT Payload:\n{\n  \"aud\": [\n    \"public\"\n  ],\n  \"auth_time\": 1761834557,\n  \"auth_time_human\": \"2025-10-30 14:29:17 UTC\",\n  \"authority\": \"ldap\",\n  \"azp\": \"public\",\n  \"email\": \"alice@mycompany.com\",\n  \"emails\": [\n    \"alice@mycompany.com\",\n    \"alice.smith@mycompany.com\"\n  ],\n  \"exp\": 1761838157,\n  \"exp_human\": \"2025-10-30 15:29:17 UTC\",\n  \"groups\": [\n    \"managers\",\n    \"staff\"\n  ],\n  \"iat\": 1761834557,\n  \"iat_human\": \"2025-10-30 14:29:17 UTC\",\n  \"iss\": \"https://kubauth.ingress.kubo6.mbp\",\n  \"jti\": \"76a841c2-43fa-4635-9702-55c856f75f45\",\n  \"name\": \"Alice SMITH\",\n  \"office\": \"312R\",\n  \"rat\": 1761834557,\n  \"rat_human\": \"2025-10-30 14:29:17 UTC\",\n  \"sub\": \"alice\"\n}\n</code></pre> <p>We can verify that:</p> <ul> <li>We are logged in using credentials from the LDAP server.</li> <li>The <code>authority</code> claim is set to <code>ldap</code>.</li> <li>The <code>office: 312R</code> claim from the <code>ucrd</code> provider is present.</li> <li>The <code>emails</code> claim is the concatenation of the email lists from each provider, with de-duplication.</li> <li>The <code>name</code> claim is from the LDAP definition. While there is a different value in the <code>ucrd</code> database, the LDAP value takes precedence because the LDAP provider is listed first. The CRD value would be used if LDAP did not provide a value.</li> </ul> <p>You can also use <code>kc audit detail ...</code> to understand what happened:</p> <p><pre><code>kc audit detail alice\n</code></pre> <pre><code>WHEN           LOGIN   STATUS            UID   NAME          GROUPS             CLAIMS              EMAILS                                            AUTH\nThu 15:29:17   alice   passwordChecked   -     Alice SMITH   [managers,staff]   {\"office\":\"312R\"}   [alice@mycompany.com,alice.smith@mycompany.com]   ldap\nDetail:\nPROVIDER   STATUS            UID   NAME                 GROUPS             CLAIMS              EMAILS\nldap       passwordChecked   -     Alice SMITH          [staff,managers]   {}                  [alice@mycompany.com]\nucrd       passwordFail      -     Alice SMITH-WESSON   []                 {\"office\":\"312R\"}   [alice@mycompany.com,alice.smith@mycompany.com]\n</code></pre></p>"},{"location":"30-user-guide/190-identity-merging/#alice-2","title":"alice (2)","text":"<p>Now, let's try to log in with the password defined in the <code>ucrd</code> user database:</p> <pre><code>kc token-nui --issuerURL https://kubauth.ingress.kubo6.mbp --clientId public --login alice --password smith123 -d\n</code></pre> <pre><code>token request failed with status 400: {\"error\":\"invalid_grant\",\"error_description\":\"The provided authorization grant \\\n(e.g., authorization code, resource owner credentials) or refresh token is invalid, expired, revoked, \\\ndoes not match the redirection URI used in the authorization request, or was issued to another client. \\\nUnable to authenticate the provided username and password credentials.\"}\n</code></pre> <p><pre><code>kc audit detail alice\n</code></pre> <pre><code>WHEN           LOGIN   STATUS         UID   NAME          GROUPS             CLAIMS              EMAILS                                            AUTH\nThu 16:06:32   alice   passwordFail   -     Alice SMITH   [managers,staff]   {\"office\":\"312R\"}   [alice@mycompany.com,alice.smith@mycompany.com]   ldap\nDetail:\nPROVIDER   STATUS            UID   NAME                 GROUPS             CLAIMS              EMAILS\nldap       passwordFail      -     Alice SMITH          [staff,managers]   {}                  [alice@mycompany.com]\nucrd       passwordChecked   -     Alice SMITH-WESSON   []                 {\"office\":\"312R\"}   [alice@mycompany.com,alice.smith@mycompany.com]\n</code></pre></p> <p>Although the password was validated by the <code>ucrd</code> provider, the login failed. This is intentional behavior: for a user defined in a higher-priority provider, we don't want a secondary provider to allow password changes.</p> <p>In other words, the first provider in the list that defines a password for a given user will validate it (either successfully or not).</p> <p>Note</p> <p>This is why the provider list order is important.</p> <p>This also means the password definition in the Kubernetes CR database for <code>alice</code> is unused.</p>"},{"location":"30-user-guide/190-identity-merging/#john","title":"john","text":"<p>Now, let's try to log in with the <code>john</code> user:</p> <pre><code>kc token-nui --issuerURL https://kubauth.ingress.kubo6.mbp --clientId public --login john --password john123 -d\n</code></pre> <pre><code>.......\nJWT Payload:\n{\n  \"accessProfile\": \"p24x7\",\n  \"aud\": [\n    \"public\"\n  ],\n    .......\n  \"sub\": \"john\"\n}\n</code></pre> <p><pre><code>kc audit detail john\n</code></pre> <pre><code>WHEN           LOGIN   STATUS            UID   NAME       GROUPS       CLAIMS                                      EMAILS                  AUTH\nThu 16:14:04   john    passwordChecked   -     John DOE   [devs,ops]   {\"accessProfile\":\"p24x7\",\"office\":\"208G\"}   [johnd@mycompany.com]   ucrd\nDetail:\nPROVIDER   STATUS            UID   NAME       GROUPS       CLAIMS                                      EMAILS\nldap       userNotFound      -                []           {}                                          []\nucrd       passwordChecked   -     John DOE   [devs,ops]   {\"accessProfile\":\"p24x7\",\"office\":\"208G\"}   [johnd@mycompany.com]\n</code></pre></p> <p>This time, the login is successful. This is because <code>john</code> does not exist in LDAP, so authentication by the <code>ucrd</code> provider is effective.</p> <p>In other words, with this configuration, an administrator who has access to Kubernetes cluster resources but no access to the central LDAP server will be able to create local users, but will be unable to change a global user's password.</p>"},{"location":"30-user-guide/190-identity-merging/#identity-provider-configuration","title":"Identity Provider Configuration","text":""},{"location":"30-user-guide/190-identity-merging/#provider-properties","title":"Provider Properties","text":"<p>As stated above, provider order is important. However, you can also control what type of information each provider contributes to the user profile.</p> <p>Here is an extract from the Helm chart values file, which by default configures a single <code>ucrd</code> provider with default values:</p> values.yaml <pre><code>merger:\n  .....\n  idProviders:\n    - name: ucrd\n      httpConfig:\n        baseURL: http://localhost:6802\n      credentialAuthority: true\n      groupAuthority: true\n      groupPattern: \"%s\"\n      claimAuthority: true\n      claimPattern: \"%s\"\n      nameAuthority: true\n      emailAuthority: true\n      critical: true\n      uidOffset: 0\n  ....\n</code></pre> <ul> <li><code>credentialAuthority</code>: Setting this to <code>false</code> prevents this provider from authenticating any user.</li> <li><code>groupAuthority</code>: Setting this to <code>false</code> prevents groups from this provider from being added to user profiles.</li> <li><code>groupPattern</code>: Allows you to decorate all groups from this provider with a prefix or suffix. See the example below.</li> <li><code>claimAuthority</code>: Setting this to <code>false</code> prevents claims from this provider from being added to user profiles.</li> <li><code>claimPattern</code>: Allows you to decorate all claims from this provider with a prefix or suffix. This applies only to the first level if the claim is itself a map.</li> <li><code>nameAuthority</code>: Setting this to <code>false</code> prevents the name from this provider from being added to user profiles.</li> <li><code>emailAuthority</code>: Setting this to <code>false</code> prevents emails from this provider from being added to user profiles.</li> <li><code>critical</code>: Defines behavior if this provider is down or unavailable (e.g., LDAP server is down).<ul> <li>If <code>true</code>, all authentication will fail.</li> <li>If <code>false</code>, the provider is skipped and authentication proceeds as if it didn't exist.</li> </ul> </li> <li><code>uidOffset</code>: This value is added to the UID if this provider is the authority for the user.</li> </ul> <p>Note</p> <p>These properties are provided in the Helm chart for documentation purposes. Since they match built-in defaults, the previous snippet is equivalent to:</p> <pre><code>merger:\n  .....\n  idProviders:\n    - name: ucrd\n      httpConfig:\n        baseURL: http://localhost:6802\n</code></pre>"},{"location":"30-user-guide/190-identity-merging/#example","title":"Example","text":"<p>Given the following requirements:</p> <ul> <li>We want to ensure all users are referenced in a central, corporate repository (no local users)</li> <li>We still want to enrich users with local attributes (group bindings, claims, ...)</li> <li>We want to identify all groups issued from LDAP</li> </ul> <p>Therefore:</p> <ul> <li>The first requirement means we must prevent local user authentication</li> <li>The second requirement means we still need a <code>ucrd</code> Kubernetes CR database to be active</li> <li>The third requirement will be solved by adding a prefix to groups provided through LDAP</li> </ul> <p>This can be achieved by modifying the <code>merger</code> configuration in the Helm values file:</p> values-merger.yaml <pre><code>.....\n\nmerger:\n  enabled: true\n  idProviders:\n    - name: ldap\n      groupPattern: \"ldap-%s\"\n      httpConfig:\n        baseURL: http://localhost:6803 # ldap provider listening port\n    - name: ucrd\n      credentialAuthority: false\n      httpConfig:\n        baseURL: http://localhost:6802 # ucrd provider listening port\n.....\n</code></pre> <p>After applying the Helm update:</p> <pre><code>helm -n kubauth upgrade -i kubauth --values ./values-merger.yaml oci://quay.io/kubauth/charts/kubauth --version 0.1.2-snapshot --create-namespace --wait\n</code></pre> <p>we can now verify that:</p> <ul> <li> <p>Users <code>jim</code> and <code>john</code> now appear to be non-existent:     <pre><code>kc token-nui --issuerURL https://kubauth.ingress.kubo6.mbp --clientId public --login john --password john123 -d\n</code></pre> <pre><code>token request failed with status 400: {\"error\":\"invalid_grant\", ......... Unable to authenticate the provided username and password credentials.\"}\n</code></pre></p> </li> <li> <p>Enrichment of LDAP user attributes is still effective, and groups from LDAP have been prefixed:     <pre><code>kc token-nui --issuerURL https://kubauth.ingress.kubo6.mbp --clientId public --login bob --password bob123 -d\n</code></pre> <pre><code>JWT Payload:\n{\n  \"accessProfile\": \"p24x7\",\n  ....\n  \"authority\": \"ldap\",\n  ......\n  \"groups\": [\n    \"ops\",\n    \"ldap-staff\"\n  ],\n  ....\n}\n</code></pre>   and:     <pre><code>kc audit detail bob\n</code></pre> <pre><code>WHEN           LOGIN   STATUS            UID   NAME         GROUPS             CLAIMS                      EMAILS                AUTH\nSat 10:43:42   bob     passwordChecked   -     Bob MORANE   [ldap-staff,ops]   {\"accessProfile\":\"p24x7\"}   [bob@mycompany.com]   ldap\nDetail:\nPROVIDER   STATUS            UID   NAME         GROUPS         CLAIMS                      EMAILS\nldap       passwordChecked   -     Bob MORANE   [ldap-staff]   {}                          [bob@mycompany.com]\nucrd       N/A               N/A                [ops]          {\"accessProfile\":\"p24x7\"}   []\n</code></pre></p> </li> </ul> <p>Note</p> <p>Since we may use the <code>jim</code> and <code>john</code> users later in this manual, we recommend restoring them by setting <code>merger.idProviders[\"ucrd\"].credentialAuthority: true</code> and reapplying the Helm chart.</p>"},{"location":"40-applications-integration/110-argocd/","title":"ArgoCD Integration","text":""},{"location":"40-applications-integration/110-argocd/#oidc-client-creation","title":"OIDC Client Creation","text":"<p>As described in Configuration, an OIDC client application is defined as a Kubernetes Custom Resource.</p> <p>Create a manifest like the following:</p> client-argocd.yaml <pre><code>apiVersion: kubauth.kubotal.io/v1alpha1\nkind: OidcClient\nmetadata:\n  name: argocd\n  namespace: kubauth-oidc\nspec:\n  hashedSecret: \"$2a$12$.34NOSBLz9cfW9PD/yjj6uhrvys42Xb4euwKy6UFx9YLYEwxIICAK\" \n  redirectURIs:\n    - \"https://argocd.ingress.kubo6.mbp/auth/callback\"\n    - \"http://localhost:8085/auth/callback\"\n  grantTypes: [ \"refresh_token\", \"authorization_code\" ]\n  responseTypes: [\"id_token\", \"code\", \"token\", \"id_token token\", \"code id_token\", \"code token\", \"code id_token token\"]\n  scopes: [ \"openid\", \"offline\", \"profile\", \"groups\", \"email\", \"offline_access\"]\n  # Following are optional\n  displayName: ArgoCD\n  description: GitOps continuous delivery tool\n  entryURL: https://argocd.ingress.kubo6.mbp/\n</code></pre> <ul> <li>Replace <code>argocd.ingress.kubo6.mbp</code> with your ArgoCD entry point (in 2 locations)</li> <li>The sample password is 'argocd123'. The <code>hashedSecret</code> value is the result of the <code>kc hash argocd123</code> command.</li> <li>The <code>http://localhost:8085/auth/callback</code> entry in the <code>redirectURIs</code> list is for the <code>argocd</code> CLI command</li> <li>The <code>displayName</code>, <code>description</code>, and <code>entryURL</code> attributes are optional. They enable ArgoCD to appear in a list of available applications displayed on a specific page (<code>https://kubauth.ingress.kubo6.mbp/index</code>) or the logout page (see below).</li> </ul> <p>Apply this manifest:</p> <pre><code>kubectl apply -f client-argocd.yaml\n</code></pre>"},{"location":"40-applications-integration/110-argocd/#argocd-configuration","title":"ArgoCD Configuration","text":"<p>We assume ArgoCD is installed using the community-provided Helm chart.</p> <p>If ArgoCD is installed using another method, it should be straightforward to configure OIDC as described in the    ArgoCD manual using the information provided here.</p> <p>This means configuration is provided using Helm values or values files. Since general ArgoCD configuration is beyond the scope of this manual, we will focus only on the OIDC-related section of the values file.</p> <p>There are two challenging aspects of ArgoCD OIDC configuration:</p> <ul> <li>How to provide the secret value shared between ArgoCD and the Kubauth OIDC server</li> <li>How to provide the CA to validate the Kubauth OIDC issuer URL</li> </ul>"},{"location":"40-applications-integration/110-argocd/#basic-configuration","title":"Basic Configuration","text":"<p>In this approach, the secret is provided in clear text, and the CA certificate is embedded directly.</p> <p>Create a values file like the following to be added to your Helm command when deploying ArgoCD (<code>... --values values-kubauth.yaml...</code>):</p> values-kubauth.yaml <pre><code>configs:\n  cm:\n    url: \"https://argocd.ingress.kubo6.mbp\"\n    oidc.config: |\n      name: Kubauth\n      issuer: https://kubauth.ingress.kubo6.mbp\n      clientID: argocd\n      clientSecret: argocd123 \n      requestedScopes: [\"openid\", \"profile\", \"email\", \"groups\"]\n      enablePKCEAuthentication: true\n      # logoutURL: https://kubauth.ingress.kubo6.mbp/oauth2/logout\n      rootCA: |\n        -----BEGIN CERTIFICATE-----\n        MIIGSzCCBDOgAwIBAgIJAN3rPrHNIFfAMA0GCSqGSIb3DQEBCwUAMHUxCzAJBgNV\n        BAYTAkZSMQ4wDAYDVQQIDAVQYXJpczEOMAwGA1UEBwwFUGFyaXMxGTAXBgNVBAoM\n        EE9wZW5EYXRhUGxhdGZvcm0xFjAUBgNVBAsMDUlUIERlcGFydG1lbnQxEzARBgNV\n        BAMMCmNhLm9kcC5jb20wHhcNMjEwODE4MDkyMzA1WhcNMzEwODE2MDkyMzA1WjB1\n        .......\n        .......\n        bCbEcvjOBGCIMC+KrWGLbT3i1e1Lici91aqXcHp9rEZSlO/kPGf5gX6FJcj6jVo7\n        P6KClBmIhVYHMueorH7OUFl8mdsVayxMB8dzlr49yQQzhqif3ywLJQEpClCsbq/d\n        J2D93BTA8z5cto4I5oCtfQ2GjlkfEJG863gcIT/3ieu3AI/+LATFO7+TYVqYY8SI\n        wDQVxs1wOpHZOEekfO4fKW12BQ+f+K9m+j0ISFzUCA==\n        -----END CERTIFICATE-----\n\n  rbac:\n    policy.csv: |\n      g, argocd-admin, role:admin \n</code></pre> <ul> <li>Replace <code>argocd.ingress.kubo6.mbp</code> with your ArgoCD entry point.</li> <li>Replace <code>kubauth.ingress.kubo6.mbp</code> with your Kubauth entry point (in 2 locations).</li> <li>We enable PKCE, as it is the safest option and supported by both parties.</li> <li>The <code>logoutURL</code> parameter is commented out here. More on this below.</li> <li>The <code>rootCA</code> parameter is the CA of the Kubauth issuer. If Kubauth was installed using Certificate Manager as described at the beginning of this manual, it can be retrieved with:     <pre><code>kubectl -n kubauth get secret kubauth-oidc-server-cert -o=jsonpath='{.data.ca\\.crt}' | base64 -d\n</code></pre></li> <li>The <code>rbac</code> subsection grants ArgoCD admin rights to members of the <code>argocd-admin</code> group.    Of course, access management can be defined in more detail using ArgoCD's RBAC system, but this is beyond the scope of this manual.</li> </ul> <p>Add <code>--values values-kubauth.yaml</code> to your Helm command when deploying ArgoCD.</p>"},{"location":"40-applications-integration/110-argocd/#configuration-with-secret","title":"Configuration with Secret","text":"<p>To better protect the client secret and avoid embedding the CA certificate, ArgoCD allows these values to be stored in a secret.</p> <p>Modify the values file as follows:</p> values-kubauth.yaml <pre><code>configs:\n  cm:\n    url: \"https://argocd.ingress.kubo6.mbp\"\n    oidc.config: |\n      name: Kubauth\n      issuer: https://kubauth.ingress.kubo6.mbp\n      clientID: argocd\n      clientSecret: $oidc.kubauth.clientSecret\n      requestedScopes: [\"openid\", \"profile\", \"email\", \"groups\"]\n      enablePKCEAuthentication: true\n      # logoutURL: https://kubauth.ingress.kubo6.mbp/oauth2/logout\n      rootCA: $oidc.kubauth.rootCA\n\n  rbac:\n    policy.csv: |\n      g, argocd-admin, role:admin \n</code></pre> <p>Update your Helm chart deployment.</p> <p>The values must now be stored in a secret named <code>argocd-secret</code> (ArgoCD's hard-coded name) in the argocd namespace. In most cases, this secret already exists and contains other critical values. Care must be taken to append the new values without overwriting existing ones:</p> <pre><code>kubectl -n argocd create secret generic argocd-secret \\\n  --from-literal='oidc.kubauth.clientSecret=argocd123' \\\n  --from-file=oidc.kubauth.rootCA=./ca.crt \\\n  --dry-run=client -o yaml | kubectl apply -f -\n</code></pre> <p>You can ignore any warning messages.</p> <p>This assumes <code>./ca.crt</code> contains the CA of the Kubauth issuer:</p> <p><pre><code>cat ca.crt\n</code></pre> <pre><code>-----BEGIN CERTIFICATE-----\nMIIGSzCCBDOgAwIBAgIJAN3rPrHNIFfAMA0GCSqGSIb3DQEBCwUAMHUxCzAJBgNV\nBAYTAkZSMQ4wDAYDVQQIDAVQYXJpczEOMAwGA1UEBwwFUGFyaXMxGTAXBgNVBAoM\n.....\nJ2D93BTA8z5cto4I5oCtfQ2GjlkfEJG863gcIT/3ieu3AI/+LATFO7+TYVqYY8SI\nwDQVxs1wOpHZOEekfO4fKW12BQ+f+K9m+j0ISFzUCA==\n-----END CERTIFICATE-----\n</code></pre></p> <p>Refer to the ArgoCD documentation for more information.</p>"},{"location":"40-applications-integration/110-argocd/#usage","title":"Usage","text":"<p>Once configuration is complete, a 'LOG IN VIA KUBAUTH' button should appear on the ArgoCD entry page.</p> <p>You can log in using any defined user, such as <code>john</code>. Once logged in, you can verify your identity and group membership using the 'User Info' menu entry.</p> <p>ArgoCD displays the email address as the Username.</p> <p>Although logged in, you won't have any permissions without additional configuration.</p> <p>Now, add the user <code>john</code> to the <code>argocd-admin</code> group:</p> <pre><code>kubectl apply -f - &lt;&lt;EOF\napiVersion: kubauth.kubotal.io/v1alpha1\nkind: GroupBinding\nmetadata:\n  name: john-argocd-admin\n  namespace: kubauth-users\nspec:\n  group: argocd-admin\n  user: john\nEOF\n</code></pre> <p>After logging out and logging back in, the user <code>john</code> will now be able to act as an ArgoCD administrator. You can create a new project to validate this.</p>"},{"location":"40-applications-integration/110-argocd/#logout-url","title":"Logout URL","text":"<p>With the current configuration, when a user logs out from the ArgoCD UI, they are redirected to the landing page with the 'LOG IN VIA KUBAUTH' button and can log in again.</p> <p>Note</p> <p>If the \"Remember me\" checkbox was checked, you will be logged in again automatically due to SSO. If you want to log in as a different user, you can cancel your SSO session using the <code>kc logout...</code> command.</p> <p>Now, uncomment the <code>logoutURL: ...</code> entry in the values file \"values-kubauth.yaml\" and update your Helm deployment.</p> <p>After this change, on logout, ArgoCD will clean your local context as before and redirect your browser to the configured logout URL. This has two effects:</p> <ul> <li>Clears your global SSO session</li> <li>Redirects you to a logout page listing the applications (or clients) defined in the OidcClient resources (currently only ArgoCD)</li> </ul> <p></p> <p>For an OidcClient application to appear in this list, three attributes must be set. For ArgoCD:</p> <pre><code>apiVersion: kubauth.kubotal.io/v1alpha1\nkind: OidcClient\n...\nspec:\n  .....\n  displayName: ArgoCD\n  description: GitOps continuous delivery tool\n  entryURL: https://argocd.ingress.kubo6.mbp/\n</code></pre> <p>Note</p> <p>Kubauth also exposes this page at the <code>/index</code> path: <code>https://kubauth.ingress.kubo6.mbp/index</code></p>"},{"location":"40-applications-integration/120-harbor/","title":"Harbor Integration","text":""},{"location":"40-applications-integration/120-harbor/#oidc-client-creation","title":"OIDC Client Creation","text":"<p>As described in Configuration, a client application is defined as a Kubernetes Custom Resource.</p> <p>Create a manifest like the following:</p> client-harbor.yaml <pre><code>apiVersion: kubauth.kubotal.io/v1alpha1\nkind: OidcClient\nmetadata:\n  name: harbor\n  namespace: kubauth-oidc\nspec:\n  hashedSecret: \"$2a$12$5lLVmTBlougPBAQ8h10wR.W9tvZQBRsK1/Sh48yO8WLyXr.P4w3tm\"\n  redirectURIs:\n    - \"https://harbor.ingress.kubo6.mbp/c/oidc/callback\"\n  grantTypes: [ \"refresh_token\", \"authorization_code\" ]\n  responseTypes: [\"id_token\", \"code\", \"token\", \"id_token token\", \"code id_token\", \"code token\", \"code id_token token\"]\n  scopes: [ \"openid\", \"offline\", \"profile\", \"groups\", \"email\", \"offline_access\"]\n  # Following are optional\n  displayName: Harbor\n  description: Harbor OCI repository\n  entryURL: https://harbor.ingress.kubo6.mbp/\n</code></pre> <ul> <li>Replace <code>harbor.ingress.kubo6.mbp</code> with your Harbor entry point (in 2 locations)</li> <li>The sample password is 'harbor123'. The <code>hashedSecret</code> value is the result of the <code>kc hash harbor123</code> command.</li> <li>The <code>displayName</code>, <code>description</code>, and <code>entryURL</code> attributes are optional. They enable Harbor to appear in a list of available applications displayed on a specific page (<code>https://kubauth.ingress.kubo6.mbp/index</code>) or the logout page.</li> </ul> <p>Apply this manifest:</p> <pre><code>kubectl apply -f client-harbor.yaml\n</code></pre>"},{"location":"40-applications-integration/120-harbor/#manual-harbor-configuration","title":"Manual Harbor Configuration","text":"<p>We assume you have a running Harbor installation.</p> <ul> <li>Log in to the Harbor interface with an account that has Harbor system administrator privileges.</li> <li>Under Administration, go to Configuration and select the Authentication tab.</li> <li>Use the Auth Mode drop-down menu to select OIDC.</li> </ul> <p>Set the following values:</p> <ul> <li>Auth Mode: <code>OIDC</code></li> <li>OIDC Provider Name: <code>KUBAUTH</code></li> <li>OIDC Endpoint: <code>https://kubauth.ingress.kubo6.mbp</code> (Adjust to your local Kubauth entry point)</li> <li>OIDC Client ID: <code>harbor</code></li> <li>OIDC Client Secret: <code>harbor123</code></li> <li>Group Claim Name: <code>groups</code></li> <li>OIDC Admin Group: <code>harbor-admins</code></li> <li>OIDC Scopes: <code>openid,email,profile,offline_access,groups</code></li> <li>Automatic onboarding: <code>true</code> </li> <li>Username Claim: <code>name</code></li> </ul>"},{"location":"40-applications-integration/120-harbor/#automated-harbor-configuration","title":"Automated Harbor Configuration","text":"<p>OIDC can also be configured using environment variables.</p> <p>If you have installed Harbor using the provided Helm chart, this can be achieved by appending a values file like the following to your deployment:</p> values-kubauth.yaml <pre><code>core:\n  extraEnvVars:\n    - name: CONFIG_OVERWRITE_JSON\n      value: |\n        {\n          \"auth_mode\": \"oidc_auth\",\n          \"oidc_name\": \"KUBAUTH\",\n          \"oidc_endpoint\": \"https://kubauth.ingress.kubo6.mbp\",\n          \"oidc_groups_claim\": \"groups\",\n          \"oidc_admin_group\": \"harbor-admins\",\n          \"oidc_client_id\": \"harbor\",\n          \"oidc_client_secret\": \"harbor123\",\n          \"oidc_scope\": \"openid,email,profile,offline_access,groups\",\n          \"oidc_verify_cert\": \"false\",\n          \"oidc_auto_onboard\": \"true\",\n          \"oidc_user_claim\": \"name\"\n        }\n</code></pre> <p>Replace <code>https://kubauth.ingress.kubo6.mbp</code> with the Kubauth entry point of your installation.</p>"},{"location":"40-applications-integration/120-harbor/#admin-rights","title":"Admin Rights","text":"<p>To grant admin rights to a user, add them to the group we defined as <code>oidc_admin_group</code> (here <code>harbor-admins</code>) in the configuration by creating a new <code>GroupBinding</code>:</p> <pre><code>kubectl apply -f - &lt;&lt;EOF\napiVersion: kubauth.kubotal.io/v1alpha1\nkind: GroupBinding\nmetadata:\n  name: john-harbor-admins\n  namespace: kubauth-users\nspec:\n  group: harbor-admins\n  user: john\nEOF\n</code></pre> <p>Now, you can log in with this user and verify they have full admin rights.</p>"},{"location":"40-applications-integration/130-minio/","title":"MinIO Integration","text":"<p>Warning</p> <p>At the time of writing this manual, there are changes underway in how MinIO is distributed.</p> <p>The configuration provided here has been validated on the latest OSS MinIO version that includes a fully functional Console Admin.</p> <p>It should also apply to MinIO AIStor, the proprietary version of MinIO.</p>"},{"location":"40-applications-integration/130-minio/#oidc-client-creation","title":"OIDC Client Creation","text":"<p>As described in Configuration, a client application is defined as a Kubernetes Custom Resource.</p> <p>Create a manifest like the following:</p> client-minio.yaml <pre><code>apiVersion: kubauth.kubotal.io/v1alpha1\nkind: OidcClient\nmetadata:\n  name: minio\n  namespace: kubauth-oidc\nspec:\n  hashedSecret: \"$2a$12$mll9UA1oefLGY0KcAbvrG.Jvssjqlt8wSDtb2DNvEK4Oc/YYaJ8iy\"\n  redirectURIs:\n    - \"https://minio-console-minio1.ingress.kubo6.mbp/oauth_callback\"\n  grantTypes: [ \"refresh_token\", \"authorization_code\" ]\n  responseTypes: [\"id_token\", \"code\", \"token\", \"id_token token\", \"code id_token\", \"code token\", \"code id_token token\"]\n  scopes: [ \"openid\", \"offline\", \"profile\", \"groups\", \"email\", \"offline_access\", \"address\", \"phone\"]\n  # Following are optional\n  displayName: MinIO\n  description: S3 Server\n  entryURL: \"https://minio-console-minio1.ingress.kubo6.mbp\"\n</code></pre> <ul> <li>Replace <code>minio-console-minio1.ingress.kubo6.mbp</code> with your MinIO console entry point (in 2 locations)</li> <li>The sample password is 'minio123'. The <code>hashedSecret</code> value is the result of the <code>kc hash minio123</code> command.</li> <li>The <code>scopes</code> include <code>address</code> and <code>phone</code>, which appear to be required by MinIO's default configuration.</li> <li>The <code>displayName</code>, <code>description</code>, and <code>entryURL</code> attributes are optional. They enable MinIO to appear in a list of available applications displayed on a specific page (<code>https://kubauth.ingress.kubo6.mbp/index</code>) or the logout page.</li> </ul> <p>Apply this manifest:</p> <pre><code>kubectl apply -f client-minio.yaml\n</code></pre>"},{"location":"40-applications-integration/130-minio/#minio-configuration","title":"MinIO Configuration","text":"<p>We assume you have a fully functional MinIO deployment.</p> <p>We also assume you have the <code>mc</code> command configured with an alias (<code>myminio</code> below) that grants full admin rights.</p> <p>One method to configure an OIDC connection for MinIO is by issuing a specific command:</p> <pre><code>mc idp openid add myminio kubauth \\\n    client_id=minio \\\n    client_secret=minio123 \\\n    config_url=\"https://kubauth.ingress.kubo6.mbp/.well-known/openid-configuration\" \\\n    redirect_uri=\"https://minio-console-minio1.ingress.kubo6.mbp/oauth_callback\" \\\n    claim_name=\"minio_policies\" \\\n    display_name=KUBAUTH \\\n    claim_userinfo=\"on\"\n</code></pre> <ul> <li>Replace <code>minio-console-minio1.ingress.kubo6.mbp</code> with your MinIO console entry point</li> <li>Replace <code>kubauth.ingress.kubo6.mbp</code> with your Kubauth entry point</li> <li>The <code>claim_name</code> specifies the JWT claim MinIO uses to identify the policies to attach to the authenticated user.    The claim can contain one or more comma-separated policy names to attach to the user.    The claim must contain at least one policy for the user to have any permissions on the MinIO server. The default value is <code>policy</code>,    but we set it to <code>minio_policies</code> to be more specific and highlight that it can be a list.</li> </ul> <p>The server needs to be restarted after this configuration:</p> <pre><code>mc admin service restart myminio\n</code></pre> <p>Tip</p> <p>This configuration can also be achieved using environment variables. Refer to the MinIO documentation.</p>"},{"location":"40-applications-integration/130-minio/#usage","title":"Usage","text":"<p>After this configuration, a <code>KUBAUTH</code> button should appear on the MinIO console login page.</p> <p>If you try to log in using a valid OIDC user, you should receive an error such as: <code>minio_policies claim missing from the JWT token, credentials will not be generated</code></p> <p>To be able to log in to the Console with full admin rights, the easiest solution is to associate the existing <code>consoleAdmin</code> policy to the user by setting it in the <code>minio_policies</code> claim.</p> <p>This can be achieved by adding the claim to the user definition:</p> <pre><code>.......\n---\napiVersion: kubauth.kubotal.io/v1alpha1\nkind: User\nmetadata:\n  name: john\n  namespace: kubauth-users\nspec:\n  ......\n  claims:\n    office: 208G\n    minio_policies: consoleAdmin\n  ......\n</code></pre> <p>This will also work if the user's primary source is another identity provider, such as LDAP. See Identity merging.</p> <p>However, a cleaner approach is to use an intermediate Group to simplify management.</p> <p>Create a <code>minio-admins</code> group with the appropriate claim:</p> <pre><code>kubectl apply -f - &lt;&lt;EOF\napiVersion: kubauth.kubotal.io/v1alpha1\nkind: Group\nmetadata:\n  name: minio-admins\n  namespace: kubauth-users\nspec:\n  claims:\n    minio_policies: \"consoleAdmin\"\nEOF\n</code></pre> <p>Add a user to this newly created group:</p> <pre><code>kubectl apply -f - &lt;&lt;EOF\napiVersion: kubauth.kubotal.io/v1alpha1\nkind: GroupBinding\nmetadata:\n  name: john-minio-admins\n  namespace: kubauth-users\nspec:\n  group: minio-admins\n  user: john\nEOF\n</code></pre> <p>Now, <code>john</code> can log in as a full MinIO administrator.</p>"},{"location":"50-kubernetes-integration/110-overview/","title":"Overview","text":"<p>This chapter describes how to integrate the Kubauth OIDC server with the Kubernetes authentication system and RBAC.</p> <p>The goal is to authenticate users interacting with the cluster through tools like <code>kubectl</code>.</p> <p>This integration consists of several parts:</p> <ul> <li> <p>First, we need to register Kubernetes as an OIDC client application. This is covered immediately below.</p> </li> <li> <p>We need to configure the Kubernetes API server to interact with Kubauth. This configuration can be performed manually, but a tool to fully automate the process is provided.</p> </li> <li> <p>A service is deployed on the cluster to publish configuration parameters for users.</p> </li> <li> <p>Each user needs to perform local configuration on their workstation. Here also, a tool is provided to automate this process.</p> </li> </ul>"},{"location":"50-kubernetes-integration/110-overview/#oidc-client-creation","title":"OIDC Client Creation","text":"<p>From the OIDC server's perspective, Kubernetes is perceived as a client application and must be defined as such. As described in Configuration, an OIDC client application is defined as a Kubernetes Custom Resource.</p> <p>Create a manifest like the following:</p> client-k8s.yaml <pre><code>---\napiVersion: kubauth.kubotal.io/v1alpha1\nkind: OidcClient\nmetadata:\n  name: k8s\n  namespace: kubauth-oidc\nspec:\n  hashedSecret: \"$2a$12$Aq5uKhYmMBZ3GDKykgSrT.0Rq1.s81VBwHgQP/cozdP3SBkQAbxv2\"\n  description: For kubernetes kubectl access\n  grantTypes: [\"refresh_token\", \"authorization_code\", \"password\"]\n  redirectURIs:\n    - http://localhost:8000\n    - http://localhost:18000\n  responseTypes: [ \"id_token\", \"code\", \"token\", \"id_token token\", \"code id_token\", \"code token\", \"code id_token token\" ]\n  scopes: [ \"openid\", \"offline\", \"profile\", \"groups\", \"email\", \"offline_access\" ]\n  accessTokenLifespan: 1m0s\n  idTokenLifespan: 1m0s\n  refreshTokenLifespan: 30m0s\n</code></pre> <ul> <li>The sample password is 'k8s123'. The <code>hashedSecret</code> value is the result of the <code>kc hash k8s123</code> command. <p>The client can also be defined as <code>public</code>.</p> </li> <li>Since the client application will be kubectl/kubelogin running on the user's workstation, <code>redirectURIs</code> refers to <code>localhost</code>.</li> </ul> <p>Apply this manifest:</p> <pre><code>kubectl apply -f client-k8s.yaml\n</code></pre> <p>You can now proceed to the API Server configuration.</p>"},{"location":"50-kubernetes-integration/120-api-server-configuration/","title":"Kubernetes API Server Configuration","text":""},{"location":"50-kubernetes-integration/120-api-server-configuration/#automated-configuration","title":"Automated Configuration","text":"<p>Kubauth provides a Helm chart that spawns appropriate jobs to perform this configuration in a fully automated manner.</p> <p>This process assumes that the API Server is managed by the Kubelet as a static pod. If your API Server is managed by another system, such as systemd, you should fall back to the manual configuration.</p> <p>Additionally, this process assumes a 'standard' folder layout for the Kubernetes installation, such as those used by kind or kubespray. If this is not the case, adjustments can be made by overriding values in the Helm chart. Refer to its values file.</p> <p>Danger</p> <p>If you are performing this task on a critical cluster, we strongly recommend reading the Manual Configuration section below. This will help you fully understand what happens under the hood, enabling you to roll back manually in case of problems.</p> <p>Since several configuration variables are required, we recommend using a values file rather than command-line arguments.</p> <p>In your working directory, create a file like the following:</p> values-k8s.yaml <pre><code>config:\n  oidc:\n    issuerURL: https://kubauth.ingress.kubo6.mbp\n    issuerCaSecretName: certs-bundle  # If using trust-manager (from cert-manager)\n    issuerCaName: ca.crt\n    clientId: k8s\n    usernamePrefix: \"-\" # Dash means no prefix.\n    groupsPrefix: \"oidc-\" # A prefix is mandatory (default is 'oidc:')\n</code></pre> <ul> <li>Replace <code>kubauth.ingress.kubo6.mbp</code> with your Kubauth entry point</li> <li><code>issuerCaSecretName</code>: A secret hosting the CA of the issuer URL. In this sample, we use trust-manager, which creates such a secret (here <code>certs-bundle</code>) in each namespace.</li> <li><code>issuerCaName</code>: The path of the CA certificate inside the secret.</li> <li><code>clientId</code> should match the name of the <code>OidcClient</code> declared previously. Note that a <code>clientSecret</code> value is not needed, as the API server will not connect to Kubauth.</li> <li><code>usernamePrefix</code>: Prefix prepended to username claims to prevent clashes with existing names. A dash value means no prefix.</li> <li><code>groupsPrefix</code>: Prefix prepended to group claims to prevent clashes with existing names. Cannot be empty for security reasons. The default is <code>oidc:</code>, but in this sample, we set it to <code>oidc-</code>.</li> </ul> <p>Note</p> <p>This <code>values.yaml</code> file represents the minimum required configuration. Refer to the Helm chart values file for additional variables.</p> <p>You can now proceed with the configuration using the dedicated Helm chart:</p> <pre><code>helm -n kubauth upgrade -i kubauth-apiserver --values ./values-k8s.yaml oci://quay.io/kubauth/charts/kubauth-apiserver --version 0.1.0-snapshot --create-namespace --wait\n</code></pre> <p>Note</p> <p>This process will take some time, so please be patient.</p> <p>At the end of this process, a rolling restart is performed on the API Server. If there is only a single instance of this critical pod, you will lose contact with your cluster for a certain period.</p> <p>This may trigger the restart of many other pods. Wait for your cluster to reach a stable state before proceeding further.</p>"},{"location":"50-kubernetes-integration/120-api-server-configuration/#verifying-installation","title":"Verifying Installation","text":"<p>If your cluster is up and running, there is good chance installation was successful. </p> <p>If you suspect something went wrong, refer to the manual installation section below to check the configuration.</p> <p>Also review the API server logs and/or kubelet logs.</p>"},{"location":"50-kubernetes-integration/120-api-server-configuration/#removal","title":"Removal","text":"<p>Uninstalling the Helm chart should restore the original API server configuration:</p> <pre><code>helm -n kubauth uninstall kubauth-apiserver --wait\n</code></pre>"},{"location":"50-kubernetes-integration/120-api-server-configuration/#manual-configuration","title":"Manual Configuration","text":"<p>The API server configuration for connecting an OIDC provider is described here in the Kubernetes documentation.</p> <p>Depending on your specific installation, the directories mentioned below may vary. For reference, the clusters used for testing and documentation purposes were built using <code>kind</code>.</p> <p>Additionally, this procedure assumes that the API Server is managed by the Kubelet as a static pod. If your API Server is managed by another system, such as systemd, you should make the necessary adjustments accordingly.</p> <p>Note</p> <p>The following operations must be executed on all nodes hosting an instance of the Kubernetes API server, typically all nodes within the control plane.</p> <p>These operations require root access on these nodes. Each node must also have <code>kubectl</code> installed and an editor available.</p> <p>For each node:</p> <ul> <li> <p>Log into it:</p> <p><pre><code>docker exec -it kubo6-control-plane /bin/bash\n</code></pre> - Create a folder to store the Kubauth issuer URL certificate (<code>-kit</code> stands for Kubernetes Integration Toolkit):</p> <pre><code>mkdir /etc/kubernetes/kubauth-kit \n</code></pre> </li> <li> <p>Fetch the Kubauth issuer URL certificate and store it in the newly created folder:</p> <pre><code>kubectl -n kubauth get secret kubauth-oidc-server-cert \\\n-o=jsonpath='{.data.ca\\.crt}' | base64 -d &gt;/etc/kubernetes/kubauth-kit/ca.crt  \n</code></pre> </li> <li> <p>Edit the <code>kube-apiserver.yaml</code> manifest:</p> <pre><code>vi /etc/kubernetes/manifests/kube-apiserver.yaml\n</code></pre> <p>Make the following modifications:</p> <pre><code>spec:\n  containers:\n  - command:\n    - kube-apiserver\n    - \"--oidc-ca-file=/etc/kubernetes/kubauth-kit/ca.crt\"\n    - \"--oidc-groups-prefix=oidc-\"\n    - --oidc-groups-claim=groups\n    - \"--oidc-username-prefix=-\"\n    - --oidc-username-claim=sub\n    - --oidc-client-id=k8s\n    - \"--oidc-issuer-url=https://kubauth.ingress.kubo6.mbp\"\n    ..........\n    ..........\n    volumeMounts:\n    - mountPath: /etc/kubernetes/kubauth-kit\n      name: kubauth-kit-config\n    ..........\n  ..........\n  volumes:\n  - hostPath:\n      path: /etc/kubernetes/kubauth-kit\n      type: \"\"\n    name: kubauth-kit-config\n  ..........\n</code></pre> <ul> <li>Quotes (<code>\"</code>) are important.</li> <li>In <code>--oidc-issuer-url</code>, replace <code>kubauth.ingress.kubo6.mbp</code> with your Kubauth entry point.</li> <li><code>--oidc-client-id</code> should match the name of the <code>OidcClient</code> declared previously. Note that a <code>clientSecret</code> value is not needed, as the API server will not connect to Kubauth.</li> <li><code>--oidc-username-prefix</code>: Prefix prepended to username claims to prevent clashes with existing names. A dash value means no prefix.</li> <li><code>--oidc-groups-prefix</code>: Prefix prepended to group claims to prevent clashes with existing names. Cannot be empty for security reasons. The default is <code>oidc:</code>, but in this sample, we set it to <code>oidc-</code>.</li> <li>The <code>volumeMounts</code> and <code>volumes</code> sections allow the certificate to be accessible from inside the container.</li> </ul> </li> <li> <p>Modifying the <code>/etc/kubernetes/manifests/kube-apiserver.yaml</code> file will trigger a restart of the API server pod.</p> </li> </ul>"},{"location":"50-kubernetes-integration/130-kubeconfig-service/","title":"Kubeconfig Service","text":""},{"location":"50-kubernetes-integration/130-kubeconfig-service/#configuration","title":"Configuration","text":"<p>To configure your local kubeconfig, certain information is required (API server address, Certificate Authority, OIDC issuer URL, etc.). Kubauth provides a service to publish this information for use by a local tool that configures the <code>kubeconfig</code> file.</p> <p>This service is deployed using a Helm chart. Since its configuration includes numerous parameters, create a values file like the following:</p> values-kubeconfig.yaml <pre><code>ingress:\n  host: kubeconfig.ingress.kubo6.mbp\nserver:\n  tls: true\n  certificateIssuer: cluster-odp\nnetworkPolicies:\n  enabled: true\nkubeconfigs:\n  default:\n    description: Default OIDC client configuration\n    cluster:\n      apiServerURL: https://127.0.0.1:5452\n    context:\n      name: oidc-kubo6\n      namespace:  # Left blank to allow default context for users\n    oidc:\n      issuerURL: https://kubauth.ingress.kubo6.mbp\n      issuerCaSecretName: certs-bundle\n      issuerCaName: ca.crt\n      clientId: k8s\n      clientSecret: k8s123\n</code></pre> <p>Several fields must be adjusted depending on your environment:</p> <ul> <li><code>ingress.host</code>: The FQDN used for accessing the service from outside the cluster.</li> <li><code>server.tls</code>: Enables secure communication (recommended).</li> <li><code>certificateIssuer</code>: The <code>ClusterIssuer</code> from your Certificate Manager for ingress certificate provisioning.</li> <li><code>networkPolicies.enabled</code>: Must be set to <code>true</code> if your cluster enforces network policies. A rule will be generated to allow access to the service by the ingress controller.</li> <li><code>kubeconfigs.default.cluster.apiServerURL</code>: The URL to access the API Server from the client workstation. Set to 127.0.0.1 in this sample, as we target a local kind cluster.</li> <li><code>kubeconfigs.default.context.name</code>: The local name of this context. Useful when managing multiple clusters.</li> <li><code>kubeconfigs.default.context.namespace</code>: Optional. Sets a specific default namespace on user login.</li> <li><code>kubeconfigs.default.oidc.issuerURL</code>: Set to your Kubauth entry point.</li> <li><code>kubeconfigs.default.oidc.issuerCaSecretName</code>: A secret hosting the CA of the issuer URL. In this sample, we use trust-manager, which creates such a secret (here <code>certs-bundle</code>) in each namespace.</li> <li><code>kubeconfigs.default.oidc.issuerCaName</code>: The path of the CA certificate inside the secret.</li> <li><code>kubeconfigs.default.oidc.clientId</code>: Should match the name of the <code>OidcClient</code> declared previously.</li> <li><code>kubeconfigs.default.oidc.clientSecret</code>: The secret defined in the <code>OidcClient</code> declared previously. Leave blank if the <code>OidcClient</code> is <code>public</code>.</li> </ul>"},{"location":"50-kubernetes-integration/130-kubeconfig-service/#deployment","title":"Deployment","text":"<p>Deploy the Helm chart:</p> <pre><code>helm -n kubauth upgrade -i kubauth-kubeconfig --values ./values-kubeconfig.yaml \\ \n    oci://quay.io/kubauth/charts/kubauth-kubeconfig --version 0.1.0-snapshot \\\n    --create-namespace --wait\n</code></pre>"},{"location":"50-kubernetes-integration/130-kubeconfig-service/#validation","title":"Validation","text":"<p>Verify the correct deployment of this new pod:</p> <p><pre><code>kubectl -n kubauth get pods\n</code></pre> <pre><code>NAME                                  READY   STATUS    RESTARTS   AGE\nkubauth-549b9b46c8-mlnhv              5/5     Running   0          24h\nkubauth-kubeconfig-7d6949666c-zrhvl   1/1     Running   0          36s\n</code></pre></p> <p>Test the retrieval of information:</p> <p><pre><code>curl  https://kubeconfig.ingress.kubo6.mbp/kubeconfig | jq\n</code></pre> <pre><code>{\n  \"description\": \"Default OIDC client configuration\",\n  \"cluster\": {\n    \"apiServerURL\": \"https://127.0.0.1:5452\",\n  ......\n</code></pre></p>"},{"location":"50-kubernetes-integration/140-workstation-setup/","title":"Workstation Setup","text":""},{"location":"50-kubernetes-integration/140-workstation-setup/#kubelogin-installation","title":"kubelogin Installation","text":"<p>On the <code>kubectl</code> client side, we will use the kubelogin kubectl plugin to manage user authentication.</p> <p>To install it, from the Kubelogin README:</p> <p>Install the latest release from Homebrew, Krew, Chocolatey, or GitHub Releases.</p> <pre><code># Homebrew (macOS and Linux)\nbrew install kubelogin\n\n# Krew (macOS, Linux, Windows and ARM)\nkubectl krew install oidc-login\n\n# Chocolatey (Windows)\nchoco install kubelogin\n</code></pre> <p>If you install via GitHub releases, save the binary as <code>kubectl-oidc_login</code> on your path. When you invoke <code>kubectl oidc-login</code>, kubectl finds it by the naming convention for kubectl plugins. The other installation methods do this for you.</p> <p>The next step is to configure your local <code>kubeconfig</code>. Kubauth provides a tool to automate this task.</p>"},{"location":"50-kubernetes-integration/140-workstation-setup/#configuration","title":"Configuration","text":"<p>The <code>kc</code> CLI tool provides a subcommand to configure your local kubeconfig from the service we previously installed:</p> <pre><code>kc config https://kubeconfig.ingress.kubo6.mbp/kubeconfig\n</code></pre> <p>Adjust the URL to your local environment, but keep the <code>/kubeconfig</code> path.</p> <p>You should see a message like the following:</p> <pre><code>Setup new context 'oidc-kubo6' in kubeconfig file '/Users/john/.kube/config'\n</code></pre> <p>Note</p> <p>If such a context already exists in your config file, it will not be overwritten and you will receive an error message. Use the <code>--force</code> option to override.</p> <p>Tip</p> <p>If you encounter an error like <code>tls: failed to verify certificate: x509:...</code>, the CA associated with your ClusterIssuer is not recognized on your local workstation.</p> <ul> <li>Add the <code>--insecureSkipVerify</code> option to the <code>kc config</code> command. You will also need to configure your browser to accept the certificate.</li> <li>Add the CA as a trusted certificate on your local workstation. You can extract it with:   <pre><code>kubectl -n kubauth get secret kubauth-oidc-server-cert \\\n  -o=jsonpath='{.data.ca\\.crt}' | base64 -d &gt;./ca.crt \n</code></pre></li> <li>Add the <code>--caFile ./ca.crt</code> option to the <code>kc token</code> command.</li> </ul> <p>For reference, here is a sample local config file resulting from this operation:</p> config.yaml <pre><code>apiVersion: v1\nclusters:\n- cluster:\n    certificate-authority-data: LS0tLS1CRUdJTi........FUlRJRklDQVRFLS0tLS0K\n    server: https://127.0.0.1:5452\n  name: oidc-kubo6-cluster\ncontexts:\n- context:\n    cluster: oidc-kubo6-cluster\n    user: oidc-kubo6-user\n  name: oidc-kubo6\ncurrent-context: oidc-kubo6\nkind: Config\nusers:\n- name: oidc-kubo6-user\n  user:\n    exec:\n      apiVersion: client.authentication.k8s.io/v1\n      args:\n      - oidc-login\n      - get-token\n      - --oidc-issuer-url=https://kubauth.ingress.kubo6.mbp\n      - --oidc-client-id=k8s\n      - --oidc-client-secret=k8s123\n      - --certificate-authority-data=LS0tLS1CR.........tRU5EIENFUlRJRklDQVRFLS0tLS0=\n      - --insecure-skip-tls-verify=false\n      - --grant-type=auto\n      - --oidc-extra-scope=offline\n      - --oidc-pkce-method=auto\n      command: kubectl\n      env: null\n      interactiveMode: IfAvailable\n      provideClusterInfo: false\n</code></pre>"},{"location":"50-kubernetes-integration/140-workstation-setup/#first-login-attempt","title":"First Login Attempt","text":"<p>You can now issue a kubectl command to trigger authentication:</p> <pre><code>kubectl explain pods\n</code></pre> <p>Your browser should open to the Kubauth login page. Once logged in, this operation will complete successfully, as it does not require any specific permissions.</p> <pre><code>KIND:       Pod\nVERSION:    v1\n\nDESCRIPTION:\n    Pod is a collection of containers that can run on a host. This resource is\n    created by clients and scheduled onto hosts.\n.....\n</code></pre> <p>Now, try another request:</p> <pre><code>kubectl get ns\n</code></pre> <p>This time, you will receive an error, as such an operation requires Kubernetes permissions.</p> <pre><code>Error from server (Forbidden): namespaces is forbidden: User \"john\" cannot list resource \"namespaces\" in API group \"\" at the cluster scope\n</code></pre> <p>However, you can verify that you are authenticated with the user you used on the login page.</p> <p>Another way to determine your identity is to use the following <code>kc</code> subcommand:</p> <p><pre><code>kc whoami\n</code></pre> <pre><code>john\n</code></pre> You can also obtain more information by using an option to dump the JWT token:</p> <p><pre><code>kc whoami -d\n</code></pre> <pre><code>john\nJWT Payload:\n{\n  \"accessProfile\": \"p24x7\",\n  \"at_hash\": \"xevWqv4MaZ_ft1nYs-wCcg\",\n  \"aud\": [\n    \"k8s\"\n  ],\n  \"auth_time\": 1763573723,\n  \"auth_time_human\": \"2025-11-19 17:35:23 UTC\",\n  \"authority\": \"ucrd\",\n  .....\n}\n</code></pre></p>"},{"location":"50-kubernetes-integration/140-workstation-setup/#session-duration","title":"Session Duration","text":"<p>You may notice that the system does not require authentication for each call, but manages some form of session.</p> <p>Recall the end of Kubauth OIDC client creation:</p> <pre><code>  ....\n  accessTokenLifespan: 1m0s\n  idTokenLifespan: 1m0s\n  refreshTokenLifespan: 30m0s\n</code></pre> <ul> <li>On initial login, the server grants a token with a lifespan of 1 minute and a refresh token.</li> <li>During this minute, all operations are performed without OIDC interaction.</li> <li>After this duration, if the refresh token has not expired, the API server uses it to obtain a new 1-minute token and a new refresh token.</li> </ul> <p>As a result, in this configuration, the session will expire after 30 minutes of inactivity.</p>"},{"location":"50-kubernetes-integration/140-workstation-setup/#logout","title":"Logout","text":"<p>If you need to cancel a session before this timeout (for example, to log in as a different user), you can issue the following command:</p> <pre><code>kc logout\n</code></pre> <p>This performs two actions:</p> <ul> <li>Cleans up the local storage.</li> <li>Launches a browser to the Kubauth OIDC server's end-of-session endpoint to clear any SSO session.</li> </ul> <p>Note</p> <p>If you recall the usage of <code>kc logout</code> in the SSO chapter, you may notice there is no longer a <code>--issuerURL</code> or <code>--clientId</code> option. This is because the <code>kc</code> command fetches this information from your local Kubernetes config file.</p>"},{"location":"50-kubernetes-integration/140-workstation-setup/#granting-rights-using-kubernetes-rbac","title":"Granting Rights Using Kubernetes RBAC","text":"<p>Let's say we want the user <code>john</code> to have full admin rights on the cluster.</p> <p>First, we will add them to a <code>cluster-admin</code> group:</p> <pre><code>kubectl apply -f - &lt;&lt;EOF\napiVersion: kubauth.kubotal.io/v1alpha1\nkind: GroupBinding\nmetadata:\n  name: john-cluster-admin\n  namespace: kubauth-users\nspec:\n  group: cluster-admin\n  user: john\nEOF\n</code></pre> <p>Remember, in our context, simply referencing a group in a <code>GroupBinding</code> makes it exist.</p> <p>In our cluster, there is an existing role <code>cluster-admin</code>. We must bind our newly created group to this role:</p> <pre><code>kubectl apply -f - &lt;&lt;EOF\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: oidc-cluster-admin\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- apiGroup: rbac.authorization.k8s.io\n  kind: Group\n  name: oidc-cluster-admin\nEOF\n</code></pre> <p>Note the group is referenced here as <code>oidc-cluster-admin</code>. This is because <code>groupsPrefix: \"oidc-\"</code> was set in the OIDC configuration.</p> <p>After executing these two scripts, <code>kubectl get ns</code> should display the list of your cluster's namespaces.</p> <p>Of course, if you were already logged in, you must log out first.</p> <p>Note</p> <p>Setting a <code>groupsPrefix</code> is a requirement in OIDC configuration, enforced by the API server for security reasons. Otherwise, any user able to create a <code>GroupBinding</code> resource could bind any user to an existing <code>system:masters</code> group.</p>"},{"location":"50-kubernetes-integration/140-workstation-setup/#no-ui-mode","title":"No UI Mode","text":"<p>There are cases where launching a browser is impossible, such as when working on a server accessed through SSH.</p> <p>We can configure a 'no browser' mode when setting up your client, using the <code>--grantType password</code> option:</p> <pre><code>kc config https://kubeconfig.ingress.kubo6.mbp/kubeconfig --grantType password\n</code></pre> <p>Add <code>--force</code> to override an existing configuration if needed.</p> <p>Warning</p> <p>This mode uses OAuth's Resource Owner Password Credentials (ROPC) grant type. This requires the OIDC server to be configured to allow this mode. See the Password Grant chapter.</p> <p>With this configuration, users will be prompted on the terminal for their login and password:</p> <p><pre><code>kubectl get ns\n</code></pre> <pre><code>Username: john\nPassword:\n</code></pre> <pre><code>NAME                 STATUS   AGE\ncert-manager         Active   27d\ndefault              Active   27d\nflux-system          Active   27d\ningress-nginx        Active   27d\nkubauth              Active   32h\n........\n</code></pre></p>"},{"location":"60-references/100-overview/","title":"Overview","text":"<p>This section provides comprehensive reference documentation for Kubauth's Kubernetes Custom Resource Definitions (CRDs).</p>"},{"location":"60-references/100-overview/#custom-resources","title":"Custom Resources","text":"<p>Kubauth stores all configuration and user data as native Kubernetes resources, providing a cloud-native, scalable solution without requiring an external database.</p>"},{"location":"60-references/100-overview/#core-resources","title":"Core Resources","text":"<ul> <li>OidcClient - OIDC client application definitions</li> <li>User - User account definitions with authentication credentials</li> <li>Group - Group definitions with shared claims</li> <li>GroupBinding - User-to-group associations</li> </ul>"},{"location":"60-references/100-overview/#api-group-and-version","title":"API Group and Version","text":"<p>All Kubauth resources use the following API group and version:</p> <ul> <li>API Group: <code>kubauth.kubotal.io</code></li> <li>Version: <code>v1alpha1</code></li> </ul>"},{"location":"60-references/100-overview/#resource-organization","title":"Resource Organization","text":""},{"location":"60-references/100-overview/#namespaces","title":"Namespaces","text":"<p>Kubauth resources are namespaced and typically organized as follows:</p> Resource Type Default Namespace Configurable OidcClient <code>kubauth-oidc</code> Yes User <code>kubauth-users</code> Yes Group <code>kubauth-users</code> Yes GroupBinding <code>kubauth-users</code> Yes <p>Namespace configuration can be adjusted via Helm chart values during Kubauth deployment.</p>"},{"location":"60-references/100-overview/#common-patterns","title":"Common Patterns","text":""},{"location":"60-references/100-overview/#accessing-resources","title":"Accessing Resources","text":""},{"location":"60-references/100-overview/#fully-qualified-names","title":"Fully Qualified Names","text":"<p>Since some resource names (like <code>User</code>) are common and may conflict with other CRDs, use fully qualified names:</p> <pre><code>kubectl -n kubauth-users get users.kubauth.kubotal.io\n</code></pre>"},{"location":"60-references/100-overview/#using-aliases","title":"Using Aliases","text":"<p>For convenience, Kubauth provides aliases:</p> <pre><code># User alias\nkubectl -n kubauth-users get kusers\n</code></pre>"},{"location":"60-references/100-overview/#listing-resources","title":"Listing Resources","text":"<pre><code># List all OIDC clients\nkubectl -n kubauth-oidc get oidcclients\n\n# List all users\nkubectl -n kubauth-users get users.kubauth.kubotal.io\n\n# List all groups\nkubectl -n kubauth-users get groups.kubauth.kubotal.io\n\n# List all group bindings\nkubectl -n kubauth-users get groupbindings\n</code></pre>"},{"location":"60-references/100-overview/#describing-resources","title":"Describing Resources","text":"<pre><code># Describe an OIDC client\nkubectl -n kubauth-oidc describe oidcclient myapp\n\n# Describe a user\nkubectl -n kubauth-users describe user john\n\n# Describe a group\nkubectl -n kubauth-users describe group developers\n</code></pre>"},{"location":"60-references/100-overview/#security-considerations","title":"Security Considerations","text":""},{"location":"60-references/100-overview/#access-control","title":"Access Control","text":"<p>Use Kubernetes RBAC to control access to Kubauth resources:</p> <pre><code>apiVersion: rbac.authorization.k8s.io/v1\nkind: Role\nmetadata:\n  name: kubauth-user-manager\n  namespace: kubauth-users\nrules:\n- apiGroups: [\"kubauth.kubotal.io\"]\n  resources: [\"users\", \"groupbindings\"]\n  verbs: [\"get\", \"list\", \"create\", \"update\", \"patch\", \"delete\"]\n</code></pre>"},{"location":"60-references/100-overview/#secret-management","title":"Secret Management","text":"<ul> <li>User Passwords: Always stored as bcrypt hashes, never in plain text</li> <li>Client Secrets: Stored as bcrypt hashes in OidcClient resources</li> <li>Use <code>kc hash</code> command: Generate hashes for passwords and secrets</li> </ul>"},{"location":"60-references/100-overview/#best-practices","title":"Best Practices","text":""},{"location":"60-references/100-overview/#resource-naming","title":"Resource Naming","text":"<ul> <li>Use descriptive, lowercase names with hyphens</li> <li>Follow consistent naming conventions across your organization</li> <li>For GroupBindings, use pattern: <code>&lt;username&gt;-&lt;groupname&gt;</code></li> </ul>"},{"location":"60-references/100-overview/#examples-repository","title":"Examples Repository","text":"<p>Complete examples for all resources can be found throughout the documentation:</p> <ul> <li>User Configuration</li> <li>User Groups</li> <li>Applications Integration</li> <li>Kubernetes Integration</li> </ul>"},{"location":"60-references/100-overview/#additional-resources","title":"Additional Resources","text":"<ul> <li>Kubauth GitHub Repository</li> </ul>"},{"location":"60-references/110-oidcclient/","title":"OidcClient Reference","text":""},{"location":"60-references/110-oidcclient/#overview","title":"Overview","text":"<p>An <code>OidcClient</code> represents an OIDC client application that can authenticate users through Kubauth. In OIDC terminology, a client is an application that delegates user authentication to an OIDC server.</p> <p>API Group: <code>kubauth.kubotal.io/v1alpha1</code></p> <p>Kind: <code>OidcClient</code></p> <p>Namespaced: Yes (typically <code>kubauth-oidc</code>)</p>"},{"location":"60-references/110-oidcclient/#example","title":"Example","text":"<pre><code>apiVersion: kubauth.kubotal.io/v1alpha1\nkind: OidcClient\nmetadata:\n  name: my-app\n  namespace: kubauth-oidc\nspec:\n  hashedSecret: \"$2a$12$...\"\n  redirectURIs:\n    - \"https://myapp.example.com/callback\"\n  grantTypes:\n    - \"refresh_token\"\n    - \"authorization_code\"\n  responseTypes:\n    - \"code\"\n    - \"id_token\"\n    - \"token\"\n    - \"id_token token\"\n    - \"code id_token\"\n    - \"code token\"\n    - \"code id_token token\"      \n  scopes:\n    - \"openid\"\n    - \"profile\"\n    - \"groups\"\n    - \"email\"\n  description: \"My Application\"\n  displayName: \"My App\"\n  entryURL: \"https://myapp.example.com\"\n  accessTokenLifespan: 1h\n  idTokenLifespan: 1h\n  refreshTokenLifespan: 8h\n</code></pre>"},{"location":"60-references/110-oidcclient/#spec-fields","title":"Spec Fields","text":""},{"location":"60-references/110-oidcclient/#hashedsecret","title":"<code>hashedSecret</code>","text":"<p>string - Required if non public</p> <p>The hashed client secret for confidential clients. Use the <code>kc hash</code> command to generate the hash from a plain-text secret.</p> <p>Omit this field for public clients (see <code>public</code> field).</p> <p>Example: <pre><code>hashedSecret: \"$2a$12$...\"\n</code></pre></p>"},{"location":"60-references/110-oidcclient/#redirecturis","title":"<code>redirectURIs</code>","text":"<p>[]string - Required</p> <p>List of allowed redirect URIs for the OAuth2 authorization flow. After successful authentication, the authorization server will redirect the user back to one of these URIs.</p> <p>Example: <pre><code>redirectURIs:\n  - \"https://myapp.example.com/callback\"\n  - \"http://localhost:8080/callback\"  # For local development\n</code></pre></p>"},{"location":"60-references/110-oidcclient/#granttypes","title":"<code>grantTypes</code>","text":"<p>[]string - Required</p> <p>List of OAuth2 grant types that this client is allowed to use.</p> <p>Common values:</p> <ul> <li><code>authorization_code</code> - Standard OAuth2 authorization code flow</li> <li><code>refresh_token</code> - Allows using refresh tokens to obtain new access tokens</li> <li><code>password</code> - Resource Owner Password Credentials (ROPC) flow (must be explicitly enabled)</li> </ul> <p>Example: <pre><code>grantTypes:\n  - \"authorization_code\"\n  - \"refresh_token\"\n</code></pre></p>"},{"location":"60-references/110-oidcclient/#responsetypes","title":"<code>responseTypes</code>","text":"<p>[]string - Required</p> <p>List of response types the client can expect from the authorization endpoint.</p> <p>Common values:</p> <ul> <li><code>code</code> - Authorization code</li> <li><code>token</code> - Access token (implicit flow)</li> <li><code>id_token</code> - ID token</li> <li><code>id_token token</code> - Both ID token and access token</li> <li><code>code id_token</code> - Both code and ID token</li> <li><code>code token</code> - Both code and access token</li> <li><code>code id_token token</code> - All three</li> </ul> <p>Example: <pre><code>responseTypes: [ \"id_token\", \"code\", \"token\", \"id_token token\", \"code id_token\", \"code token\", \"code id_token token\" ]\n</code></pre></p>"},{"location":"60-references/110-oidcclient/#scopes","title":"<code>scopes</code>","text":"<p>[]string - Required</p> <p>List of OAuth2 scopes that this client can request.</p> <p>Standard OIDC scopes:</p> <ul> <li><code>openid</code> - Required for OIDC authentication</li> <li><code>profile</code> - Access to user profile information</li> <li><code>email</code> - Access to user email</li> <li><code>offline</code> / <code>offline_access</code> - Request refresh tokens</li> <li><code>groups</code> - Access to user group membership</li> </ul> <p>Example: <pre><code>scopes:\n  - \"openid\"\n  - \"profile\"\n  - \"groups\"\n  - \"email\"\n  - \"offline_access\"\n</code></pre></p>"},{"location":"60-references/110-oidcclient/#public","title":"<code>public</code>","text":"<p>boolean -  Optional. Default: <code>false</code></p> <p>Indicates whether this is a public client. Public clients do not require a client secret.</p> <p>Use for: Browser-based applications, native mobile apps, CLI tools</p> <p>Example: <pre><code>public: true\n</code></pre></p>"},{"location":"60-references/110-oidcclient/#forceopenidscope","title":"<code>forceOpenIdScope</code>","text":"<p>boolean - Optional. Default: <code>false</code></p> <p>Force openid scope even if not requested by the client application.</p>"},{"location":"60-references/110-oidcclient/#postlogouturl","title":"<code>postLogoutURL</code>","text":"<p>boolean - Optional. Default: <code>false</code></p> <p>Where to redirected user on logout.</p> <ul> <li>Will take precedence on the same global configuration value.</li> <li>May be overridden by a query parameter on the logout url</li> </ul>"},{"location":"60-references/110-oidcclient/#displayname","title":"<code>displayName</code>","text":"<p>string - optional</p> <p>A user-friendly name for the application. This is displayed on the Kubauth index page and logout page.</p> <p>Example: <pre><code>displayName: \"Employee Portal\"\n</code></pre></p>"},{"location":"60-references/110-oidcclient/#description-string","title":"<code>description</code> (string)","text":"<p>Optional </p> <p>A short description of the client application. This is displayed on the Kubauth index page and logout page.</p> <p>Example: <pre><code>description: \"Corporate application for employee management\"\n</code></pre></p>"},{"location":"60-references/110-oidcclient/#entryurl","title":"<code>entryURL</code>","text":"<p>string - optional</p> <p>The main entry URL for the application. Used to provide a link to the application on the Kubauth index page and logout page.</p> <p>Note: Requires <code>displayName</code> and <code>description</code> to be set for the application to appear in the application list.</p> <p>Example: <pre><code>entryURL: \"https://portal.example.com\"\n</code></pre></p>"},{"location":"60-references/110-oidcclient/#accesstokenlifespan","title":"<code>accessTokenLifespan</code>","text":"<p>duration - optional - default: 1 Hour</p> <p>The lifespan of access tokens issued to this client.</p> <p>Format: Duration string (e.g., <code>1m0s</code>, <code>1h</code>, <code>30m</code>)</p> <p>Example: <pre><code>accessTokenLifespan: 15m\n</code></pre></p>"},{"location":"60-references/110-oidcclient/#idtokenlifespan","title":"<code>idTokenLifespan</code>","text":"<p>duration - optional - default: 1 Hour</p> <p>The lifespan of ID tokens issued to this client.</p> <p>Format: Duration string (e.g., <code>1m0s</code>, <code>1h</code>, <code>30m</code>)</p> <p>Example: <pre><code>idTokenLifespan: 1h\n</code></pre></p>"},{"location":"60-references/110-oidcclient/#refreshtokenlifespan","title":"<code>refreshTokenLifespan</code>","text":"<p>duration - optional - default: 30 days</p> <p>The lifespan of refresh tokens issued to this client.</p> <p>Format: Duration string (e.g., <code>1h</code>, <code>8h</code>, <code>24h</code>)</p> <p>Example: <pre><code>refreshTokenLifespan: 8h\n</code></pre></p>"},{"location":"60-references/110-oidcclient/#status-fields","title":"Status Fields","text":"<p>The <code>OidcClient</code> resource does not currently expose status fields. The resource is ready to use immediately after creation.</p>"},{"location":"60-references/110-oidcclient/#usage-notes","title":"Usage Notes","text":""},{"location":"60-references/110-oidcclient/#client-id","title":"Client ID","text":"<p>The client ID is derived from the resource name in the metadata section. This is what client applications use to identify themselves to the OIDC server.</p>"},{"location":"60-references/110-oidcclient/#namespacing","title":"Namespacing","text":"<p><code>OidcClient</code> resources are typically created in the <code>kubauth-oidc</code> namespace, though this can be configured via Helm chart values.</p>"},{"location":"60-references/110-oidcclient/#security-considerations","title":"Security Considerations","text":"<p>Public vs Confidential Clients:</p> <ul> <li>Use <code>public: true</code> for applications that cannot securely store a secret (browsers, mobile apps, CLIs)</li> <li>Use <code>hashedSecret</code> for server-side applications that can securely store credentials</li> </ul> <p>Token Lifespans:</p> <ul> <li>Shorter access token lifespans increase security but may impact performance</li> <li>Balance security requirements with user experience</li> <li>For kubectl integration, consider very short access tokens (1-5 minutes) with longer refresh tokens</li> </ul> <p>Grant Types:</p> <ul> <li>Only enable the grant types your application actually needs</li> <li>The <code>password</code> grant type is deprecated and disabled by default - use only for specific use cases</li> </ul>"},{"location":"60-references/110-oidcclient/#application-list-display","title":"Application List Display","text":"<p>For an application to appear on the Kubauth index page (<code>https://kubauth.example.com/index</code>) and logout page, all three of the following fields must be set:</p> <ul> <li><code>displayName</code></li> <li><code>description</code></li> <li><code>entryURL</code></li> </ul>"},{"location":"60-references/110-oidcclient/#examples","title":"Examples","text":""},{"location":"60-references/110-oidcclient/#public-client-browsercli","title":"Public Client (Browser/CLI)","text":"<pre><code>apiVersion: kubauth.kubotal.io/v1alpha1\nkind: OidcClient\nmetadata:\n  name: public\n  namespace: kubauth-oidc\nspec:\n  redirectURIs:\n    - \"http://127.0.0.1:9921/callback\"\n  grantTypes:\n    - \"refresh_token\"\n    - \"authorization_code\"\n  responseTypes:\n    - \"id_token\"\n    - \"code\"\n  scopes:\n    - \"openid\"\n    - \"profile\"\n    - \"groups\"\n    - \"email\"\n    - \"offline_access\"\n  description: \"Test public client\"\n  public: true\n</code></pre>"},{"location":"60-references/110-oidcclient/#confidential-client-server-application","title":"Confidential Client (Server Application)","text":"<pre><code>apiVersion: kubauth.kubotal.io/v1alpha1\nkind: OidcClient\nmetadata:\n  name: webapp\n  namespace: kubauth-oidc\nspec:\n  hashedSecret: \"$2a$12$...\"\n  redirectURIs:\n    - \"https://webapp.example.com/callback\"\n  grantTypes:\n    - \"refresh_token\"\n    - \"authorization_code\"\n  responseTypes:\n    - \"code\"\n  scopes:\n    - \"openid\"\n    - \"profile\"\n    - \"groups\"\n    - \"email\"\n    - \"offline_access\"\n  description: \"Corporate Web Application\"\n  displayName: \"Corporate Portal\"\n  entryURL: \"https://webapp.example.com\"\n  accessTokenLifespan: 30m\n  refreshTokenLifespan: 24h\n</code></pre>"},{"location":"60-references/110-oidcclient/#kubernetes-kubectl-client","title":"Kubernetes kubectl Client","text":"<pre><code>apiVersion: kubauth.kubotal.io/v1alpha1\nkind: OidcClient\nmetadata:\n  name: k8s\n  namespace: kubauth-oidc\nspec:\n  hashedSecret: \"$2a$12$...\"\n  description: \"For kubernetes kubectl access\"\n  grantTypes:\n    - \"refresh_token\"\n    - \"authorization_code\"\n    - \"password\"\n  redirectURIs:\n    - \"http://localhost:8000\"\n    - \"http://localhost:18000\"\n  responseTypes:\n    - \"id_token\"\n    - \"code\"\n  scopes:\n    - \"openid\"\n    - \"offline\"\n    - \"profile\"\n    - \"groups\"\n    - \"email\"\n    - \"offline_access\"\n  accessTokenLifespan: 1m\n  idTokenLifespan: 1m\n  refreshTokenLifespan: 30m\n</code></pre>"},{"location":"60-references/120-user/","title":"User Reference","text":""},{"location":"60-references/120-user/#overview","title":"Overview","text":"<p>A <code>User</code> represents a user account in Kubauth. Users are stored as Kubernetes Custom Resources, providing a cloud-native, scalable authentication solution.</p> <p>API Group: <code>kubauth.kubotal.io/v1alpha1</code></p> <p>Kind: <code>User</code></p> <p>Namespaced: Yes (typically <code>kubauth-users</code>)</p> <p>Aliases: <code>kuser</code> (for easier kubectl access)</p>"},{"location":"60-references/120-user/#example","title":"Example","text":"<pre><code>apiVersion: kubauth.kubotal.io/v1alpha1\nkind: User\nmetadata:\n  name: john\n  namespace: kubauth-users\nspec:\n  passwordHash: \"$2a$12$...\"\n  name: \"John DOE\"\n  emails:\n    - john.doe@example.com\n    - j.doe@example.com\n  claims:\n    office: \"Building A, Room 205\"\n    department: \"Engineering\"\n    employee_id: \"12345\"\n  comment: \"Senior Software Engineer\"\n  disabled: false\n</code></pre>"},{"location":"60-references/120-user/#spec-fields","title":"Spec Fields","text":""},{"location":"60-references/120-user/#name","title":"<code>name</code>","text":"<p>string - optional</p> <p>The full name of the user. This appears in the <code>name</code> claim in OIDC ID tokens.</p> <p>Example: <pre><code>name: \"John DOE\"\n</code></pre> Resulting JWT Token Claim: <pre><code>{\n  \"name\": \"John DOE\",\n  ...\n}\n</code></pre></p>"},{"location":"60-references/120-user/#emails","title":"<code>emails</code>","text":"<p>[]string - optional</p> <p>List of email addresses associated with the user.</p> <p>Behavior: - The <code>emails</code> claim in the ID token contains the complete list - The <code>email</code> claim contains the first email in the list</p> <p>Example: <pre><code>emails:\n  - john.doe@example.com\n  - j.doe@example.com\n</code></pre></p> <p>JWT Token Claims: <pre><code>{\n  \"email\": \"john.doe@example.com\",\n  \"emails\": [\"john.doe@example.com\", \"j.doe@example.com\"],\n  ...\n}\n</code></pre></p>"},{"location":"60-references/120-user/#passwordhash","title":"<code>passwordHash</code>","text":"<p>string - optional</p> <p>The bcrypt hash of the user's password. </p> <p>Generation: Use the <code>kc hash &lt;password&gt;</code> command to generate the hash from a plain-text password.</p> <p>Security: Passwords are stored as bcrypt hashes (never in plain text), providing strong protection against password database compromise.</p> <p>Behavior: A user definition without password is useful on case of multiple Identity Providers.</p> <p>Example: <pre><code>passwordHash: \"$2a$12$yJEo9EoYn/ylGS4PCamfNe8PReYH9IPumsw7rMTDi3glZjuA7dXMm\"\n</code></pre></p> <p>Generating a hash: <pre><code>$ kc hash mypassword123\nSecret: mypassword123\nHash: $2a$12$yJEo9EoYn/ylGS4PCamfNe8PReYH9IPumsw7rMTDi3glZjuA7dXMm\n</code></pre></p> <p>Use this hash in your User 'passwordHash' field</p>"},{"location":"60-references/120-user/#claims","title":"<code>claims</code>","text":"<p>map[string]any - required</p> <p>Custom OIDC claims to include in ID tokens for this user. Can contain any valid JSON values.</p> <p>Use Cases:</p> <ul> <li>Application-specific user attributes</li> <li>Custom authorization data</li> <li>Integration with downstream systems</li> </ul> <p>Example: <pre><code>claims:\n  office: \"208G\"\n  department: \"Engineering\"\n  clearance_level: 3\n  minio_policies: \"consoleAdmin\"\n</code></pre></p> <p>JWT Token Claims: <pre><code>{\n  \"office\": \"208G\",\n  \"department\": \"Engineering\",\n  \"clearance_level\": 3,\n  \"minio_policies\": \"consoleAdmin\",\n  ...\n}\n</code></pre></p>"},{"location":"60-references/120-user/#uid","title":"<code>uid</code>","text":"<p>integer - optional</p> <p>A user numerical ID. May be useful in some Linux context</p>"},{"location":"60-references/120-user/#comment","title":"<code>comment</code>","text":"<p>string - optional</p> <p>Administrative comment or description for the user. Not included in OIDC tokens.</p> <p>Example: <pre><code>comment: \"External consultant - expires 2025-12-31\"\n</code></pre></p>"},{"location":"60-references/120-user/#disabled","title":"<code>disabled</code>","text":"<p>boolean - optional default false</p> <p>Whether the user account is disabled. Disabled users cannot authenticate.</p> <p>Default: <code>false</code></p> <p>Example: <pre><code>disabled: true\n</code></pre></p>"},{"location":"60-references/120-user/#status-fields","title":"Status Fields","text":"<p>The <code>User</code> resource does not currently expose status fields. The resource is ready to use immediately after creation.</p>"},{"location":"60-references/120-user/#identity-information","title":"Identity Information","text":"<p>The user login is the resource name in the metadata section. This becomes:</p> <ul> <li>The <code>sub</code> (subject) claim in OIDC tokens</li> <li>The login for authentication</li> </ul> <p>Example: <pre><code>metadata:\n  name: john  # This is the login username\n</code></pre></p> <p>JWT Token: <pre><code>{\n  \"sub\": \"john\",\n  ...\n}\n</code></pre></p>"},{"location":"60-references/120-user/#usage-notes","title":"Usage Notes","text":""},{"location":"60-references/120-user/#namespacing","title":"Namespacing","text":"<p>Users are typically created in the <code>kubauth-users</code> namespace, though this can be configured via Helm chart values.</p>"},{"location":"60-references/120-user/#access-control","title":"Access Control","text":"<p>Using a dedicated namespace for users allows fine-grained access control via Kubernetes RBAC. You can grant specific users or groups the ability to manage User resources without giving them full cluster access.</p>"},{"location":"60-references/120-user/#fully-qualified-resource-name","title":"Fully Qualified Resource Name","text":"<p>Since <code>user</code> is a common term that may refer to various CRD types, use the fully qualified name when querying:</p> <pre><code>kubectl -n kubauth-users get users.kubauth.kubotal.io\n</code></pre> <p>Alternatively, use the provided alias:</p> <pre><code>kubectl -n kubauth-users get kusers\n</code></pre>"},{"location":"60-references/120-user/#password-updates","title":"Password Updates","text":"<p>To update a user's password:</p> <ol> <li>Generate a new hash: <code>kc hash newpassword</code></li> <li>Update the User resource with the new <code>passwordHash</code></li> </ol> <pre><code>kubectl patch user john -n kubauth-users --type merge -p '{\"spec\":{\"passwordHash\":\"$2a$12$...\"}}'\n</code></pre>"},{"location":"60-references/120-user/#identity-provider-integration","title":"Identity Provider Integration","text":"<p>When using external identity providers (like LDAP), user properties can be merged:</p> <ul> <li>Password validation may come from LDAP</li> <li>Additional attributes (claims, group memberships) can be defined in the User CRD</li> <li>See Identity Merging for details</li> </ul>"},{"location":"60-references/120-user/#examples","title":"Examples","text":""},{"location":"60-references/120-user/#minimal-user","title":"Minimal User","text":"<pre><code>apiVersion: kubauth.kubotal.io/v1alpha1\nkind: User\nmetadata:\n  name: alice\n  namespace: kubauth-users\nspec:\n  passwordHash: \"$2a$12$...\"\n</code></pre>"},{"location":"60-references/120-user/#complete-user","title":"Complete User","text":"<pre><code>apiVersion: kubauth.kubotal.io/v1alpha1\nkind: User\nmetadata:\n  name: john\n  namespace: kubauth-users\nspec:\n  passwordHash: \"$2a$12$...\"\n  name: \"John DOE\"\n  emails:\n    - john.doe@example.com\n    - j.doe@example.com\n  claims:\n    office: \"208G\"\n    department: \"Engineering\"\n    employee_id: \"E12345\"\n    clearance_level: 2\n  comment: \"Engineering team lead\"\n</code></pre>"},{"location":"60-references/120-user/#disabled-user","title":"Disabled User","text":"<pre><code>apiVersion: kubauth.kubotal.io/v1alpha1\nkind: User\nmetadata:\n  name: former-employee\n  namespace: kubauth-users\nspec:\n  passwordHash: \"$2a$12$...\"\n  name: \"Former Employee\"\n  disabled: true\n  comment: \"Account disabled - left company 2024-01-15\"\n</code></pre>"},{"location":"60-references/120-user/#user-with-application-specific-claims","title":"User with Application-Specific Claims","text":"<pre><code>apiVersion: kubauth.kubotal.io/v1alpha1\nkind: User\nmetadata:\n  name: admin-user\n  namespace: kubauth-users\nspec:\n  passwordHash: \"$2a$12$...\"\n  name: \"Admin User\"\n  emails:\n    - admin@example.com\n  claims:\n    # MinIO policy\n    minio_policies: \"consoleAdmin\"\n    # Harbor role indicator\n    harbor_role: \"admin\"\n    # Custom application data\n    cost_center: \"IT-OPS\"\n    office: \"HQ-Floor3\"\n</code></pre>"},{"location":"60-references/120-user/#related-resources","title":"Related Resources","text":"<ul> <li>Group - Define groups with shared claims</li> <li>GroupBinding - Associate users with groups</li> </ul>"},{"location":"60-references/130-group/","title":"Group Reference","text":""},{"location":"60-references/130-group/#overview","title":"Overview","text":"<p>A <code>Group</code> represents an explicit group definition with associated claims. Groups can exist implicitly through <code>GroupBinding</code> resources alone, but creating an explicit Group resource allows you to:</p> <ul> <li>Document the group's purpose</li> <li>Define claims that are inherited by all group members</li> <li>Centralize group-level permissions and attributes</li> </ul> <p>API Group: <code>kubauth.kubotal.io/v1alpha1</code></p> <p>Kind: <code>Group</code></p> <p>Namespaced: Yes (typically <code>kubauth-users</code>)</p>"},{"location":"60-references/130-group/#example","title":"Example","text":"<pre><code>apiVersion: kubauth.kubotal.io/v1alpha1\nkind: Group\nmetadata:\n  name: ops\n  namespace: kubauth-users\nspec:\n  comment: \"Operations team with 24x7 access\"\n  claims:\n    accessProfile: \"24x7\"\n    pager_duty: \"true\"\n    alert_level: \"critical\"\n</code></pre>"},{"location":"60-references/130-group/#spec-fields","title":"Spec Fields","text":"<p>All fields in the Group spec are optional. A Group can exist with an empty spec.</p>"},{"location":"60-references/130-group/#comment","title":"<code>comment</code>","text":"<p>string - optional</p> <p>A description or comment about the group for administrative purposes. Not included in OIDC tokens.</p> <p>Example: <pre><code>comment: \"Development team with access to staging environments\"\n</code></pre></p>"},{"location":"60-references/130-group/#claims","title":"<code>claims</code>","text":"<p>map[string]any - optional</p> <p>Custom OIDC claims that are inherited by all members of this group. Can contain any valid JSON values.</p> <p>Behavior: When a user is a member of this group (via GroupBinding), these claims are merged into the user's ID token.</p> <p>Use Cases: - Application-specific permissions - Role indicators - Policy assignments - Common attributes for all group members</p> <p>Example: <pre><code>claims:\n  accessProfile: \"business-hours\"\n  cost_center: \"ENG-001\"\n  security_clearance: 2\n</code></pre></p> <p>JWT Token for a member: <pre><code>{\n  \"accessProfile\": \"business-hours\",\n  \"cost_center\": \"ENG-001\",\n  \"security_clearance\": 2,\n  ...\n}\n</code></pre></p>"},{"location":"60-references/130-group/#group-existence","title":"Group Existence","text":""},{"location":"60-references/130-group/#implicit-groups","title":"Implicit Groups","text":"<p>Groups can exist without an explicit Group resource. Simply referencing a group name in a GroupBinding creates an implicit group.</p> <p>Example: <pre><code>apiVersion: kubauth.kubotal.io/v1alpha1\nkind: GroupBinding\nmetadata:\n  name: alice-developers\n  namespace: kubauth-users\nspec:\n  user: alice\n  group: developers  # Group 'developers' now exists implicitly\n</code></pre></p>"},{"location":"60-references/130-group/#explicit-groups","title":"Explicit Groups","text":"<p>Creating a Group resource makes the group explicit and allows you to:</p> <ul> <li>Add a description via the <code>comment</code> field</li> <li>Define claims that all members inherit</li> </ul> <p>Example: <pre><code>---\napiVersion: kubauth.kubotal.io/v1alpha1\nkind: Group\nmetadata:\n  name: developers\n  namespace: kubauth-users\nspec:\n  comment: \"Software development team\"\n  claims:\n    department: \"Engineering\"\n    build_access: \"true\"\n---\napiVersion: kubauth.kubotal.io/v1alpha1\nkind: GroupBinding\nmetadata:\n  name: alice-developers\n  namespace: kubauth-users\nspec:\n  user: alice\n  group: developers\n</code></pre></p>"},{"location":"60-references/130-group/#claim-inheritance","title":"Claim Inheritance","text":"<p>When a user belongs to multiple groups, claims from all groups are merged. If multiple groups define the same claim key, the behavior depends on the identity provider configuration and group ordering.</p>"},{"location":"60-references/130-group/#usage-notes","title":"Usage Notes","text":""},{"location":"60-references/130-group/#naming-convention","title":"Naming Convention","text":"<p>Group names should be descriptive and follow your organization's naming conventions. Consider:</p> <ul> <li>Using lowercase with hyphens: <code>ops-team</code>, <code>developers</code>, <code>cluster-admins</code></li> <li>Prefixes for different categories: <code>app-</code>, <code>k8s-</code>, <code>ldap-</code></li> </ul>"},{"location":"60-references/130-group/#kubernetes-rbac-integration","title":"Kubernetes RBAC Integration","text":"<p>When integrating with Kubernetes RBAC, be aware of the group name prefix configured in the API server OIDC settings.</p> <p>Example: If your API server is configured with <code>--oidc-groups-prefix=oidc-</code>, a group named <code>cluster-admin</code> in Kubauth will appear as <code>oidc-cluster-admin</code> in Kubernetes RBAC.</p> <pre><code>---\n# Kubauth Group\napiVersion: kubauth.kubotal.io/v1alpha1\nkind: Group\nmetadata:\n  name: cluster-admin\n  namespace: kubauth-users\nspec:\n  comment: \"Full cluster administrators\"\n---\n# Kubernetes ClusterRoleBinding references the prefixed name\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: oidc-cluster-admins\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- apiGroup: rbac.authorization.k8s.io\n  kind: Group\n  name: oidc-cluster-admin  # Note the prefix\n</code></pre>"},{"location":"60-references/130-group/#application-specific-claims","title":"Application-Specific Claims","text":"<p>Groups are ideal for centralizing application-specific permissions and policies.</p> <p>Best Practice: Create dedicated groups for each application or permission level rather than adding application-specific claims to individual users.</p>"},{"location":"60-references/130-group/#deletion-behavior","title":"Deletion Behavior","text":"<p>Deleting a Group resource:</p> <ul> <li>Removes the explicit group definition</li> <li>Does not automatically delete associated GroupBindings</li> <li>Does not automatically remove users from the group</li> </ul> <p>If GroupBindings still reference the deleted group, the group continues to exist implicitly through those bindings, but without any group-level claims or comments.</p> <p>To fully remove a group:</p> <ol> <li>Delete all GroupBindings that reference the group</li> <li>Delete the Group resource (if it exists)</li> </ol> <pre><code># Find all bindings for a group\nkubectl -n kubauth-users get groupbindings -o json | \\\n  jq -r '.items[] | select(.spec.group==\"ops\") | .metadata.name'\n\n# Delete the bindings\nkubectl -n kubauth-users delete groupbinding john-ops alice-ops bob-ops\n\n# Delete the group resource\nkubectl -n kubauth-users delete group ops\n</code></pre>"},{"location":"60-references/130-group/#related-resources","title":"Related Resources","text":"<ul> <li>GroupBinding - Associates users with groups</li> <li>User - User accounts that can be members of groups</li> </ul>"},{"location":"60-references/140-groupbinding/","title":"GroupBinding Reference","text":""},{"location":"60-references/140-groupbinding/#overview","title":"Overview","text":"<p>A <code>GroupBinding</code> associates a user with a group. Groups are used to organize users and apply common claims and permissions. With Kubauth, a group exists simply by being referenced in a <code>GroupBinding</code> - explicit Group creation is optional.</p> <p>API Group: <code>kubauth.kubotal.io/v1alpha1</code></p> <p>Kind: <code>GroupBinding</code></p> <p>Namespaced: Yes (typically <code>kubauth-users</code>)</p>"},{"location":"60-references/140-groupbinding/#example","title":"Example","text":"<pre><code>apiVersion: kubauth.kubotal.io/v1alpha1\nkind: GroupBinding\nmetadata:\n  name: john-developers\n  namespace: kubauth-users\nspec:\n  user: john\n  group: developers\n</code></pre>"},{"location":"60-references/140-groupbinding/#spec-fields","title":"Spec Fields","text":""},{"location":"60-references/140-groupbinding/#user","title":"<code>user</code>","text":"<p>string - required</p> <p>The name of the user to bind to the group. This must match the <code>metadata.name</code> of an existing User resource.</p>"},{"location":"60-references/140-groupbinding/#group","title":"<code>group</code>","text":"<p>string - required</p> <p>The name of the group to bind the user to. The group does not need to exist as a Group resource - it will be created implicitly by the GroupBinding.</p>"},{"location":"60-references/140-groupbinding/#behavior","title":"Behavior","text":""},{"location":"60-references/140-groupbinding/#implicit-group-creation","title":"Implicit Group Creation","text":"<p>Creating a GroupBinding automatically makes the referenced group exist, even if no explicit Group resource is defined.  This follows Kubernetes' pattern of weak referential integrity.</p>"},{"location":"60-references/140-groupbinding/#group-claims-in-tokens","title":"Group Claims in Tokens","text":"<p>When a user authenticates, all groups they belong to (via GroupBinding resources) are included in the <code>groups</code> claim in the OIDC ID token.</p> <p>Example: User <code>john</code> has two GroupBindings: <pre><code>---\napiVersion: kubauth.kubotal.io/v1alpha1\nkind: GroupBinding\nmetadata:\n  name: john-developers\n  namespace: kubauth-users\nspec:\n  user: john\n  group: developers\n---\napiVersion: kubauth.kubotal.io/v1alpha1\nkind: GroupBinding\nmetadata:\n  name: john-leads\n  namespace: kubauth-users\nspec:\n  user: john\n  group: team-leads\n</code></pre></p> <p>JWT Token for user <code>john</code>: <pre><code>{\n  \"sub\": \"john\",\n  \"groups\": [\"developers\", \"team-leads\"],\n  ...\n}\n</code></pre></p>"},{"location":"60-references/140-groupbinding/#naming-convention","title":"Naming Convention","text":"<p>While the <code>metadata.name</code> can be any valid Kubernetes resource name, we recommend a naming convention that makes the binding easy to understand:</p> <p>Pattern: <code>&lt;username&gt;-&lt;groupname&gt;</code></p> <p>Examples: - <code>john-developers</code> - <code>alice-cluster-admins</code> - <code>bob-ops-team</code></p> <p>This makes it easy to identify what each binding does and find all bindings for a specific user or group using kubectl.</p>"},{"location":"60-references/140-groupbinding/#deletion-behavior","title":"Deletion Behavior","text":"<p>Deleting a GroupBinding removes the user from the group immediately. The user will no longer have the group in their <code>groups</code> claim or inherit any group-level claims on the next authentication.</p> <pre><code>kubectl delete groupbinding john-developers -n kubauth-users\n</code></pre> <p>Note: Deleting the last GroupBinding that references a group does not delete the group itself if an explicit Group resource exists.  Only implicit groups (those that exist solely through GroupBindings) cease to exist when all their bindings are deleted.</p>"},{"location":"60-references/140-groupbinding/#related-resources","title":"Related Resources","text":"<ul> <li>User - User accounts that can be bound to groups</li> <li>Group - Optional explicit group definitions with claims</li> </ul>"},{"location":"70-kc/100-overview/","title":"kc CLI Tool","text":""},{"location":"70-kc/100-overview/#overview","title":"Overview","text":"<p><code>kc</code> is the companion CLI tool for Kubauth, providing essential utilities for working with the Kubauth OIDC server and Kubernetes authentication.</p> <p>GitHub Repository: https://github.com/kubauth/kc</p>"},{"location":"70-kc/100-overview/#purpose","title":"Purpose","text":"<p>The <code>kc</code> CLI tool serves multiple purposes:</p> <ol> <li>Authentication Testing - Quickly test OIDC authentication flows</li> <li>Token Management - Obtain and inspect OIDC tokens</li> <li>Kubeconfig Setup - Automate kubectl configuration for OIDC authentication</li> <li>User Management - Generate password hashes for users and clients</li> <li>Audit Queries - View authentication attempts and user details</li> <li>JWT Inspection - Decode and display JWT token contents</li> </ol>"},{"location":"70-kc/100-overview/#installation","title":"Installation","text":"<p>Download the latest release from the GitHub releases page and install it on your system.</p>"},{"location":"70-kc/100-overview/#macos-and-linux","title":"macOS and Linux","text":"<pre><code># Download the appropriate binary for your system\n# For example, on macOS:\nmv kc_darwin_amd64 kc\nchmod +x kc\nsudo mv kc /usr/local/bin/\n</code></pre>"},{"location":"70-kc/100-overview/#windows","title":"Windows","text":"<pre><code># Rename and move to a directory in your PATH\nmv kc_windows_amd64.exe kc.exe\n# Move to a directory in your PATH, e.g., C:\\Windows\\System32\\\n</code></pre>"},{"location":"70-kc/100-overview/#verify-installation","title":"Verify Installation","text":"<pre><code>kc version\n</code></pre>"},{"location":"70-kc/100-overview/#available-commands","title":"Available Commands","text":""},{"location":"70-kc/100-overview/#authentication-tokens","title":"Authentication &amp; Tokens","text":"<ul> <li><code>kc token</code> - Obtain OIDC tokens using the authorization code flow (with browser)</li> <li><code>kc token-nui</code> - Obtain OIDC tokens using password grant (no browser required)</li> <li><code>kc jwt</code> - Decode and display JWT token contents</li> <li><code>kc logout</code> - Clear SSO session and local token cache</li> </ul>"},{"location":"70-kc/100-overview/#kubernetes-configuration","title":"Kubernetes Configuration","text":"<ul> <li><code>kc config</code> - Configure kubectl for OIDC authentication with Kubauth</li> <li><code>kc whoami</code> - Display current authenticated user information</li> </ul>"},{"location":"70-kc/100-overview/#utilities","title":"Utilities","text":"<ul> <li><code>kc hash</code> - Generate bcrypt hashes for passwords and secrets</li> <li><code>kc audit</code> - Query authentication audit logs</li> <li><code>kc version</code> - Display version information</li> </ul>"},{"location":"70-kc/100-overview/#quick-start","title":"Quick Start","text":""},{"location":"70-kc/100-overview/#1-test-authentication","title":"1. Test Authentication","text":"<pre><code>kc token --issuerURL https://kubauth.example.com --clientId public\n</code></pre>"},{"location":"70-kc/100-overview/#2-generate-a-password-hash","title":"2. Generate a Password Hash","text":"<pre><code>kc hash mypassword123\n</code></pre>"},{"location":"70-kc/100-overview/#3-configure-kubectl","title":"3. Configure kubectl","text":"<pre><code>kc config https://kubeconfig.example.com/kubeconfig\n</code></pre>"},{"location":"70-kc/100-overview/#4-check-who-you-are","title":"4. Check Who You Are","text":"<pre><code>kc whoami\n</code></pre>"},{"location":"70-kc/100-overview/#5-view-audit-logs","title":"5. View Audit Logs","text":"<pre><code>kc audit logins\n</code></pre>"},{"location":"70-kc/100-overview/#common-options","title":"Common Options","text":"<p>Many <code>kc</code> commands share common options:</p>"},{"location":"70-kc/100-overview/#-issuerurl-string","title":"<code>--issuerURL</code> (string)","text":"<p>The Kubauth OIDC issuer URL.</p> <p>Example: <code>--issuerURL https://kubauth.example.com</code></p>"},{"location":"70-kc/100-overview/#-clientid-string","title":"<code>--clientId</code> (string)","text":"<p>The OIDC client ID.</p> <p>Example: <code>--clientId public</code></p>"},{"location":"70-kc/100-overview/#-insecureskipverify","title":"<code>--insecureSkipVerify</code>","text":"<p>Skip TLS certificate verification for <code>\u00ecssuerURL</code> (useful for testing with self-signed certificates).</p> <p>Example: <code>--insecureSkipVerify</code></p>"},{"location":"70-kc/100-overview/#-cafile","title":"<code>--caFile</code>","text":"<p>Provide a CA file for TLS certificate verification of <code>\u00ecssuerURL</code></p>"},{"location":"70-kc/100-overview/#-d-detailed","title":"<code>-d, --detailed</code>","text":"<p>Decode and display JWT token contents (shortcut for piping to <code>kc jwt</code>).</p> <p>Example: <code>kc token --issuerURL https://kubauth.example.com --clientId public -d</code></p>"},{"location":"70-kc/100-overview/#kubeconfig-configuration-file","title":"Kubeconfig configuration File","text":"<p>The <code>kc</code> tool can read OIDC configuration from your kubectl config file when available. This eliminates the need to specify <code>--issuerURL</code> and <code>--clientId</code> for many commands after you've run <code>kc config</code>.</p>"},{"location":"70-kc/100-overview/#environment-variables","title":"Environment Variables","text":"<p>Some commands support environment variables for configuration:</p> <ul> <li><code>KC_ISSUER_URL</code> - Default issuer URL</li> <li><code>KC_CLIENT_ID</code> - Default client ID</li> <li><code>KC_CLIENT_SECRET</code> - Default client secret</li> <li><code>KC_USER_LOGIN</code> - Default user login for <code>token-nui</code></li> <li><code>KC_USER_PASSWORD</code> - Default user password for <code>token-nui</code></li> </ul> <p>Example: <pre><code>export KC_ISSUER_URL=https://kubauth.example.com\nexport KC_CLIENT_ID=public\n\n# Now you can omit these flags\nkc token\n</code></pre></p>"},{"location":"70-kc/100-overview/#getting-help","title":"Getting Help","text":"<p>For help with any command:</p> <pre><code># General help\nkc --help\n\n# Command-specific help\nkc token --help\nkc config --help\nkc audit --help\n</code></pre>"},{"location":"70-kc/100-overview/#use-cases","title":"Use Cases","text":""},{"location":"70-kc/100-overview/#development-testing","title":"Development &amp; Testing","text":"<pre><code># Quick authentication test\nkc token --issuerURL https://kubauth.local --clientId test\n\n# Decode token to inspect claims\nkc token --issuerURL https://kubauth.local --clientId test -d\n\n# Test with different users\nkc token-nui --issuerURL https://kubauth.local --clientId test \\\n  --login alice --password alice123 -d\n</code></pre>"},{"location":"70-kc/100-overview/#user-management","title":"User Management","text":"<pre><code># Generate password hash for a new user\nkc hash strongpassword456\n\n# Check user's groups and claims\nkc audit detail username\n</code></pre>"},{"location":"70-kc/100-overview/#kubernetes-integration","title":"Kubernetes Integration","text":"<pre><code># Configure kubectl for OIDC\nkc config https://kubeconfig.example.com/kubeconfig\n\n# Verify configuration\nkc whoami\n\n# Log out to switch users\nkc logout\n</code></pre>"},{"location":"70-kc/100-overview/#cicd-automation","title":"CI/CD &amp; Automation","text":"<pre><code># Non-interactive authentication for scripts\nkc token-nui --issuerURL https://kubauth.example.com \\\n  --clientId automation \\\n  --login serviceaccount \\\n  --password $SERVICE_PASSWORD \\\n  --onlyIDToken\n</code></pre>"},{"location":"70-kc/100-overview/#troubleshooting","title":"Troubleshooting","text":""},{"location":"70-kc/100-overview/#certificate-errors","title":"Certificate Errors","text":"<p>If you encounter TLS certificate errors:</p> <ul> <li> <p>Option 1: Skip verification (not recommended for production)     <pre><code>kc token --issuerURL https://kubauth.local --clientId public --insecureSkipVerify\n</code></pre></p> </li> <li> <p>Option 2: Add CA certificate to your system trust store</p> <p>Extract CA certificate <pre><code>kubectl -n kubauth get secret kubauth-oidc-server-cert \\\n  -o=jsonpath='{.data.ca\\.crt}' | base64 -d &gt; kubauth-ca.crt\n</code></pre></p> <p>Add to system trust store (OS-specific)</p> </li> </ul>"},{"location":"70-kc/100-overview/#browser-not-opening","title":"Browser Not Opening","text":"<p>If the browser doesn't open automatically with <code>kc token</code>:</p> <ol> <li>Check the console output for the localhost URL</li> <li>Manually open the URL in your browser</li> <li>Or use <code>kc token-nui</code> for terminal-based authentication</li> </ol>"},{"location":"70-kc/110-version/","title":"kc version","text":""},{"location":"70-kc/110-version/#overview","title":"Overview","text":"<p>The <code>kc version</code> command displays version information for the <code>kc</code> CLI tool.</p>"},{"location":"70-kc/110-version/#syntax","title":"Syntax","text":"<pre><code>kc version\n</code></pre>"},{"location":"70-kc/110-version/#flags","title":"Flags","text":""},{"location":"70-kc/110-version/#-e-extended","title":"<code>-e</code>, <code>--extended</code>","text":"<p>Add build informations</p> <p>Example: </p> <pre><code>kc version -e\n0.1.2.20251024.080310\n</code></pre>"},{"location":"70-kc/120-hash/","title":"kc hash","text":""},{"location":"70-kc/120-hash/#overview","title":"Overview","text":"<p>The <code>kc hash</code> command generates bcrypt hashes for passwords and secrets. These hashes are used in Kubauth User and OidcClient resources for secure credential storage.</p>"},{"location":"70-kc/120-hash/#syntax","title":"Syntax","text":"<pre><code>kc hash &lt;plain-text-value&gt;\n</code></pre>"},{"location":"70-kc/120-hash/#arguments","title":"Arguments","text":""},{"location":"70-kc/120-hash/#plain-text-value-string-required","title":"<code>&lt;plain-text-value&gt;</code> (string, required)","text":"<p>The plain-text password or secret to hash.</p>"},{"location":"70-kc/120-hash/#examples","title":"Examples","text":"<pre><code>kc hash mypassword123\n</code></pre> <p>Output: <pre><code>Secret: mypassword123\nHash: $2a$12$nSplFbbsGoI7LXdhJrKx0erRmIv.zkTftG82sQZA0.v3l1eCf.ey.\n\nUse this hash in your User 'passwordHash' field\n\nExample:\n  apiVersion: kubauth.kubotal.io/v1alpha1\n  kind: User\n  .....\n  spec:\n    passwordHash: \"$2a$12$nSplFbbsGoI7LXdhJrKx0erRmIv.zkTftG82sQZA0.v3l1eCf.ey.\"\n\nOr in your OidcClient 'hashedSecret' field\n\nExample:\n  apiVersion: kubauth.kubotal.io/v1alpha1\n  kind: OidcClient\n  .....\n  spec:\n    hashedSecret: \"$2a$12$nSplFbbsGoI7LXdhJrKx0erRmIv.zkTftG82sQZA0.v3l1eCf.ey.\"\n</code></pre></p>"},{"location":"70-kc/120-hash/#security-considerations","title":"Security Considerations","text":""},{"location":"70-kc/120-hash/#password-strength","title":"Password Strength","text":"<p>The <code>kc hash</code> command will hash any input, but you should enforce strong password policies:</p> <ul> <li>Minimum length: 12+ characters recommended</li> <li>Complexity: Mix of letters, numbers, and symbols</li> <li>No common passwords: Avoid dictionary words</li> <li>No personal information: Don't use names, birthdates, etc.</li> </ul>"},{"location":"70-kc/120-hash/#hash-properties","title":"Hash Properties","text":"<ul> <li>Algorithm: bcrypt</li> <li>Cost Factor: 12 (balanced between security and performance)</li> <li>Unique salts: Each hash has a unique salt</li> <li>One-way: Cannot be reversed to get original password</li> </ul>"},{"location":"70-kc/120-hash/#handling-hashes","title":"Handling Hashes","text":"<ol> <li> <p>Quote in YAML: Always quote hashes in YAML files (dollar signs have special meaning)    <pre><code>passwordHash: \"$2a$12$...\"  # Quoted\n</code></pre></p> </li> <li> <p>Safe to store: Hashes can be safely committed to version control (not plain-text passwords)</p> </li> <li> <p>Different every time: Running <code>kc hash</code> with the same input produces different hashes (due to random salt)</p> </li> </ol>"},{"location":"70-kc/120-hash/#troubleshooting","title":"Troubleshooting","text":""},{"location":"70-kc/120-hash/#hash-not-working","title":"Hash Not Working","text":"<p>If authentication fails with a hash you generated:</p> <ol> <li>Verify hash was copied correctly - Include entire hash string</li> <li>Check quotes - Ensure hash is quoted in YAML</li> <li>Verify user exists - <code>kubectl -n kubauth-users get user &lt;username&gt;</code></li> <li>Test authentication - <code>kc audit logins</code></li> </ol>"},{"location":"70-kc/120-hash/#special-characters-in-password","title":"Special Characters in Password","text":"<p>Passwords with special characters are supported but must be handled carefully:</p> <pre><code># Use single quotes to prevent shell interpolation\nkc hash 'P@ssw0rd$pecial!'\n\n# Or escape special characters\nkc hash \"P@ssw0rd\\$pecial!\"\n</code></pre>"},{"location":"70-kc/120-hash/#see-also","title":"See Also","text":"<ul> <li>User Configuration</li> <li>User Reference</li> <li>OidcClient Reference</li> </ul>"},{"location":"70-kc/130-token/","title":"kc token","text":""},{"location":"70-kc/130-token/#overview","title":"Overview","text":"<p>The <code>kc token</code> command obtains OIDC tokens using the authorization code flow. It opens a browser for user authentication and returns access, refresh, and ID tokens.</p>"},{"location":"70-kc/130-token/#syntax","title":"Syntax","text":"<pre><code>kc token --issuerURL &lt;url&gt; --clientId &lt;id&gt; [options]\n</code></pre>"},{"location":"70-kc/130-token/#flags","title":"Flags","text":""},{"location":"70-kc/130-token/#-issuerurl","title":"<code>--issuerURL</code>","text":"<p>The Kubauth OIDC issuer URL.</p> <p>Example: <code>--issuerURL https://kubauth.example.com</code></p> <p>Value may also be fetched from <code>KC_ISSUER_URL</code> environment variable, or Kubernetes kubeconfig if <code>kc init ....</code> has been used.</p>"},{"location":"70-kc/130-token/#-clientid","title":"<code>--clientId</code>","text":"<p>The OIDC client ID to use for authentication.</p> <p>Example: <code>--clientId public</code></p> <p>Value may also be fetched from <code>KC_CLIENT_ID</code> environment variable, or Kubernetes kubeconfig if <code>kc init ....</code> has been used.</p>"},{"location":"70-kc/130-token/#-clientsecret","title":"<code>--clientSecret</code>","text":"<p>The client secret (for confidential clients).</p> <p>Example: <code>--clientSecret mysecret123</code></p> <p>Value may also be fetched from <code>KC_CLIENT_ID</code> environment variable, or Kubernetes kubeconfig if <code>kc init ....</code> has been used.</p>"},{"location":"70-kc/130-token/#-insecureskipverify","title":"<code>--insecureSkipVerify</code>","text":"<p>Skip TLS certificate verification. Use only for testing with self-signed certificates.</p> <p>Example: <code>--insecureSkipVerify</code></p>"},{"location":"70-kc/130-token/#-cafile","title":"<code>--caFile</code>","text":"<p>Provide a CA file for TLS certificate verification of \u00ecssuerURL</p> <p>Example: <code>--caFile ./CA.crt</code></p>"},{"location":"70-kc/130-token/#-onlyidtoken","title":"<code>--onlyIDToken</code>","text":"<p>Output only the ID token (base64-encoded JWT). Useful for piping to other commands or scripts.</p> <p>Example: <code>--onlyIDToken</code></p>"},{"location":"70-kc/130-token/#-onlyaccesstoken","title":"<code>--onlyAccessToken</code>","text":"<p>Output only the access token (base64-encoded). Useful for piping to other commands or scripts.</p> <p>Example: <code>--onlyAccessToken</code></p>"},{"location":"70-kc/130-token/#-d-detailidtoken","title":"<code>-d</code>, <code>--detailIDToken</code>","text":"<p>Decode and display the JWT token payload. This is a shortcut for <code>| kc jwt</code>.</p> <p>Example: <code>-d</code></p>"},{"location":"70-kc/130-token/#-scopes","title":"<code>--scopes</code>","text":"<p>Comma-separated list of OAuth2 scopes to request.</p> <p>Default: <code>openid,profile,groups,offline</code></p> <p>Example: <code>--scopes openid,profile,email,groups</code></p> <p>Warning</p> <p>In its current version, Kubauth does not manage scopes. All claims are included in the JWT token.</p>"},{"location":"70-kc/130-token/#-p-bindport","title":"<code>-p</code>, <code>bindPort</code>","text":"<p>Local web server bind port.</p> <p>Default: 9921</p>"},{"location":"70-kc/130-token/#-pkce","title":"<code>--pkce</code>","text":"<p>Use PKCE (Proof Key for Code Exchange) for enhanced security.</p>"},{"location":"70-kc/130-token/#-browser","title":"<code>--browser</code>","text":"<p>Override default browser. Possible values: </p> <ul> <li><code>chrome</code></li> <li><code>firefox</code></li> <li><code>safari</code></li> </ul>"},{"location":"70-kc/130-token/#examples","title":"Examples","text":""},{"location":"70-kc/130-token/#basic-usage","title":"Basic Usage","text":"<pre><code>kc token --issuerURL https://kubauth.example.com --clientId public\n</code></pre> <p>output: <pre><code>if browser doesn't open automatically, visit: http://127.0.0.1:9921\n</code></pre></p> <p>Output: (After successful login) <pre><code>Access token: ory_at_xLUfAhEGpFVWpMLdNEDZAj94hHFrHWjgOYB5g0Leh_k...\nRefresh token: ory_rt_nU9NBZs4NtKTxVYVko1aqlJkAMF5MLBYjfiZbhVt9aE...\nID token: eyJhbGciOiJSUzI1NiIsImtpZCI6ImY0Y2NkNDU0LWYzYTgtNDQ3Zi1hN2MzLTY...\nExpire in: 59m59s\n</code></pre></p>"},{"location":"70-kc/130-token/#with-decoded-token","title":"With Decoded Token","text":"<pre><code>kc token --issuerURL https://kubauth.example.com --clientId public -d\n</code></pre> <p>Output: <pre><code>Access token: ory_at_...\nRefresh token: ory_rt_...\nID token: eyJhbG...\nExpire in: 59m59s\nJWT Payload:\n{\n  \"aud\": [\"public\"],\n  \"auth_time\": 1763573723,\n  \"auth_time_human\": \"2025-11-19 17:35:23 UTC\",\n  \"azp\": \"public\",\n  \"email\": \"john@example.com\",\n  \"emails\": [\"john@example.com\"],\n  \"exp\": 1763577323,\n  \"exp_human\": \"2025-11-19 18:35:23 UTC\",\n  \"groups\": [\"developers\", \"ops\"],\n  \"iat\": 1763573723,\n  \"iat_human\": \"2025-11-19 17:35:23 UTC\",\n  \"iss\": \"https://kubauth.example.com\",\n  \"name\": \"John DOE\",\n  \"sub\": \"john\"\n}\n</code></pre></p>"},{"location":"70-kc/130-token/#only-id-token-for-piping","title":"Only ID Token (for Piping)","text":"<pre><code>kc token --issuerURL https://kubauth.example.com --clientId public --onlyIDToken\n</code></pre> <p>Output: <pre><code>eyJhbGciOiJSUzI1NiIsImtpZCI6ImY0Y2NkNDU0LWYzYTgtNDQ3Zi1hN2MzLTY3ZmY5MzUxMzZiMSIsInR5cCI6IkpXVCJ9.eyJhdF9oYXNoIjoiaGNBY2dtdmdBekJlSGgyODlkWHF3USIsImF1ZCI6WyJwdWJsaWMiXSwi...\n</code></pre></p>"},{"location":"70-kc/130-token/#pipe-to-jwt-decoder","title":"Pipe to JWT Decoder","text":"<pre><code>kc token --issuerURL https://kubauth.example.com --clientId public --onlyIDToken | kc jwt\n</code></pre>"},{"location":"70-kc/130-token/#behavior","title":"Behavior","text":""},{"location":"70-kc/130-token/#browser-flow","title":"Browser Flow","text":"<ol> <li>Local Server Started - <code>kc</code> starts a local HTTP server on a localhost port</li> <li>Browser Opens - Your default browser opens to the Kubauth login page</li> <li>User Authenticates - You log in with your credentials</li> <li>Callback Received - Kubauth redirects back to the local server with an authorization code</li> <li>Token Exchange - <code>kc</code> exchanges the code for tokens</li> <li>Display Results - Tokens are displayed in the terminal</li> </ol>"},{"location":"70-kc/130-token/#token-storage","title":"Token Storage","text":"<p>Tokens are displayed but not automatically stored. If you need to save them:</p> <pre><code># Save ID token to variable\nID_TOKEN=$(kc token --issuerURL https://kubauth.example.com --clientId public --onlyIDToken)\n\n# Save to file\nkc token --issuerURL https://kubauth.example.com --clientId public --onlyIDToken &gt; token.txt\n</code></pre>"},{"location":"70-kc/130-token/#sso-session","title":"SSO Session","text":"<p>If you previously checked \"Remember me\" on the login page, subsequent <code>kc token</code> commands will complete automatically without requiring you to log in again (SSO session active).</p> <p>To clear the SSO session:</p> <pre><code>kc logout --issuerURL https://kubauth.example.com\n</code></pre>"},{"location":"70-kc/130-token/#troubleshooting","title":"Troubleshooting","text":""},{"location":"70-kc/130-token/#browser-doesnt-open","title":"Browser Doesn't Open","text":"<p>If the browser doesn't open automatically:</p> <ol> <li>Check the terminal output for the URL</li> <li>Manually copy and paste it into your browser</li> <li>Or use <code>kc token-nui</code> for terminal-based authentication</li> </ol> <p>Example: <pre><code>If browser doesn't open automatically, visit: http://127.0.0.1:9921\n</code></pre></p>"},{"location":"70-kc/130-token/#tls-certificate-errors","title":"TLS Certificate Errors","text":"<p>Error: <pre><code>Error: x509: certificate signed by unknown authority\n</code></pre></p> <p>Solutions:</p> <ul> <li>Use <code>--insecureSkipVerify</code> for testing (not recommended for production)</li> <li>Use <code>--caFile ./ca.crt</code>. To extract the CA:    <pre><code>kubectl -n kubauth get secret kubauth-oidc-server-cert \\\n  -o=jsonpath='{.data.ca\\.crt}' | base64 -d &gt; ca.crt\n</code></pre></li> <li>Add this CA certificate to system trust store.</li> </ul>"},{"location":"70-kc/130-token/#security-considerations","title":"Security Considerations","text":"<ol> <li>Don't Expose Tokens - Be careful when displaying or logging tokens</li> <li>Use HTTPS - Always use HTTPS for the issuer URL in production</li> <li>Verify Certificates - Only use <code>--insecureSkipVerify</code> for testing</li> <li>Token Lifetime - Tokens expire quickly by design; request new ones as needed</li> <li>Client Secrets - Never commit client secrets to version control</li> </ol>"},{"location":"70-kc/130-token/#related-commands","title":"Related Commands","text":"<ul> <li><code>kc token-nui</code> - Non-interactive authentication (no browser)</li> <li><code>kc jwt</code> - Decode JWT tokens</li> <li><code>kc logout</code> - Clear SSO session</li> <li><code>kc whoami</code> - Display current user information</li> </ul>"},{"location":"70-kc/130-token/#see-also","title":"See Also","text":"<ul> <li>Tokens and Claims</li> <li>OidcClient Reference</li> </ul>"},{"location":"70-kc/140-token-nui/","title":"kc token-nui","text":""},{"location":"70-kc/140-token-nui/#overview","title":"Overview","text":"<p>The <code>kc token-nui</code> command obtains OIDC tokens using the Resource Owner Password Credentials (ROPC) flow. It prompts for username and password in the terminal without requiring a browser, making it suitable for headless environments, SSH sessions, and automation.</p> <p>NUI stands for \"No User Interface\" (no browser).</p>"},{"location":"70-kc/140-token-nui/#syntax","title":"Syntax","text":"<pre><code>kc token-nui --issuerURL &lt;url&gt; --clientId &lt;id&gt; [options]\n</code></pre>"},{"location":"70-kc/140-token-nui/#prerequisites","title":"Prerequisites","text":"<p>The ROPC/Password Grant must be enabled in Kubauth:</p> <ol> <li>Global configuration: Set <code>allowPasswordGrant: true</code> in Kubauth Helm values</li> <li>Client configuration: Add <code>\"password\"</code> to the client's <code>grantTypes</code> list</li> </ol> <p>See Password Grant Configuration for details.</p>"},{"location":"70-kc/140-token-nui/#flags","title":"Flags","text":""},{"location":"70-kc/140-token-nui/#-issuerurl","title":"<code>--issuerURL</code>","text":"<p>The Kubauth OIDC issuer URL.</p> <p>Example: <code>--issuerURL https://kubauth.example.com</code></p> <p>Value may also be fetched from <code>KC_ISSUER_URL</code> environment variable, or Kubernetes kubeconfig if <code>kc init ....</code> has been used.</p>"},{"location":"70-kc/140-token-nui/#-clientid","title":"<code>--clientId</code>","text":"<p>The OIDC client ID to use for authentication.</p> <p>Example: <code>--clientId public</code></p> <p>Value may also be fetched from <code>KC_CLIENT_ID</code> environment variable, or Kubernetes kubeconfig if <code>kc init ....</code> has been used.</p>"},{"location":"70-kc/140-token-nui/#-clientsecret","title":"<code>--clientSecret</code>","text":"<p>The client secret (for confidential clients).</p> <p>Example: <code>--clientSecret mysecret123</code></p> <p>Value may also be fetched from <code>KC_CLIENT_ID</code> environment variable, or Kubernetes kubeconfig if <code>kc init ....</code> has been used.</p>"},{"location":"70-kc/140-token-nui/#-insecureskipverify","title":"<code>--insecureSkipVerify</code>","text":"<p>Skip TLS certificate verification. Use only for testing with self-signed certificates.</p> <p>Example: <code>--insecureSkipVerify</code></p>"},{"location":"70-kc/140-token-nui/#-cafile","title":"<code>--caFile</code>","text":"<p>Provide a CA file for TLS certificate verification of \u00ecssuerURL</p> <p>Example: <code>--caFile ./CA.crt</code></p>"},{"location":"70-kc/140-token-nui/#-onlyidtoken","title":"<code>--onlyIDToken</code>","text":"<p>Output only the ID token (base64-encoded JWT). Useful for piping to other commands or scripts.</p> <p>Example: <code>--onlyIDToken</code></p>"},{"location":"70-kc/140-token-nui/#-onlyaccesstoken","title":"<code>--onlyAccessToken</code>","text":"<p>Output only the access token (base64-encoded). Useful for piping to other commands or scripts.</p> <p>Example: <code>--onlyAccessToken</code></p>"},{"location":"70-kc/140-token-nui/#-d-detailidtoken","title":"<code>-d</code>, <code>--detailIDToken</code>","text":"<p>Decode and display the JWT token payload. This is a shortcut for <code>| kc jwt</code>.</p> <p>Example: <code>-d</code></p>"},{"location":"70-kc/140-token-nui/#-scopes","title":"<code>--scopes</code>","text":"<p>Comma-separated list of OAuth2 scopes to request.</p> <p>Default: <code>openid,profile,groups,offline</code></p> <p>Example: <code>--scopes openid,profile,email,groups</code></p> <p>Warning</p> <p>In its current version, Kubauth does not manage scopes. All claims are included in the JWT token.</p>"},{"location":"70-kc/140-token-nui/#-login-string","title":"<code>--login</code> (string)","text":"<p>Username for authentication. If not provided, you'll be prompted.</p> <p>Value may also be fetched from <code>KC_USER_LOGIN</code> environment variable.</p>"},{"location":"70-kc/140-token-nui/#-password-string","title":"<code>--password</code> (string)","text":"<p>Password for authentication. If not provided, you'll be prompted (input hidden).</p> <p>Value may also be fetched from <code>KC_USER_PASSWORD</code> environment variable.</p>"},{"location":"70-kc/140-token-nui/#examples","title":"Examples","text":""},{"location":"70-kc/140-token-nui/#interactive-login","title":"Interactive Login","text":"<pre><code>kc token-nui --issuerURL https://kubauth.example.com --clientId public\n</code></pre> <p>Interaction: <pre><code>Login: john\nPassword: \n</code></pre></p> <p>Output: <pre><code>Access token: ory_at_LAhtO0e8T8-V2wLZ72V0G98jKMJEpYQLH6tm6Aeg_Lw...\nRefresh token: ory_rt_kP1rTr6eF_AgdVvUtzfEKywhIddEK2cjDRC9EmkT0Hw...\nID token: eyJhbGciOiJSUzI1NiIsImtpZCI6ImY0Y2NkNDU0LWYzYTgtNDQ3Zi1hN2MzLTY...\nExpire in: 1h0m0s\n</code></pre></p>"},{"location":"70-kc/140-token-nui/#non-interactive-automation","title":"Non-Interactive (Automation)","text":"<pre><code>kc token-nui --issuerURL https://kubauth.example.com \\\n  --clientId public \\\n  --login john \\\n  --password john123\n</code></pre>"},{"location":"70-kc/140-token-nui/#with-token-decoding","title":"With Token Decoding","text":"<pre><code>kc token-nui --issuerURL https://kubauth.example.com \\\n  --clientId public \\\n  --login john \\\n  --password john123 \\\n  -d\n</code></pre>"},{"location":"70-kc/140-token-nui/#only-id-token","title":"Only ID Token","text":"<pre><code>kc token-nui --issuerURL https://kubauth.example.com \\\n  --clientId public \\\n  --login john \\\n  --password john123 \\\n  --onlyIDToken\n</code></pre>"},{"location":"70-kc/140-token-nui/#for-cicd-pipelines","title":"For CI/CD Pipelines","text":"<pre><code>#!/bin/bash\nTOKEN=$(kc token-nui \\\n  --issuerURL https://kubauth.example.com \\\n  --clientId automation \\\n  --login serviceaccount \\\n  --password $SERVICE_PASSWORD \\\n  --onlyIDToken)\n\ncurl -H \"Authorization: Bearer $TOKEN\" https://api.example.com/deploy\n</code></pre>"},{"location":"70-kc/140-token-nui/#security-considerations","title":"Security Considerations","text":"<p>Password Grant Security</p> <p>The password grant flow is deprecated in OAuth 2.1 due to security concerns:</p> <ul> <li>Credentials are exposed to the client application</li> <li>Cannot support phishing-resistant MFA</li> <li>Users may be trained to enter passwords in applications</li> </ul> <p>Use only when browser-based flows are impossible.</p>"},{"location":"70-kc/140-token-nui/#troubleshooting","title":"Troubleshooting","text":""},{"location":"70-kc/140-token-nui/#password-grant-not-allowed","title":"Password Grant Not Allowed","text":"<p>Error: <pre><code>token request failed with status 403: {\"error\":\"request_forbidden\",\"error_description\":\"The request is not allowed. This server does not allow to use authorization grant 'password'. Check server configuration\"}\n</code></pre></p> <p>Solution: Enable password grant in both Kubauth configuration and the OidcClient. See Password Grant Configuration.</p>"},{"location":"70-kc/140-token-nui/#tls-certificate-errors","title":"TLS Certificate Errors","text":"<p>Error: <pre><code>Error: x509: certificate signed by unknown authority\n</code></pre></p> <p>Solutions:</p> <ul> <li>Use <code>--insecureSkipVerify</code> for testing (not recommended for production)</li> <li>Use <code>--caFile ./ca.crt</code>. To extract the CA:    <pre><code>kubectl -n kubauth get secret kubauth-oidc-server-cert \\\n  -o=jsonpath='{.data.ca\\.crt}' | base64 -d &gt; ca.crt\n</code></pre></li> <li>Add this CA certificate to system trust store.</li> </ul>"},{"location":"70-kc/140-token-nui/#authentication-failed","title":"Authentication Failed","text":"<p>Error: <pre><code>token request failed with status 400: {\"error\":\"invalid_grant\",\"error_description\":\"...Unable to authenticate the provided username and password credentials.\"}\n</code></pre></p> <p>Solutions:</p> <ul> <li>Verify username and password are correct</li> <li>Check user is not disabled: <code>kubectl -n kubauth-users get user &lt;username&gt;</code></li> <li>Review audit logs: <code>kc audit logins</code></li> </ul>"},{"location":"70-kc/140-token-nui/#comparison-with-kc-token","title":"Comparison with kc token","text":"Feature <code>kc token</code> <code>kc token-nui</code> Browser required Yes No OAuth flow Authorization Code + PKCE Password Grant (ROPC) SSH-friendly No Yes Automation-friendly Limited Yes MFA support Yes Limited Security Better Acceptable for specific cases Setup required Standard OIDC Must enable password grant"},{"location":"70-kc/140-token-nui/#related-commands","title":"Related Commands","text":"<ul> <li><code>kc token</code> - Browser-based authentication (preferred)</li> <li><code>kc config</code> - Configure kubectl with password grant</li> <li><code>kc jwt</code> - Decode JWT tokens</li> <li><code>kc audit</code> - View authentication attempts</li> </ul>"},{"location":"70-kc/140-token-nui/#see-also","title":"See Also","text":"<ul> <li>Password Grant (ROPC)</li> <li>Workstation Setup</li> </ul>"},{"location":"70-kc/150-audit/","title":"kc audit","text":""},{"location":"70-kc/150-audit/#overview","title":"Overview","text":"<p>The <code>kc audit</code> command queries Kubauth authentication audit logs. It provides two subcommands to view login attempts and detailed user authentication information.</p>"},{"location":"70-kc/150-audit/#flags","title":"flags","text":""},{"location":"70-kc/150-audit/#-namespace","title":"<code>--namespace</code>","text":"<p>string</p> <p>The namespace storing the audit logs</p> <p>Default: <code>kubauth-audit</code></p>"},{"location":"70-kc/150-audit/#kc-audit-logins","title":"kc audit logins","text":"<p>Display all login attempts with status, user information, and authentication source.</p>"},{"location":"70-kc/150-audit/#syntax","title":"Syntax","text":"<pre><code>kc audit logins [options]\n</code></pre>"},{"location":"70-kc/150-audit/#examples","title":"Examples","text":""},{"location":"70-kc/150-audit/#view-all-login-attempts","title":"View All Login Attempts","text":"<pre><code>kc audit logins\n</code></pre> <p>Output: <pre><code>WHEN           LOGIN   STATUS            UID   NAME         GROUPS             CLAIMS                                      EMAILS                  AUTH\nMon 12:22:31   jim     passwordChecked   -                  []                 {}                                          []                      \nMon 12:58:29   john    passwordChecked   -     John DOE     []                 {\"office\":\"208G\"}                           [johnd@mycompany.com]   \nMon 15:34:59   john    passwordChecked   -     John DOE     []                 {\"office\":\"208G\"}                           [johnd@mycompany.com]   \nTue 18:59:16   fred    passwordChecked   -     Fred ASTER   [staff,managers]   {}                                          [fred@mycompany.com]    ldap\nTue 19:02:20   jim     userNotFound      -                  []                 {}                                          []                    \n</code></pre></p>"},{"location":"70-kc/150-audit/#output-fields","title":"Output Fields","text":"<ul> <li>WHEN - Timestamp of the login attempt</li> <li>LOGIN - Username attempted</li> <li>STATUS - Authentication status:<ul> <li><code>passwordChecked</code> - Successful authentication</li> <li><code>passwordFail</code> - Invalid password</li> <li><code>userNotFound</code> - User doesn't exist</li> </ul> </li> <li>UID - Numerical user ID</li> <li>NAME - User's full name</li> <li>GROUPS - User's group memberships</li> <li>CLAIMS - Custom claims from User/Group resources</li> <li>EMAILS - User's email addresses</li> <li>AUTH - Authentication authority (identity provider name)</li> </ul>"},{"location":"70-kc/150-audit/#kc-audit-detail","title":"kc audit detail","text":"<p>Display detailed authentication information for a specific user's last login, including per-provider breakdown.</p>"},{"location":"70-kc/150-audit/#syntax_1","title":"Syntax","text":"<pre><code>kc audit detail &lt;username&gt;\n</code></pre>"},{"location":"70-kc/150-audit/#arguments","title":"Arguments","text":""},{"location":"70-kc/150-audit/#username","title":"<code>&lt;username&gt;</code>","text":"<p>string - required)</p> <p>The username to query detailed information for.</p>"},{"location":"70-kc/150-audit/#examples_1","title":"Examples","text":""},{"location":"70-kc/150-audit/#view-single-provider-authentication","title":"View Single Provider Authentication","text":"<pre><code>kc audit detail john\n</code></pre> <p>Output: <pre><code>WHEN           LOGIN   STATUS            UID   NAME       GROUPS       CLAIMS                                      EMAILS                  AUTH\nThu 16:14:04   john    passwordChecked   -     John DOE   [devs,ops]   {\"accessProfile\":\"p24x7\",\"office\":\"208G\"}   [johnd@mycompany.com]   ucrd\nDetail:\nPROVIDER   STATUS            UID   NAME       GROUPS       CLAIMS                                      EMAILS\nldap       userNotFound      -                []           {}                                          []\nucrd       passwordChecked   -     John DOE   [devs,ops]   {\"accessProfile\":\"p24x7\",\"office\":\"208G\"}   [johnd@mycompany.com]\n</code></pre></p>"},{"location":"70-kc/150-audit/#view-merged-identity","title":"View Merged Identity","text":"<pre><code>kc audit detail bob\n</code></pre> <p>Output: <pre><code>WHEN           LOGIN   STATUS            UID   NAME         GROUPS        CLAIMS                      EMAILS                AUTH\nThu 14:15:06   bob     passwordChecked   -     Bob MORANE   [ops,staff]   {\"accessProfile\":\"p24x7\"}   [bob@mycompany.com]   ldap\nDetail:\nPROVIDER   STATUS            UID   NAME         GROUPS    CLAIMS                      EMAILS\nldap       passwordChecked   -     Bob MORANE   [staff]   {}                          [bob@mycompany.com]\nucrd       userNotFound      -                  [ops]     {\"accessProfile\":\"p24x7\"}   []\n</code></pre></p> <p>This shows that:</p> <ul> <li>User authenticated via LDAP</li> <li>Groups include <code>staff</code> from LDAP and <code>ops</code> from local CRD</li> <li>Claims <code>accessProfile</code> comes from local Group definition</li> </ul>"},{"location":"70-kc/150-audit/#understanding-the-detail-output","title":"Understanding the Detail Output","text":"<p>The detail view shows:</p> <ol> <li>Summary line - Overall authentication result after merging all providers</li> <li>Per-provider breakdown - What each identity provider contributed:</li> <li>STATUS - Provider's authentication result</li> <li>Attributes - What information each provider supplied</li> </ol> <p>This helps understand: - Which provider authenticated the user - How identity information is merged - Where specific claims originate</p>"},{"location":"70-kc/150-audit/#data-source","title":"Data Source","text":"<p>Audit data is stored as Kubernetes <code>LoginAttempt</code> resources:</p> <pre><code>kubectl -n kubauth-audit get loginattempts\n</code></pre> <p>Output: <pre><code>NAME                           LOGIN   NAME       STATUS            AUTHORITY   AGE\njim-2025-10-27-11-22-31-017    jim                passwordChecked               3h41m\njohn-2025-10-27-11-58-29-588   john    John DOE   passwordChecked               3h5m\njohn-2025-10-27-14-34-59-923   john    John DOE   passwordChecked               28m\n</code></pre></p>"},{"location":"70-kc/150-audit/#retention","title":"Retention","text":"<p>Login attempts are automatically cleaned up based on Kubauth configuration, from helm chart:</p> <pre><code>audit:\n  cleaner:\n    recordLifetime: \"8h\"    # Default: keep for 8 hours\n    cleanupPeriod: \"5m\"     # Default: clean every 5 minutes\n</code></pre> <p>See Audit Configuration for details.</p>"},{"location":"70-kc/150-audit/#limitations","title":"Limitations","text":""},{"location":"70-kc/150-audit/#claims-display","title":"Claims Display","text":"<p>The audit logs show only custom claims from User and Group resources, not system claims like <code>aud</code>, <code>iss</code>, <code>exp</code>, etc.</p>"},{"location":"70-kc/150-audit/#time-window","title":"Time Window","text":"<p>Audit logs are retained for a limited time (default 8 hours). For longer-term audit trails, enable Kubernetes audit logging.</p>"},{"location":"70-kc/150-audit/#kubectl-access-required","title":"Kubectl Access Required","text":"<p>The <code>kc audit</code> commands query Kubernetes resources, so you need:</p> <ul> <li>kubectl configured and authenticated</li> <li>Read access to the <code>kubauth-audit</code> namespace</li> </ul>"},{"location":"70-kc/150-audit/#troubleshooting","title":"Troubleshooting","text":""},{"location":"70-kc/150-audit/#no-data-displayed","title":"No Data Displayed","text":"<p>If <code>kc audit logins</code> shows no data:</p> <ol> <li> <p>Check audit namespace: <pre><code>kubectl -n kubauth-audit get loginattempts\n</code></pre></p> </li> <li> <p>Verify Kubauth audit module is enabled: <pre><code>kubectl -n kubauth get pod -l app.kubernetes.io/instance=kubauth -o jsonpath='{range .items[0].spec.containers[*]}{.name}{\"\\n\"}{end}'\n</code></pre></p> </li> <li> <p>Check retention settings - Data may have been cleaned up</p> </li> </ol>"},{"location":"70-kc/150-audit/#permission-denied","title":"Permission Denied","text":"<p>Error: <pre><code>Error from server (Forbidden): loginattempts.kubauth.kubotal.io is forbidden: User \"john\" cannot list resource \"loginattempts\"\n</code></pre></p> <p>Solution: Grant read access to audit resources: <pre><code>apiVersion: rbac.authorization.k8s.io/v1\nkind: Role\nmetadata:\n  name: audit-reader\n  namespace: kubauth-audit\nrules:\n- apiGroups: [\"kubauth.kubotal.io\"]\n  resources: [\"loginattempts\"]\n  verbs: [\"get\", \"list\"]\n</code></pre></p>"},{"location":"70-kc/150-audit/#related-commands","title":"Related Commands","text":"<ul> <li><code>kc token</code> - Generate login attempts to view</li> <li><code>kc token-nui</code> - Test authentication</li> <li><code>kc whoami</code> - Check current user</li> </ul>"},{"location":"70-kc/150-audit/#see-also","title":"See Also","text":"<ul> <li>Audit Documentation</li> <li>Identity Merging</li> <li>Multiple Identity Providers</li> </ul>"},{"location":"70-kc/160-jwt/","title":"kc jwt","text":""},{"location":"70-kc/160-jwt/#overview","title":"Overview","text":"<p>The <code>kc jwt</code> command decodes and displays JWT (JSON Web Token) contents in a human-readable format. It extracts and pretty-prints the header and payload, and adds human-readable timestamps.</p>"},{"location":"70-kc/160-jwt/#syntax","title":"Syntax","text":"<pre><code>kc jwt [token]\n</code></pre> <p>or</p> <pre><code>echo &lt;token&gt; | kc jwt\n</code></pre>"},{"location":"70-kc/160-jwt/#arguments","title":"Arguments","text":""},{"location":"70-kc/160-jwt/#token","title":"<code>[token]</code>","text":"<p>string - optional</p> <p>The JWT token to decode. If not provided as an argument, reads from stdin.</p>"},{"location":"70-kc/160-jwt/#examples","title":"Examples","text":""},{"location":"70-kc/160-jwt/#decode-token-from-argument","title":"Decode Token from Argument","text":"<pre><code>kc jwt eyJhbGciOiJSUzI1NiIsImtpZCI6ImY0Y2NkNDU0LWYzYTgtNDQ3Zi1hN2MzLTY3ZmY5MzUxMzZiMSIsInR5cCI6IkpXVCJ9.eyJhdF9oYXNoIjoiaGNBY2dtdmdBekJlSGgyODlkWHF3USIsImF1ZCI6WyJwdWJsaWMiXSwi...\n</code></pre>"},{"location":"70-kc/160-jwt/#decode-token-from-stdin","title":"Decode Token from Stdin","text":"<pre><code>echo \"eyJhbGciOiJSUzI1NiIsImtpZCI6ImY0Y2NkNDU0...\" | kc jwt\n</code></pre>"},{"location":"70-kc/160-jwt/#pipe-from-kc-token","title":"Pipe from kc token","text":"<pre><code>kc token --issuerURL https://kubauth.example.com --clientId public --onlyIDToken | kc jwt\n</code></pre>"},{"location":"70-kc/160-jwt/#output","title":"Output","text":"<pre><code>JWT Header:\n{\n  \"alg\": \"RS256\",\n  \"kid\": \"f4ccd454-f3a8-447f-a7c3-67ff935136b1\",\n  \"typ\": \"JWT\"\n}\n\nJWT Payload:\n{\n  \"at_hash\": \"_GWrC20juEb4Zh39S0ly5w\",\n  \"aud\": [\"public\"],\n  \"auth_time\": 1761564624,\n  \"auth_time_human\": \"2025-10-27 11:30:24 UTC\",\n  \"azp\": \"public\",\n  \"email\": \"john@example.com\",\n  \"emails\": [\"john@example.com\"],\n  \"exp\": 1761568224,\n  \"exp_human\": \"2025-10-27 12:30:24 UTC\",\n  \"groups\": [\"developers\", \"ops\"],\n  \"iat\": 1761564624,\n  \"iat_human\": \"2025-10-27 11:30:24 UTC\",\n  \"iss\": \"https://kubauth.example.com\",\n  \"jti\": \"be30eeb2-153f-4dec-97b8-c75d23035f81\",\n  \"name\": \"John DOE\",\n  \"office\": \"208G\",\n  \"rat\": 1761564624,\n  \"rat_human\": \"2025-10-27 11:30:24 UTC\",\n  \"sub\": \"john\"\n}\n</code></pre>"},{"location":"70-kc/160-jwt/#human-readable-timestamps","title":"Human-Readable Timestamps","text":"<p>The decoder adds <code>_human</code> suffixed fields for timestamp claims:</p> <ul> <li><code>auth_time_human</code> - When user authenticated</li> <li><code>exp_human</code> - When token expires</li> <li><code>iat_human</code> - When token was issued  </li> <li><code>rat_human</code> - Token refresh time</li> </ul> <p>Note</p> <p>The <code>*_human</code> fields are added by the decoder for convenience and are not part of the actual JWT token.</p>"},{"location":"70-kc/160-jwt/#jwt-structure","title":"JWT Structure","text":""},{"location":"70-kc/160-jwt/#header","title":"Header","text":"<p>Contains token metadata:</p> <ul> <li><code>alg</code> - Signing algorithm (e.g., RS256)</li> <li><code>kid</code> - Key ID used for signing</li> <li><code>typ</code> - Token type (JWT)</li> </ul>"},{"location":"70-kc/160-jwt/#payload","title":"Payload","text":"<p>Contains claims (user information):</p> <p>Standard OIDC Claims:</p> <ul> <li><code>sub</code> - Subject (username)</li> <li><code>iss</code> - Issuer URL</li> <li><code>aud</code> - Audience (client ID)</li> <li><code>exp</code> - Expiration time</li> <li><code>iat</code> - Issued at time</li> <li><code>auth_time</code> - Authentication time</li> </ul> <p>Kubauth-Added Claims:</p> <ul> <li><code>name</code> - User's full name</li> <li><code>email</code> - Primary email</li> <li><code>emails</code> - All emails</li> <li><code>groups</code> - Group memberships</li> </ul> <p>Custom Claims:</p> <ul> <li>Any claims from User or Group <code>spec.claims</code></li> </ul>"},{"location":"70-kc/160-jwt/#limitations","title":"Limitations","text":""},{"location":"70-kc/160-jwt/#no-signature-verification","title":"No Signature Verification","text":"<p>The <code>kc jwt</code> command only decodes the token; it does not verify the signature. </p>"},{"location":"70-kc/160-jwt/#base64-decoding-only","title":"Base64 Decoding Only","text":"<p>This command simply base64-decodes the JWT parts. It doesn't validate:</p> <ul> <li>Token expiration</li> <li>Issuer authenticity</li> <li>Signature validity</li> </ul>"},{"location":"70-kc/160-jwt/#troubleshooting","title":"Troubleshooting","text":""},{"location":"70-kc/160-jwt/#invalid-token-format","title":"Invalid Token Format","text":"<p>Error: <pre><code>Error: invalid JWT format\n</code></pre></p> <p>Solution: Ensure the token is a complete JWT with three dot-separated parts: <pre><code>header.payload.signature\n</code></pre></p>"},{"location":"70-kc/160-jwt/#malformed-json","title":"Malformed JSON","text":"<p>If the output shows malformed JSON, the token may be corrupted or incomplete.</p>"},{"location":"70-kc/160-jwt/#related-commands","title":"Related Commands","text":"<ul> <li><code>kc token</code> - Get tokens with <code>-d</code> flag for automatic decoding</li> <li><code>kc token-nui</code> - Get tokens in terminal</li> <li><code>kc whoami</code> - With -d option, display decoded token from kubectl context</li> </ul>"},{"location":"70-kc/160-jwt/#see-also","title":"See Also","text":"<ul> <li>Tokens and Claims</li> <li>User Reference</li> <li>JWT Specification</li> </ul>"},{"location":"70-kc/170-whoami/","title":"kc whoami","text":""},{"location":"70-kc/170-whoami/#overview","title":"Overview","text":"<p>The <code>kc whoami</code> command displays the currently authenticated user information from your kubectl configuration. It extracts and shows the username and optionally the full JWT token payload.</p>"},{"location":"70-kc/170-whoami/#syntax","title":"Syntax","text":"<pre><code>kc whoami [options]\n</code></pre>"},{"location":"70-kc/170-whoami/#optional-flags","title":"Optional Flags","text":""},{"location":"70-kc/170-whoami/#-d-detailed","title":"<code>-d, --detailed</code>","text":"<p>Display the full decoded JWT token payload with all claims.</p>"},{"location":"70-kc/170-whoami/#examples","title":"Examples","text":""},{"location":"70-kc/170-whoami/#basic-usage","title":"Basic Usage","text":"<pre><code>kc whoami\n</code></pre> <p>Output: <pre><code>john\n</code></pre></p>"},{"location":"70-kc/170-whoami/#with-token-decoding","title":"With Token Decoding","text":"<pre><code>kc whoami -d\n</code></pre> <p>Output: <pre><code>john\nJWT Payload:\n{\n  \"accessProfile\": \"p24x7\",\n  \"at_hash\": \"xevWqv4MaZ_ft1nYs-wCcg\",\n  \"aud\": [\"k8s\"],\n  \"auth_time\": 1763573723,\n  \"auth_time_human\": \"2025-11-19 17:35:23 UTC\",\n  \"authority\": \"ucrd\",\n  \"azp\": \"k8s\",\n  \"email\": \"john@example.com\",\n  \"emails\": [\"john@example.com\"],\n  \"exp\": 1763577323,\n  \"exp_human\": \"2025-11-19 18:35:23 UTC\",\n  \"groups\": [\"developers\", \"ops\"],\n  \"iat\": 1763573723,\n  \"iat_human\": \"2025-11-19 17:35:23 UTC\",\n  \"iss\": \"https://kubauth.example.com\",\n  \"name\": \"John DOE\",\n  \"office\": \"208G\",\n  \"rat\": 1763573723,\n  \"rat_human\": \"2025-11-19 17:35:23 UTC\",\n  \"sub\": \"john\"\n}\n</code></pre></p>"},{"location":"70-kc/170-whoami/#prerequisites","title":"Prerequisites","text":""},{"location":"70-kc/170-whoami/#kubectl-configuration","title":"kubectl Configuration","text":"<p>The <code>kc whoami</code> command requires:</p> <ol> <li>kubectl configured - With valid kubeconfig</li> <li>OIDC authentication - Configured via <code>kc config</code></li> <li>Active session - You must have authenticated at least once</li> </ol>"},{"location":"70-kc/170-whoami/#setup","title":"Setup","text":"<pre><code># Configure kubectl for OIDC\nkc config https://kubeconfig.example.com/kubeconfig\n\n# Trigger initial authentication\nkubectl get nodes\n\n# Now whoami will work\nkc whoami\n</code></pre>"},{"location":"70-kc/170-whoami/#comparison-with-kubectl","title":"Comparison with kubectl","text":"Command Purpose Output <code>kc whoami</code> Show OIDC username <code>john</code> <code>kc whoami -d</code> Show full token Username + all claims <code>kubectl auth whoami</code> Show Kubernetes identity Full auth info including groups"},{"location":"70-kc/170-whoami/#related-commands","title":"Related Commands","text":"<ul> <li><code>kc config</code> - Configure kubectl for OIDC</li> <li><code>kc logout</code> - Clear authentication session</li> <li><code>kc token</code> - Get OIDC tokens</li> <li><code>kc jwt</code> - Decode JWT tokens</li> </ul>"},{"location":"70-kc/170-whoami/#see-also","title":"See Also","text":"<ul> <li>Workstation Setup</li> <li>Kubernetes Integration</li> </ul>"},{"location":"70-kc/180-logout/","title":"kc logout","text":""},{"location":"70-kc/180-logout/#overview","title":"Overview","text":"<p>The <code>kc logout</code> command clears your authentication session with Kubauth. It performs two actions: clears local token cache and terminates the SSO session on the Kubauth server.</p>"},{"location":"70-kc/180-logout/#syntax","title":"Syntax","text":"<pre><code>kc logout [options]\n</code></pre>"},{"location":"70-kc/180-logout/#flags","title":"Flags","text":""},{"location":"70-kc/180-logout/#-issuerurl","title":"<code>--issuerURL</code>","text":"<p>The Kubauth OIDC issuer URL.</p> <p>Example: <code>--issuerURL https://kubauth.example.com</code></p> <p>Value may also be fetched from <code>KC_ISSUER_URL</code> environment variable, or Kubernetes kubeconfig if <code>kc init ....</code> has been used.</p>"},{"location":"70-kc/180-logout/#-insecureskipverify","title":"<code>--insecureSkipVerify</code>","text":"<p>Skip TLS certificate verification. Use only for testing with self-signed certificates.</p> <p>Example: <code>--insecureSkipVerify</code></p>"},{"location":"70-kc/180-logout/#-cafile","title":"<code>--caFile</code>","text":"<p>Provide a CA file for TLS certificate verification of \u00ecssuerURL</p> <p>Example: <code>--caFile ./CA.crt</code></p>"},{"location":"70-kc/180-logout/#-browser","title":"<code>--browser</code>","text":"<p>Override default browser. Possible values:</p> <ul> <li><code>chrome</code></li> <li><code>firefox</code></li> <li><code>safari</code></li> </ul>"},{"location":"70-kc/180-logout/#-sso","title":"<code>--sso</code>","text":"<p>Only clear the SSO session on Kubauth server. Does not logout of <code>kubectl</code> session, if any</p>"},{"location":"70-kc/180-logout/#examples","title":"Examples","text":"<pre><code>kc logout --issuerURL https://kubauth.example.com\n</code></pre> <p>Output: <pre><code>No OIDC configuration found in kubeconfig\nOpening browser to logout endpoint: https://kubauth.example.com/oauth2/logout\n</code></pre></p> <p>Note</p> <p>The \"No OIDC configuration found\" means <code>kubectl</code> has not being configured with <code>kc init ....</code>. Use <code>--sso</code> option to remove the message</p>"},{"location":"70-kc/180-logout/#behavior","title":"Behavior","text":""},{"location":"70-kc/180-logout/#what-it-does","title":"What It Does","text":"<ol> <li>Clears local cache - Removes cached tokens from the <code>kubelogin</code> plugin, if installed</li> <li>Opens browser - Navigates to Kubauth's logout endpoint. This will terminates SSO session by clearing the \"Remember me\" session cookie</li> </ol>"},{"location":"70-kc/180-logout/#sso-session-vs-local-cache","title":"SSO Session vs Local Cache","text":""},{"location":"70-kc/180-logout/#sso-session-server-side-cross-application","title":"SSO Session (Server-Side, cross application)","text":"<ul> <li>Stored on Kubauth server</li> <li>Managed by \"Remember me\" checkbox</li> <li>Shared across all OIDC clients</li> <li>Cleared by <code>kc logout</code></li> </ul>"},{"location":"70-kc/180-logout/#local-cache-client-side-for-kubectl-authentication","title":"Local Cache (Client-Side, for <code>kubectl</code> authentication)","text":"<ul> <li>Need a <code>kc init ....</code> client configuration</li> <li>Stored by <code>kubelogin</code> plugin</li> <li>Also cleared by <code>kc logout</code></li> </ul>"},{"location":"70-kc/180-logout/#logout-page","title":"Logout Page","text":"<p>After logout, you'll see a page listing available applications:</p> <p></p> <p>This page shows OIDC clients with <code>displayName</code>, <code>description</code>, and <code>entryURL</code> configured.</p>"},{"location":"70-kc/180-logout/#troubleshooting","title":"Troubleshooting","text":""},{"location":"70-kc/180-logout/#tls-certificate-errors","title":"TLS Certificate Errors","text":"<p>Error: <pre><code>Error: x509: certificate signed by unknown authority\n</code></pre></p> <p>Solutions:</p> <ul> <li>Use <code>--insecureSkipVerify</code> for testing (not recommended for production)</li> <li>Use <code>--caFile ./ca.crt</code>. To extract the CA:    <pre><code>kubectl -n kubauth get secret kubauth-oidc-server-cert \\\n  -o=jsonpath='{.data.ca\\.crt}' | base64 -d &gt; ca.crt\n</code></pre></li> <li>Add this CA certificate to system trust store.</li> </ul>"},{"location":"70-kc/180-logout/#related-commands","title":"Related Commands","text":"<ul> <li><code>kc token</code> - Authenticate and get tokens</li> <li><code>kc whoami</code> - Check current authentication</li> <li><code>kc config</code> - Configure kubectl</li> </ul>"},{"location":"70-kc/180-logout/#see-also","title":"See Also","text":"<ul> <li>SSO Session</li> <li>Workstation Setup</li> </ul>"},{"location":"70-kc/190-config/","title":"kc config","text":""},{"location":"70-kc/190-config/#overview","title":"Overview","text":"<p>The <code>kc config</code> command configures <code>kubectl</code> for OIDC authentication with Kubauth.  It fetches configuration from the Kubauth kubeconfig service and automatically  sets up your local <code>~/.kube/config</code> file (Or the file set by <code>KUBECONFIG</code> environment variable) with the necessary OIDC settings.</p>"},{"location":"70-kc/190-config/#syntax","title":"Syntax","text":"<pre><code>kc config &lt;kubeconfig-service-url&gt; [options]\n</code></pre>"},{"location":"70-kc/190-config/#arguments","title":"Arguments","text":""},{"location":"70-kc/190-config/#kubeconfig-service-url","title":"<code>&lt;kubeconfig-service-url&gt;</code>","text":"<p>string - required</p> <p>The URL of the Kubauth kubeconfig service endpoint.</p> <p>Format: <code>https://&lt;host&gt;/kubeconfig</code></p> <p>Example: <code>https://kubeconfig.example.com/kubeconfig</code></p>"},{"location":"70-kc/190-config/#flags","title":"Flags","text":""},{"location":"70-kc/190-config/#-force","title":"<code>--force</code>","text":"<p>Overwrite existing context if it already exists in your kubeconfig.</p>"},{"location":"70-kc/190-config/#-insecureskipverify","title":"<code>--insecureSkipVerify</code>","text":"<p>Skip TLS certificate verification. Use only for testing with self-signed certificates.</p> <p>Example: --insecureSkipVerify</p>"},{"location":"70-kc/190-config/#-cafile","title":"<code>--caFile</code>","text":"<p>Provide a CA file for TLS certificate verification of \u00ecssuerURL</p> <p>Example: <code>--caFile ./CA.crt</code></p>"},{"location":"70-kc/190-config/#-granttype-string","title":"<code>--grantType</code> (string)","text":"<p>Specify the OAuth2 grant type to use.</p> <p>Values: - <code>auto</code> (default) - Authorization code flow with browser - <code>password</code> - Resource Owner Password Credentials flow (no browser)</p> <p>Example: <code>--grantType password</code></p>"},{"location":"70-kc/190-config/#examples","title":"Examples","text":""},{"location":"70-kc/190-config/#basic-usage","title":"Basic Usage","text":"<pre><code>kc config https://kubeconfig.example.com/kubeconfig\n</code></pre> <p>Output: <pre><code>Setup new context 'oidc-cluster1' in kubeconfig file '/Users/john/.kube/config'\n</code></pre></p>"},{"location":"70-kc/190-config/#overwrite-existing-context","title":"Overwrite Existing Context","text":"<pre><code>kc config https://kubeconfig.example.com/kubeconfig --force\n</code></pre>"},{"location":"70-kc/190-config/#configure-for-password-grant-no-browser","title":"Configure for Password Grant (No Browser)","text":"<pre><code>kc config https://kubeconfig.example.com/kubeconfig --grantType password\n</code></pre> <p>This is useful for remote servers without browser access</p>"},{"location":"70-kc/190-config/#skip-tls-verification-testing-only","title":"Skip TLS Verification (Testing Only)","text":"<pre><code>kc config https://kubeconfig.local/kubeconfig --insecureSkipVerify\n</code></pre>"},{"location":"70-kc/190-config/#behavior","title":"Behavior","text":""},{"location":"70-kc/190-config/#what-it-does","title":"What It Does","text":"<ul> <li>Fetches Configuration - Retrieves OIDC and cluster configuration from the kubeconfig service running on the cluster</li> <li>Updates ~/.kube/config - Adds or updates:<ul> <li>Cluster definition (API server URL, CA certificate)</li> <li>Context definition (links cluster and user)</li> <li>User definition (OIDC authentication settings)</li> </ul> </li> <li>Sets Current Context - Makes the new context active</li> </ul>"},{"location":"70-kc/190-config/#configuration-retrieved","title":"Configuration Retrieved","text":"<p>The kubeconfig service provides:</p> <ul> <li>Cluster information:<ul> <li>API server URL</li> <li>API server CA certificate</li> </ul> </li> <li>OIDC settings:<ul> <li>Issuer URL</li> <li>Client ID</li> <li>Client secret (if any)</li> <li>Issuer CA certificate</li> </ul> </li> <li>Context settings:<ul> <li>Context name</li> <li>Default namespace (optional)</li> </ul> </li> </ul>"},{"location":"70-kc/190-config/#resulting-kubeconfig","title":"Resulting Kubeconfig","text":"<p>After running <code>kc config</code>, your kubeconfig will contain:</p> <pre><code>apiVersion: v1\nclusters:\n- cluster:\n    certificate-authority-data: LS0tLS1CRUdJTi...\n    server: https://api.cluster.example.com:6443\n  name: oidc-cluster1-cluster\ncontexts:\n- context:\n    cluster: oidc-cluster1-cluster\n    user: oidc-cluster1-user\n  name: oidc-cluster1\ncurrent-context: oidc-cluster1\nkind: Config\nusers:\n- name: oidc-cluster1-user\n  user:\n    exec:\n      apiVersion: client.authentication.k8s.io/v1\n      args:\n      - oidc-login\n      - get-token\n      - --oidc-issuer-url=https://kubauth.example.com\n      - --oidc-client-id=k8s\n      - --oidc-client-secret=k8s123\n      - --certificate-authority-data=LS0tLS1CRUdJTi...\n      - --insecure-skip-tls-verify=false\n      - --grant-type=auto\n      - --oidc-extra-scope=offline\n      - --oidc-pkce-method=auto\n      command: kubectl\n      env: null\n      interactiveMode: IfAvailable\n      provideClusterInfo: false\n</code></pre>"},{"location":"70-kc/190-config/#prerequisites","title":"Prerequisites","text":""},{"location":"70-kc/190-config/#kubelogin-plugin","title":"kubelogin Plugin","text":"<p>The <code>kc config</code> command configures kubectl to use the <code>kubectl oidc-login</code> plugin. Ensure the kubelogin plugin is installed:</p> <pre><code># Homebrew (macOS and Linux)\nbrew install kubelogin\n\n# Krew (cross-platform)\nkubectl krew install oidc-login\n\n# Chocolatey (Windows)\nchoco install kubelogin\n</code></pre> <p>Verify installation:</p> <pre><code>kubectl oidc-login --version\n</code></pre>"},{"location":"70-kc/190-config/#kubeconfig-service","title":"Kubeconfig Service","text":"<p>The Kubauth kubeconfig service must be deployed and accessible. See Kubeconfig Service for setup instructions.</p>"},{"location":"70-kc/190-config/#troubleshooting","title":"Troubleshooting","text":""},{"location":"70-kc/190-config/#context-already-exists","title":"Context Already Exists","text":"<p>Error: <pre><code>Error: context 'oidc-cluster1' already exists in kubeconfig\n</code></pre></p> <p>Solution: Use <code>--force</code> to overwrite: <pre><code>kc config https://kubeconfig.example.com/kubeconfig --force\n</code></pre></p>"},{"location":"70-kc/190-config/#cannot-reach-service","title":"Cannot Reach Service","text":"<p>Error: <pre><code>Error: failed to fetch configuration: Get \"https://kubeconfig.example.com/kubeconfig\": dial tcp: lookup kubeconfig.example.com: no such host\n</code></pre></p> <p>Solutions:</p> <ul> <li>Verify the URL is correct</li> <li>Check network connectivity</li> <li>Ensure the kubeconfig service is running and ingress is correctly set:   <pre><code>kubectl -n kubauth get pods\nkubectl -n kubauth get ingress kubauth-kubeconfig\n</code></pre></li> </ul>"},{"location":"70-kc/190-config/#tls-certificate-error","title":"TLS Certificate Error","text":"<p>Error: <pre><code>Error: x509: certificate signed by unknown authority\n</code></pre></p> <p>Solutions:</p> <ul> <li>Use <code>--insecureSkipVerify</code> for testing (not recommended for production)</li> <li>Use <code>--caFile ./ca.crt</code>. To extract the CA:    <pre><code>kubectl -n kubauth get secret kubauth-oidc-server-cert \\\n  -o=jsonpath='{.data.ca\\.crt}' | base64 -d &gt; ca.crt\n</code></pre></li> <li>Add this CA certificate to system trust store.</li> </ul>"},{"location":"70-kc/190-config/#kubelogin-not-found","title":"kubelogin Not Found","text":"<p>Error: <pre><code>Error: exec plugin: invalid apiVersion \"client.authentication.k8s.io/v1\"\n</code></pre></p> <p>Solution: Install the kubelogin plugin (see Prerequisites above).</p>"},{"location":"70-kc/190-config/#security-considerations","title":"Security Considerations","text":"<ol> <li> <p>Protect kubeconfig - Your <code>~/.kube/config</code> file contains sensitive information    <pre><code>chmod 600 ~/.kube/config\n</code></pre></p> </li> <li> <p>Verify TLS - Only use <code>--insecureSkipVerify</code> for testing</p> </li> <li> <p>Review configuration - After running <code>kc config</code>, inspect your kubeconfig:    <pre><code>kubectl config view\n</code></pre></p> </li> <li> <p>Client secrets - Client secrets in kubeconfig are base64-encoded, not encrypted</p> </li> </ol>"},{"location":"70-kc/190-config/#related-commands","title":"Related Commands","text":"<ul> <li><code>kc whoami</code> - Verify your configuration</li> <li><code>kc logout</code> - Clear authentication session</li> <li><code>kc token</code> - Test OIDC authentication</li> </ul>"},{"location":"70-kc/190-config/#see-also","title":"See Also","text":"<ul> <li>Kubeconfig Service</li> <li>Workstation Setup</li> <li>Kubernetes Integration Overview</li> </ul>"},{"location":"80-appendix/100-openldap/","title":"OpenLDAP Deployment","text":"<p>If you do not have easy access to an LDAP server and want to test Kubauth with this configuration, one solution is to deploy an OpenLDAP server on your Kubernetes cluster.</p> <p>We can use the following Helm chart https://github.com/jp-gouin/helm-openldap for such a deployment.</p>"},{"location":"80-appendix/100-openldap/#configuration","title":"Configuration","text":"<p>Here is a sample values file:</p> values-openldap.yaml <pre><code>replicaCount: 2\nreplication:\n  enabled: true\n  tls_reqcert: never\nglobal:\n  adminPassword: admin123\n  adminUser: admin\n  configPassword: admin123\n  configUser: admin\n  ldapDomain: mycompany.com\ninitTLSSecret:\n  tls_enabled: false\npersistence:\n  storageClass: standard\nltb-passwd:\n  enabled : false\nphpldapadmin:\n  enabled: true\n  ingress:\n    enabled: true\n    ingressClassName: nginx\n    hosts:\n      - phpldapadmin.ingress.kubo6.mbp\nservice:\n  type: ClusterIP\n</code></pre> <p>If you want to use the phpldapadmin frontend, you will need to adjust at least the <code>phpldapadmin.ingress.hosts</code> value.</p> <p>This deployment is simplified to fulfill our testing requirements only. It is far from production-ready:</p> <ul> <li>There is no encryption. Connections are in clear text.</li> <li>There is no LoadBalancer. LDAP is only accessible from inside the cluster using the appropriate service.</li> </ul>"},{"location":"80-appendix/100-openldap/#sample-dataset","title":"Sample Dataset","text":"<p>The following values file will create two groups and three users in a fictitious company.</p> values-ldap-init.yaml <pre><code>customLdifFiles:\n  00-root.ldif: |-\n    # Root creation\n    dn: dc=mycompany,dc=com\n    objectClass: dcObject\n    objectClass: organization\n    o: MyCompany\n  01-base-ou.ldif: |-\n    dn: ou=Users,dc=mycompany,dc=com\n    objectClass: organizationalUnit\n    ou: Users\n\n    dn: ou=Groups,dc=mycompany,dc=com\n    objectClass: organizationalUnit\n    ou: Groups\n  03-first-groups.ldif: |-\n    dn: cn=staff,ou=Groups,dc=mycompany,dc=com\n    objectclass: posixGroup\n    objectclass: top\n    gidnumber: 500\n    cn: staff\n    memberUid: alice\n    memberUid: fred\n    memberUid: bob\n\n    dn: cn=managers,ou=Groups,dc=mycompany,dc=com\n    objectclass: posixGroup\n    objectclass: top\n    gidnumber: 501\n    cn: managers\n    memberUid: alice\n    memberUid: fred\n  05-first-users.ldif: |-\n    dn: uid=alice,ou=Users,dc=mycompany,dc=com\n    cn: Alice SMITH\n    objectclass: inetOrgPerson\n    objectclass: top\n    sn: SMITH\n    uid: alice\n    mail: alice@mycompany.com\n    userpassword: alice123\n\n    dn: uid=bob,ou=Users,dc=mycompany,dc=com\n    cn: Bob MORANE\n    objectclass: inetOrgPerson\n    objectclass: top\n    sn: MORANE\n    uid: bob\n    mail: bob@mycompany.com\n    userpassword: bob123\n\n    dn: uid=fred,ou=Users,dc=mycompany,dc=com\n    cn: Fred ASTER\n    objectclass: inetOrgPerson\n    objectclass: top\n    sn: ASTER\n    uid: fred\n    mail: fred@mycompany.com\n    userpassword: fred123\n</code></pre> <p>As you can see, passwords are in clear text.</p> <p>OpenLDAP allows you to provide them as hashed values.</p>"},{"location":"80-appendix/100-openldap/#deployment","title":"Deployment","text":"<p>You can now proceed with a standard Helm deployment.</p> <p>First, register the Helm repository:</p> <pre><code>helm repo add helm-openldap https://jp-gouin.github.io/helm-openldap/\n</code></pre> <p>Then, deploy using the two values files:</p> <pre><code>helm -n openldap upgrade -i openldap helm-openldap/openldap-stack-ha \\\n    --values ./values-openldap.yaml --values ./values-ldap-init.yaml \\\n    --version 4.3.3 --create-namespace --wait\n</code></pre> <p>You should now be able to log in to the phpldapadmin frontend. Use <code>cn=admin,dc=mycompany,dc=com</code> as the Login DN and <code>admin123</code> as the password.</p>"},{"location":"80-appendix/100-openldap/#update-removal","title":"Update / Removal","text":"<p>If you want to update the configuration, you can issue another <code>helm upgrade -i ...</code> command. However, if you intend to modify the dataset (users, groups), this will be ineffective.</p> <p>The Helm chart is designed such that the dataset is used only on initial deployment.</p> <p>Therefore, apart from using the frontend, the easiest way to modify the dataset is to uninstall everything and reinstall.</p> <pre><code>helm -n openldap uninstall openldap &amp;&amp;  kubectl delete ns openldap\n</code></pre> <p>Deleting the namespace is important, as it will clean up the associated Persistent Volumes. Not doing so will preserve the old data.</p>"}]}